function C(...i){if(i.length===1&&i[0]instanceof Uint8Array)return i[0];let e=i.reduce((n,o)=>n+o.length,0),t=new Uint8Array(e),r=0;for(let n of i)t.set(n,r),r+=n.length;return t}function Y(i,e){let t=i.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}var lt="\xB7\xB7 ";var qt=new TextEncoder,de=new TextDecoder,x=class{offset;dataView;data;comments;indents;indent;constructor(e){this.offset=0,this.data=typeof e=="number"?new Uint8Array(e):e,this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength),this.comments={},this.indents={},this.indent=0}extend(e){let t=typeof e=="number"?new Uint8Array(e):e;this.data=C(this.data,t),this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}remaining(){return this.data.length-this.offset}subarray(e){return this.data.subarray(this.offset,this.offset+=e)}skip(e,t){return this.offset+=e,t&&this.comment(t),this}comment(e,t=this.offset){throw new Error("No comments should be emitted outside of chatty mode")}readBytes(e){return this.data.slice(this.offset,this.offset+=e)}readUTF8String(e){let t=this.subarray(e);return de.decode(t)}readUTF8StringNullTerminated(){let e=this.offset;for(;this.data[e]!==0;)e++;let t=this.readUTF8String(e-this.offset);return this.expectUint8(0,"end of string"),t}readUint8(e){let t=this.dataView.getUint8(this.offset);return this.offset+=1,t}readUint16(e){let t=this.dataView.getUint16(this.offset);return this.offset+=2,t}readUint24(e){let t=this.readUint8(),r=this.readUint16();return(t<<16)+r}readUint32(e){let t=this.dataView.getUint32(this.offset);return this.offset+=4,t}expectBytes(e,t){let r=this.readBytes(e.length);if(!Y(r,e))throw new Error("Unexpected bytes")}expectUint8(e,t){let r=this.readUint8();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint16(e,t){let r=this.readUint16();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint24(e,t){let r=this.readUint24();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint32(e,t){let r=this.readUint32();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectLength(e,t=1){let r=this.offset,n=r+e;if(n>this.data.length)throw new Error("Expected length exceeds remaining data length");return this.indent+=t,this.indents[r]=this.indent,[()=>{if(this.indent-=t,this.indents[this.offset]=this.indent,this.offset!==n)throw new Error(`${e} bytes expected but ${this.offset-r} read`)},()=>n-this.offset]}expectLengthUint8(e){let t=this.readUint8();return this.expectLength(t)}expectLengthUint16(e){let t=this.readUint16();return this.expectLength(t)}expectLengthUint24(e){let t=this.readUint24();return this.expectLength(t)}expectLengthUint32(e){let t=this.readUint32();return this.expectLength(t)}expectLengthUint8Incl(e){let t=this.readUint8();return this.expectLength(t-1)}expectLengthUint16Incl(e){let t=this.readUint16();return this.expectLength(t-2)}expectLengthUint24Incl(e){let t=this.readUint24();return this.expectLength(t-3)}expectLengthUint32Incl(e){let t=this.readUint32();return this.expectLength(t-4)}writeBytes(e){return this.data.set(e,this.offset),this.offset+=e.length,this}writeUTF8String(e){let t=qt.encode(e);return this.writeBytes(t),this}writeUTF8StringNullTerminated(e){let t=qt.encode(e);return this.writeBytes(t),this.writeUint8(0),this}writeUint8(e,t){return this.dataView.setUint8(this.offset,e),this.offset+=1,this}writeUint16(e,t){return this.dataView.setUint16(this.offset,e),this.offset+=2,this}writeUint24(e,t){return this.writeUint8((e&16711680)>>16),this.writeUint16(e&65535,t),this}writeUint32(e,t){return this.dataView.setUint32(this.offset,e),this.offset+=4,this}_writeLengthGeneric(e,t,r){let n=this.offset;this.offset+=e;let o=this.offset;return this.indent+=1,this.indents[o]=this.indent,()=>{let a=this.offset-(t?n:o);if(e===1)this.dataView.setUint8(n,a);else if(e===2)this.dataView.setUint16(n,a);else if(e===3)this.dataView.setUint8(n,(a&16711680)>>16),this.dataView.setUint16(n+1,a&65535);else if(e===4)this.dataView.setUint32(n,a);else throw new Error(`Invalid length for length field: ${e}`);this.indent-=1,this.indents[this.offset]=this.indent}}writeLengthUint8(e){return this._writeLengthGeneric(1,!1,e)}writeLengthUint16(e){return this._writeLengthGeneric(2,!1,e)}writeLengthUint24(e){return this._writeLengthGeneric(3,!1,e)}writeLengthUint32(e){return this._writeLengthGeneric(4,!1,e)}writeLengthUint8Incl(e){return this._writeLengthGeneric(1,!0,e)}writeLengthUint16Incl(e){return this._writeLengthGeneric(2,!0,e)}writeLengthUint24Incl(e){return this._writeLengthGeneric(3,!0,e)}writeLengthUint32Incl(e){return this._writeLengthGeneric(4,!0,e)}array(){return this.data.subarray(0,this.offset)}commentedString(e=!1){let t=this.indents[0]!==void 0?lt.repeat(this.indents[0]):"",r=this.indents[0]??0,n=e?this.data.length:this.offset;for(let o=0;o<n;o++){t+=this.data[o].toString(16).padStart(2,"0")+" ";let a=this.comments[o+1];this.indents[o+1]!==void 0&&(r=this.indents[o+1]),a&&(t+=` ${a}
${lt.repeat(r)}`)}return t}};var Me=new RegExp(`  .+|^(${lt})+`,"gm");function dt(i,e=!0){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},r=/\bhttps?:[/][/][^\s\u200b"'<>)]+[^\s\u200b"'<>).,:;?!]\b/,n=new RegExp((e?`\\[[^\\]\\n]+\\]\\(${r.source}\\)|${r.source}|`:"")+"["+Object.keys(t).join("")+"]","gi");return i.replace(n,a=>{if(a.length===1)return t[a];let s,c;if(a.charAt(0)==="["){let h=a.indexOf("]");s=dt(a.substring(1,h),!1),c=dt(a.substring(h+2,a.length-1),!1)}else c=s=dt(a,!1);return`<a href="${c}" target="_blank">${s}</a>`})}function ge(...i){let e="<span>",t,r,n="";for(;(t=i.shift())!==void 0;){t=n+dt(String(t)),n=" ";let o=/([\s\S]*?)%([csoOidf])|[\s\S]+/g;for(;(r=o.exec(t))!==null;){let[a,s,c]=r;c===void 0?e+=a:(e+=s,c==="c"?e+=`</span><span style="${i.shift()}">`:c==="s"?e+=dt(i.shift()):c==="o"||c==="O"?e+=JSON.stringify(i.shift(),void 0,c==="O"?2:void 0):(c==="i"||c==="d"||c==="f")&&(e+=String(i.shift())))}}return e+="</span>",e}var me=0;function gt(...i){if(console.log(...i,`
`),typeof document>"u")return;let e=document.documentElement,t=e.scrollTop>=e.scrollHeight-e.clientHeight-1||e.clientHeight>=e.scrollHeight,r=document.querySelector("#logs");r.innerHTML+=`<label><input type="checkbox" name="c${me++}" checked="checked"><div class="section">`+ge(...i)+"</div></label>",t&&window.scrollTo({top:99999,behavior:"auto"})}function Dt(i,e,t,r=!0){let n=new x(1024);n.writeUint8(22,0),n.writeUint16(769,0);let o=n.writeLengthUint16();n.writeUint8(1,0);let a=n.writeLengthUint24();n.writeUint16(771,0),crypto.getRandomValues(n.subarray(32));let s=n.writeLengthUint8(0);n.writeBytes(t),s();let c=n.writeLengthUint16(0);n.writeUint16(4865,0),c();let h=n.writeLengthUint8(0);n.writeUint8(0,0),h();let m=n.writeLengthUint16(0);if(r){n.writeUint16(0,0);let A=n.writeLengthUint16(0),z=n.writeLengthUint16(0);n.writeUint8(0,0);let q=n.writeLengthUint16(0);n.writeUTF8String(i),q(),z(),A()}n.writeUint16(11,0);let l=n.writeLengthUint16(0),g=n.writeLengthUint8(0);n.writeUint8(0,0),g(),l(),n.writeUint16(10,0);let d=n.writeLengthUint16(0),S=n.writeLengthUint16(0);n.writeUint16(23,0),S(),d(),n.writeUint16(13,0);let T=n.writeLengthUint16(0),p=n.writeLengthUint16(0);n.writeUint16(1027,0),n.writeUint16(2052,0),p(),T(),n.writeUint16(43,0);let f=n.writeLengthUint16(0),U=n.writeLengthUint8(0);n.writeUint16(772,0),U(),f(),n.writeUint16(51,0);let M=n.writeLengthUint16(0),O=n.writeLengthUint16(0);n.writeUint16(23,0);let j=n.writeLengthUint16(0);return n.writeBytes(new Uint8Array(e)),j(),O(),M(),m(),a(),o(),n}function V(i,e=""){return[...i].map(t=>t.toString(16).padStart(2,"0")).join(e)}function Nt(i,e){let t,r,[n]=i.expectLength(i.remaining());i.expectUint8(2,0);let[o]=i.expectLengthUint24(0);i.expectUint16(771,0);let a=i.readBytes(32);if(Y(a,[207,33,173,116,229,154,97,17,190,29,140,2,30,101,184,145,194,162,17,22,122,187,140,94,7,158,9,226,200,168,51,156]))throw new Error("Unexpected HelloRetryRequest");i.expectUint8(e.length,0),i.expectBytes(e,0),i.expectUint16(4865,0),i.expectUint8(0,0);let[s,c]=i.expectLengthUint16(0);for(;c()>0;){let h=i.readUint16(0),[m]=i.expectLengthUint16(0);if(h===43)i.expectUint16(772,0),r=!0;else if(h===51)i.expectUint16(23,0),i.expectUint16(65),t=i.readBytes(65);else throw new Error(`Unexpected extension 0x${V([h])}`);m()}if(s(),o(),n(),r!==!0)throw new Error("No TLS version provided");if(t===void 0)throw new Error("No key provided");return t}var mt=1<<14,ye=mt+1+255;async function xt(i,e,t=mt){let n=await i(5);if(n===void 0)return;if(n.length<5)throw new Error("TLS record header truncated");let o=new x(n),a=o.readUint8();if(a<20||a>24)throw new Error(`Illegal TLS record type 0x${a.toString(16)}`);if(e!==void 0&&a!==e)throw new Error(`Unexpected TLS record type 0x${a.toString(16).padStart(2,"0")} (expected 0x${e.toString(16).padStart(2,"0")})`);o.expectUint16(771,"TLS record version 1.2 (middlebox compatibility)");let s=o.readUint16(0);if(s>t)throw new Error(`Record too long: ${s} bytes`);let c=await i(s);if(c===void 0||c.length<s)throw new Error("TLS record content truncated");return{headerData:n,header:o,type:a,length:s,content:c}}async function At(i,e,t){let r=await xt(i,23,ye);if(r===void 0)return;let n=new x(r.content),[o]=n.expectLength(n.remaining());n.skip(r.length-16,0),n.skip(16,0),o();let a=await e.process(r.content,16,r.headerData),s=a.length-1;for(;a[s]===0;)s-=1;if(s<0)throw new Error("Decrypted message has no record type indicator (all zeroes)");let c=a[s],h=a.subarray(0,s);if(!(c===21&&h.length===2&&h[0]===1&&h[1]===0)){if(c===22&&h[0]===4)return At(i,e,t);if(t!==void 0&&c!==t)throw new Error(`Unexpected TLS record type 0x${c.toString(16).padStart(2,"0")} (expected 0x${t.toString(16).padStart(2,"0")})`);return h}}async function ue(i,e,t){let r=C(i,[t]),n=5,s=r.length+16,c=new x(n+s);c.writeUint8(23,0),c.writeUint16(771,0),c.writeUint16(s,`${s} bytes follow`);let[h]=c.expectLength(s),m=c.array(),l=await e.process(r,16,m);return c.writeBytes(l.subarray(0,l.length-16)),c.writeBytes(l.subarray(l.length-16)),h(),c.array()}async function kt(i,e,t){let r=Math.ceil(i.length/mt),n=[];for(let o=0;o<r;o++){let a=i.subarray(o*mt,(o+1)*mt),s=await ue(a,e,t);n.push(s)}return n}var y=crypto.subtle;var Vt=new TextEncoder;async function St(i,e,t){let r=await y.importKey("raw",i,{name:"HMAC",hash:{name:`SHA-${t}`}},!1,["sign"]);var n=new Uint8Array(await y.sign("HMAC",r,e));return n}async function pe(i,e,t,r){let n=r>>3,o=Math.ceil(t/n),a=new Uint8Array(o*n),s=await y.importKey("raw",i,{name:"HMAC",hash:{name:`SHA-${r}`}},!1,["sign"]),c=new Uint8Array(0);for(let h=0;h<o;h++){let m=C(c,e,[h+1]),l=await y.sign("HMAC",s,m),g=new Uint8Array(l);a.set(g,n*h),c=g}return a.subarray(0,t)}var Pt=Vt.encode("tls13 ");async function v(i,e,t,r,n){let o=Vt.encode(e),a=C([(r&65280)>>8,r&255],[Pt.length+o.length],Pt,o,[t.length],t);return pe(i,a,r,n)}async function jt(i,e,t,r,n){let o=r>>>3,a=new Uint8Array(o),s=await y.importKey("raw",i,{name:"ECDH",namedCurve:"P-256"},!1,[]),c=await y.deriveBits({name:"ECDH",public:s},e,256),h=new Uint8Array(c),m=await y.digest("SHA-256",t),l=new Uint8Array(m),g=await St(new Uint8Array(1),a,r),d=await y.digest(`SHA-${r}`,new Uint8Array(0)),S=new Uint8Array(d),T=await v(g,"derived",S,o,r),p=await St(T,h,r),f=await v(p,"c hs traffic",l,o,r),U=await v(p,"s hs traffic",l,o,r),M=await v(f,"key",new Uint8Array(0),n,r),O=await v(U,"key",new Uint8Array(0),n,r),j=await v(f,"iv",new Uint8Array(0),12,r),A=await v(U,"iv",new Uint8Array(0),12,r);return{serverHandshakeKey:O,serverHandshakeIV:A,clientHandshakeKey:M,clientHandshakeIV:j,handshakeSecret:p,clientSecret:f,serverSecret:U}}async function Qt(i,e,t,r){let n=t>>>3,o=new Uint8Array(n),a=await y.digest(`SHA-${t}`,new Uint8Array(0)),s=new Uint8Array(a),c=await v(i,"derived",s,n,t),h=await St(c,o,t),m=await v(h,"c ap traffic",e,n,t),l=await v(h,"s ap traffic",e,n,t),g=await v(m,"key",new Uint8Array(0),r,t),d=await v(l,"key",new Uint8Array(0),r,t),S=await v(m,"iv",new Uint8Array(0),12,t),T=await v(l,"iv",new Uint8Array(0),12,t);return{serverApplicationKey:d,serverApplicationIV:T,clientApplicationKey:g,clientApplicationIV:S}}var rt=class{constructor(e,t,r){this.mode=e;this.key=t;this.initialIv=r}recordsProcessed=0n;priorPromise=Promise.resolve(new Uint8Array);async process(e,t,r){let n=this.processUnsequenced(e,t,r);return this.priorPromise=this.priorPromise.then(()=>n)}async processUnsequenced(e,t,r){let n=this.recordsProcessed;this.recordsProcessed+=1n;let o=this.initialIv.slice(),a=BigInt(o.length),s=a-1n;for(let g=0n;g<a;g++){let d=n>>(g<<3n);if(d===0n)break;o[Number(s-g)]^=Number(d&0xffn)}let c=t<<3,h={name:"AES-GCM",iv:o,tagLength:c,additionalData:r},m=await y[this.mode](h,this.key,e);return new Uint8Array(m)}};function Ut(i){return i>64&&i<91?i-65:i>96&&i<123?i-71:i>47&&i<58?i+4:i===43?62:i===47?63:i===61?64:void 0}function $t(i){let e=i.length,t=0,r=0,n=64,o=64,a=64,s=64,c=new Uint8Array(e*.75);for(;t<e;)n=Ut(i.charCodeAt(t++)),o=Ut(i.charCodeAt(t++)),a=Ut(i.charCodeAt(t++)),s=Ut(i.charCodeAt(t++)),c[r++]=n<<2|o>>4,c[r++]=(o&15)<<4|a>>2,c[r++]=(a&3)<<6|s;let h=o===64?0:a===64?2:s===64?1:0;return c.subarray(0,r-h)}var Z=class extends x{readASN1Length(e){let t=this.readUint8();if(t<128)return t;let r=t&127,n=0;if(r===1)return this.readUint8(n);if(r===2)return this.readUint16(n);if(r===3)return this.readUint24(n);if(r===4)return this.readUint32(n);throw new Error(`ASN.1 length fields are only supported up to 4 bytes (this one is ${r} bytes)`)}expectASN1Length(e){let t=this.readASN1Length(e);return this.expectLength(t)}readASN1OID(){let[e,t]=this.expectASN1Length(0),r=this.readUint8(),n=`${Math.floor(r/40)}.${r%40}`;for(;t()>0;){let o=0;for(;;){let a=this.readUint8();if(o<<=7,o+=a&127,a<128)break}n+=`.${o}`}return e(),n}readASN1Boolean(){let[e,t]=this.expectASN1Length(0),r=t();if(r!==1)throw new Error(`Boolean has weird length: ${r}`);let n=this.readUint8(),o;if(n===255)o=!0;else if(n===0)o=!1;else throw new Error(`Boolean has weird value: 0x${V([n])}`);return e(),o}readASN1UTCTime(){let[e,t]=this.expectASN1Length(0),n=this.readUTF8String(t()).match(/^(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z$/);if(!n)throw new Error("Unrecognised ASN.1 UTC time format");let[,o,a,s,c,h,m]=n,l=parseInt(o,10),g=l+(l>=50?1900:2e3),d=new Date(`${g}-${a}-${s}T${c}:${h}:${m}Z`);return e(),d}readASN1BitString(){let[e,t]=this.expectASN1Length(0),r=this.readUint8(0),n=t(),o=this.readBytes(n);if(r>7)throw new Error(`Invalid right pad value: ${r}`);if(r>0){let a=8-r;for(let s=n-1;s>0;s--)o[s]=255&o[s-1]<<a|o[s]>>>r;o[0]=o[0]>>>r}return e(),o}};function bt(i,e=(r,n)=>n,t){return JSON.stringify(i,(n,o)=>e(n,typeof o!="object"||o===null||Array.isArray(o)?o:Object.fromEntries(Object.entries(o).sort(([a],[s])=>a<s?-1:a>s?1:0))),t)}var Ct=1,at=2,D=48,fe=49,it=6,we=19,xe=12,Ht=23,Et=5,_=4,Tt=3,Gt=163,st=128;var Ae={"2.5.4.6":"C","2.5.4.10":"O","2.5.4.11":"OU","2.5.4.3":"CN","2.5.4.7":"L","2.5.4.8":"ST","2.5.4.12":"T","2.5.4.42":"GN","2.5.4.43":"I","2.5.4.4":"SN","1.2.840.113549.1.9.1":"E-mail"};function Yt(i){let{length:e}=i;if(e>4)throw new Error(`Bit string length ${e} would overflow JS bit operators`);let t=0,r=0;for(let n=i.length-1;n>=0;n--)t|=i[n]<<r,r+=8;return t}function Kt(i,e){let t={};i.expectUint8(D,0);let[r,n]=i.expectASN1Length(0);for(;n()>0;){i.expectUint8(fe,0);let[o]=i.expectASN1Length(0);i.expectUint8(D,0);let[a]=i.expectASN1Length(0);i.expectUint8(it,0);let s=i.readASN1OID(),c=Ae[s]??s,h=i.readUint8();if(h!==we){if(h!==xe)throw new Error(`Unexpected item type in certificate ${e}: 0x${V([h])}`)}let[m,l]=i.expectASN1Length(0),g=i.readUTF8String(l());if(m(),a(),o(),t[c]!==void 0)throw new Error(`Duplicate OID ${c} in certificate ${e}`);t[c]=g}return r(),t}function Wt(i,e=0){let t=[],[r,n]=i.expectASN1Length(0);for(;n()>0;){let o=i.readUint8(0),[a,s]=i.expectASN1Length(0),c;o===(e|2)?c=i.readUTF8String(s()):c=i.readBytes(s()),t.push({name:c,type:o}),a()}return r(),t}function zt(i){let e={"1.2.840.113549.1.1.1":{name:"RSAES-PKCS1-v1_5"},"1.2.840.113549.1.1.5":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}},"1.2.840.113549.1.1.11":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},"1.2.840.113549.1.1.12":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},"1.2.840.113549.1.1.13":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}},"1.2.840.113549.1.1.10":{name:"RSA-PSS"},"1.2.840.113549.1.1.7":{name:"RSA-OAEP"},"1.2.840.10045.2.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.3.2":{name:"ECDSA",hash:{name:"SHA-256"}},"1.2.840.10045.4.3.3":{name:"ECDSA",hash:{name:"SHA-384"}},"1.2.840.10045.4.3.4":{name:"ECDSA",hash:{name:"SHA-512"}},"1.3.133.16.840.63.0.2":{name:"ECDH",kdf:"SHA-1"},"1.3.132.1.11.1":{name:"ECDH",kdf:"SHA-256"},"1.3.132.1.11.2":{name:"ECDH",kdf:"SHA-384"},"1.3.132.1.11.3":{name:"ECDH",kdf:"SHA-512"},"2.16.840.1.101.3.4.1.2":{name:"AES-CBC",length:128},"2.16.840.1.101.3.4.1.22":{name:"AES-CBC",length:192},"2.16.840.1.101.3.4.1.42":{name:"AES-CBC",length:256},"2.16.840.1.101.3.4.1.6":{name:"AES-GCM",length:128},"2.16.840.1.101.3.4.1.26":{name:"AES-GCM",length:192},"2.16.840.1.101.3.4.1.46":{name:"AES-GCM",length:256},"2.16.840.1.101.3.4.1.4":{name:"AES-CFB",length:128},"2.16.840.1.101.3.4.1.24":{name:"AES-CFB",length:192},"2.16.840.1.101.3.4.1.44":{name:"AES-CFB",length:256},"2.16.840.1.101.3.4.1.5":{name:"AES-KW",length:128},"2.16.840.1.101.3.4.1.25":{name:"AES-KW",length:192},"2.16.840.1.101.3.4.1.45":{name:"AES-KW",length:256},"1.2.840.113549.2.7":{name:"HMAC",hash:{name:"SHA-1"}},"1.2.840.113549.2.9":{name:"HMAC",hash:{name:"SHA-256"}},"1.2.840.113549.2.10":{name:"HMAC",hash:{name:"SHA-384"}},"1.2.840.113549.2.11":{name:"HMAC",hash:{name:"SHA-512"}},"1.2.840.113549.1.9.16.3.5":{name:"DH"},"1.3.14.3.2.26":{name:"SHA-1"},"2.16.840.1.101.3.4.2.1":{name:"SHA-256"},"2.16.840.1.101.3.4.2.2":{name:"SHA-384"},"2.16.840.1.101.3.4.2.3":{name:"SHA-512"},"1.2.840.113549.1.5.12":{name:"PBKDF2"},"1.2.840.10045.3.1.7":{name:"P-256"},"1.3.132.0.34":{name:"P-384"},"1.3.132.0.35":{name:"P-521"}}[i];if(e===void 0)throw new Error(`Unsupported algorithm identifier: ${i}`);return e}function Jt(i,e=[]){return Object.values(i).forEach(t=>{typeof t=="string"?e=[...e,t]:e=Jt(t,e)}),e}function Zt(i){return Jt(i).join(" / ")}var Se=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],W=class{serialNumber;algorithm;issuer;validityPeriod;subject;publicKey;signature;keyUsage;subjectAltNames;extKeyUsage;authorityKeyIdentifier;subjectKeyIdentifier;basicConstraints;signedData;static distinguishedNamesAreEqual(e,t){return bt(e)===bt(t)}static readableDN(e){return Object.entries(e).map(t=>t.join("=")).join(", ")}constructor(e){let t=e instanceof Z?e:new Z(e);t.expectUint8(D,0);let[r]=t.expectASN1Length(0),n=t.offset;t.expectUint8(D,0);let[o]=t.expectASN1Length(0);t.expectBytes([160,3,2,1,2],0),t.expectUint8(at,0);let[a,s]=t.expectASN1Length(0);this.serialNumber=t.subarray(s()),a(),t.expectUint8(D,0);let[c,h]=t.expectASN1Length(0);t.expectUint8(it,0),this.algorithm=t.readASN1OID(),h()>0&&(t.expectUint8(Et,0),t.expectUint8(0,0)),c(),this.issuer=Kt(t,"issuer"),t.expectUint8(D,0);let[m]=t.expectASN1Length(0);t.expectUint8(Ht,0);let l=t.readASN1UTCTime();t.expectUint8(Ht,0);let g=t.readASN1UTCTime();this.validityPeriod={notBefore:l,notAfter:g},m(),this.subject=Kt(t,"subject");let d=t.offset;t.expectUint8(D,0);let[S]=t.expectASN1Length(0);t.expectUint8(D,0);let[T,p]=t.expectASN1Length(0),f=[];for(;p()>0;){let H=t.readUint8();if(H===it){let J=t.readASN1OID();f.push(J)}else H===Et&&t.expectUint8(0,0)}T(),t.expectUint8(Tt,0);let U=t.readASN1BitString();this.publicKey={identifiers:f,data:U,all:t.data.subarray(d,t.offset)},S(),t.expectUint8(Gt,0);let[M]=t.expectASN1Length();t.expectUint8(D,0);let[O,j]=t.expectASN1Length(0);for(;j()>0;){t.expectUint8(D,0);let[H,J]=t.expectASN1Length();t.expectUint8(it,0);let K=t.readASN1OID();if(K==="2.5.29.17"){t.expectUint8(_,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let L=Wt(t,st);this.subjectAltNames=L.filter(b=>b.type===(2|st)).map(b=>b.name),I()}else if(K==="2.5.29.15"){t.expectUint8(Ct,0);let I=t.readASN1Boolean();t.expectUint8(_,0);let[L]=t.expectASN1Length(0);t.expectUint8(Tt,0);let b=t.readASN1BitString(),R=Yt(b),u=new Set(Se.filter((E,$)=>R&1<<$));L(),this.keyUsage={critical:I,usages:u}}else if(K==="2.5.29.37"){this.extKeyUsage={},t.expectUint8(_,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let[L,b]=t.expectASN1Length(0);for(;b()>0;){t.expectUint8(it,0);let R=t.readASN1OID();R==="1.3.6.1.5.5.7.3.1"&&(this.extKeyUsage.serverTls=!0),R==="1.3.6.1.5.5.7.3.2"&&(this.extKeyUsage.clientTls=!0)}L(),I()}else if(K==="2.5.29.35"){t.expectUint8(_,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let[L,b]=t.expectASN1Length(0);for(;b()>0;){let R=t.readUint8();if(R===(st|0)){let[u,E]=t.expectASN1Length(0);this.authorityKeyIdentifier=t.readBytes(E()),u()}else if(R===(st|1)){let[u,E]=t.expectASN1Length(0);t.skip(E(),0),u()}else if(R===(st|2)){let[u,E]=t.expectASN1Length(0);t.skip(E(),0),u()}else if(R===(st|33)){let[u,E]=t.expectASN1Length(0);t.skip(E(),0),u()}else throw new Error(`Unexpected data type ${R} in authorityKeyIdentifier certificate extension`)}L(),I()}else if(K==="2.5.29.14"){t.expectUint8(_,0);let[I]=t.expectASN1Length(0);t.expectUint8(_,0);let[L,b]=t.expectASN1Length(0);this.subjectKeyIdentifier=t.readBytes(b()),L(),I()}else if(K==="2.5.29.19"){let I,L=t.readUint8();if(L===Ct&&(I=t.readASN1Boolean(),L=t.readUint8()),L!==_)throw new Error("Unexpected type in certificate basic constraints");let[b]=t.expectASN1Length(0);t.expectUint8(D,0);let[R,u]=t.expectASN1Length(),E;u()>0&&(t.expectUint8(Ct,0),E=t.readASN1Boolean());let $;if(u()>0){t.expectUint8(at,0);let w=t.readASN1Length(0);if($=w===1?t.readUint8():w===2?t.readUint16():w===3?t.readUint24():void 0,$===void 0)throw new Error("Too many bytes in max path length in certificate basicConstraints")}R(),b(),this.basicConstraints={critical:I,ca:E,pathLength:$}}else t.skip(J(),0);H()}O(),M(),o(),this.signedData=t.data.subarray(n,t.offset),t.expectUint8(D,0);let[A,z]=t.expectASN1Length(0);t.expectUint8(it,0);let q=t.readASN1OID();if(z()>0&&(t.expectUint8(Et,0),t.expectUint8(0,0)),A(),q!==this.algorithm)throw new Error(`Certificate specifies different signature algorithms inside (${this.algorithm}) and out (${q})`);t.expectUint8(Tt,0),this.signature=t.readASN1BitString(),r()}static fromPEM(e){let t="[A-Z0-9 ]+",r=new RegExp(`-{5}BEGIN ${t}-{5}([a-zA-Z0-9=+\\/\\n\\r]+)-{5}END ${t}-{5}`,"g"),n=[],o=null;for(;o=r.exec(e);){let a=o[1].replace(/[\r\n]/g,""),s=$t(a),c=new this(s);n.push(c)}return n}subjectAltNameMatchingHost(e){let t=/[.][^.]+[.][^.]+$/;return(this.subjectAltNames??[]).find(r=>{let n=r,o=e;if(t.test(e)&&t.test(n)&&n.startsWith("*.")&&(n=n.slice(1),o=o.slice(o.indexOf("."))),n===o)return!0})}isValidAtMoment(e=new Date){return e>=this.validityPeriod.notBefore&&e<=this.validityPeriod.notAfter}description(){return"subject: "+W.readableDN(this.subject)+(this.subjectAltNames?`
subject alt names: `+this.subjectAltNames.join(", "):"")+(this.subjectKeyIdentifier?`
subject key id: ${V(this.subjectKeyIdentifier," ")}`:"")+`
issuer: `+W.readableDN(this.issuer)+(this.authorityKeyIdentifier?`
authority key id: ${V(this.authorityKeyIdentifier," ")}`:"")+`
validity: `+this.validityPeriod.notBefore.toISOString()+" \u2013 "+this.validityPeriod.notAfter.toISOString()+` (${this.isValidAtMoment()?"currently valid":"not valid"})`+(this.keyUsage?`
key usage (${this.keyUsage.critical?"critical":"non-critical"}): `+[...this.keyUsage.usages].join(", "):"")+(this.extKeyUsage?`
extended key usage: TLS server \u2014\xA0${this.extKeyUsage.serverTls}, TLS client \u2014\xA0${this.extKeyUsage.clientTls}`:"")+(this.basicConstraints?`
basic constraints (${this.basicConstraints.critical?"critical":"non-critical"}): CA \u2014\xA0${this.basicConstraints.ca}, path length \u2014 ${this.basicConstraints.pathLength}`:"")+`
signature algorithm: `+Zt(zt(this.algorithm))}toJSON(){return{serialNumber:[...this.serialNumber],algorithm:this.algorithm,issuer:this.issuer,validityPeriod:{notBefore:this.validityPeriod.notBefore.toISOString(),notAfter:this.validityPeriod.notAfter.toISOString()},subject:this.subject,publicKey:{identifiers:this.publicKey.identifiers,data:[...this.publicKey.data],all:[...this.publicKey.all]},signature:[...this.signature],keyUsage:{critical:this.keyUsage?.critical,usages:[...this.keyUsage?.usages??[]]},subjectAltNames:this.subjectAltNames,extKeyUsage:this.extKeyUsage,authorityKeyIdentifier:this.authorityKeyIdentifier&&[...this.authorityKeyIdentifier],subjectKeyIdentifier:this.subjectKeyIdentifier&&[...this.subjectKeyIdentifier],basicConstraints:this.basicConstraints,signedData:[...this.signedData]}}},tt=class extends W{};async function Lt(i,e,t,r,n){i.expectUint8(D,0);let[o]=i.expectASN1Length(0);i.expectUint8(at,0);let[a,s]=i.expectASN1Length(0),c=i.readBytes(s());a(),i.expectUint8(at,0);let[h,m]=i.expectASN1Length(0),l=i.readBytes(m());h(),o();let g=(f,U)=>f.length>U?f.subarray(f.length-U):f.length<U?C(new Uint8Array(U-f.length),f):f,d=r==="P-256"?32:48,S=C(g(c,d),g(l,d)),T=await y.importKey("spki",e,{name:"ECDSA",namedCurve:r},!1,["verify"]);if(await y.verify({name:"ECDSA",hash:n},T,S,t)!==!0)throw new Error("ECDSA-SECP256R1-SHA256 certificate verify failed")}async function Xt(i,e,t,r=!0,n=!0){for(let h of e);let o=e[0];if(o.subjectAltNameMatchingHost(i)===void 0)throw new Error(`No matching subjectAltName for ${i}`);if(!o.isValidAtMoment())throw new Error("End-user certificate is not valid now");if(r&&!o.extKeyUsage?.serverTls)throw new Error("End-user certificate has no TLS server extKeyUsage");let c=!1;for(let h of t);for(let h=0,m=e.length;h<m;h++){let l=e[h],g=l.authorityKeyIdentifier,d;if(g===void 0?d=t.find(p=>W.distinguishedNamesAreEqual(p.subject,l.issuer)):d=t.find(p=>p.subjectKeyIdentifier!==void 0&&Y(p.subjectKeyIdentifier,g)),d===void 0&&(d=e[h+1]),d===void 0)throw new Error("Ran out of certificates before reaching trusted root");let S=d instanceof tt;if(d.isValidAtMoment()!==!0)throw new Error("Signing certificate is not valid now");if(n&&d.keyUsage?.usages.has("digitalSignature")!==!0)throw new Error("Signing certificate keyUsage does not include digital signatures");if(d.basicConstraints?.ca!==!0)throw new Error("Signing certificate basicConstraints do not indicate a CA certificate");let{pathLength:T}=d.basicConstraints;if(T!==void 0&&T<h)throw new Error("Exceeded certificate path length");if(l.algorithm==="1.2.840.10045.4.3.2"||l.algorithm==="1.2.840.10045.4.3.3"){let p=l.algorithm==="1.2.840.10045.4.3.2"?"SHA-256":"SHA-384",f=d.publicKey.identifiers,U=f.includes("1.2.840.10045.3.1.7")?"P-256":f.includes("1.3.132.0.34")?"P-384":void 0;if(U===void 0)throw new Error("Unsupported signing key curve");let M=new Z(l.signature);await Lt(M,d.publicKey.all,l.signedData,U,p)}else if(l.algorithm==="1.2.840.113549.1.1.11"||l.algorithm==="1.2.840.113549.1.1.12"){let p=l.algorithm==="1.2.840.113549.1.1.11"?"SHA-256":"SHA-384",f=await y.importKey("spki",d.publicKey.all,{name:"RSASSA-PKCS1-v1_5",hash:p},!1,["verify"]);if(await y.verify({name:"RSASSA-PKCS1-v1_5"},f,l.signature,l.signedData)!==!0)throw new Error("RSASSA_PKCS1-v1_5-SHA256 certificate verify failed")}else throw new Error("Unsupported signing algorithm");if(S){c=!0;break}}return c}var Ue=new TextEncoder;async function _t(i,e,t,r,n,o=!0,a=!0){let s=new Z(await e());s.expectUint8(8,0);let[c]=s.expectLengthUint24(),[h,m]=s.expectLengthUint16(0);for(;m()>0;){let N=s.readUint16(0);if(N===0)s.expectUint16(0,0);else if(N===10){let[Q,P]=s.expectLengthUint16("groups data");s.skip(P(),0),Q()}else throw new Error(`Unsupported server encrypted extension type 0x${V([N]).padStart(4,"0")}`)}h(),c(),s.remaining()===0&&s.extend(await e());let l=!1,g=s.readUint8();if(g===13){l=!0;let[N]=s.expectLengthUint24("certificate request data");s.expectUint8(0,0);let[Q,P]=s.expectLengthUint16("certificate request extensions");s.skip(P(),0),Q(),N(),s.remaining()===0&&s.extend(await e()),g=s.readUint8()}if(g!==11)throw new Error(`Unexpected handshake message type 0x${V([g])}`);let[d]=s.expectLengthUint24(0);s.expectUint8(0,0);let[S,T]=s.expectLengthUint24(0),p=[];for(;T()>0;){let[N]=s.expectLengthUint24(0),Q=new W(s);p.push(Q),N();let[P,ot]=s.expectLengthUint16(),B=s.subarray(ot());P()}if(S(),d(),p.length===0)throw new Error("No certificates supplied");let f=p[0],U=s.data.subarray(0,s.offset),M=C(r,U),O=await y.digest("SHA-256",M),j=new Uint8Array(O),A=C(Ue.encode(" ".repeat(64)+"TLS 1.3, server CertificateVerify"),[0],j);s.remaining()===0&&s.extend(await e()),s.expectUint8(15,0);let[z]=s.expectLengthUint24(0),q=s.readUint16();if(q===1027){let[N]=s.expectLengthUint16();await Lt(s,f.publicKey.all,A,"P-256","SHA-256"),N()}else if(q===2052){let[N,Q]=s.expectLengthUint16(),P=s.subarray(Q());N();let ot=await y.importKey("spki",f.publicKey.all,{name:"RSA-PSS",hash:"SHA-256"},!1,["verify"]);if(await y.verify({name:"RSA-PSS",saltLength:32},ot,P,A)!==!0)throw new Error("RSA-PSS-RSAE-SHA256 certificate verify failed")}else throw new Error(`Unsupported certificate verify signature type 0x${V([q]).padStart(4,"0")}`);z();let H=s.data.subarray(0,s.offset),J=C(r,H),K=await v(t,"finished",new Uint8Array(0),32,256),I=await y.digest("SHA-256",J),L=await y.importKey("raw",K,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),b=await y.sign("HMAC",L,I),R=new Uint8Array(b);s.remaining()===0&&s.extend(await e()),s.expectUint8(20,0);let[u,E]=s.expectLengthUint24(0),$=s.readBytes(E());if(u(),s.remaining()!==0)throw new Error("Unexpected extra bytes in server handshake");if(Y($,R)!==!0)throw new Error("Invalid server verify hash");if(!await Xt(i,p,n,o,a))throw new Error("Validated certificate chain did not end in a trusted root");return[s.data,l]}async function yt(i,e,t,r,{useSNI:n,requireServerTlsExtKeyUsage:o,requireDigitalSigKeyUsage:a,writePreData:s,expectPreData:c,commentPreData:h}={}){n??=!0,o??=!0,a??=!0;let m=await y.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),l=await y.exportKey("raw",m.publicKey),g=new Uint8Array(32);crypto.getRandomValues(g);let S=Dt(i,l,g,n).array(),T=s?C(s,S):S;if(r(T),c){let k=await t(c.length);if(!k||!Y(k,c))throw new Error("Pre data did not match expectation")}let p=await xt(t,22);if(p===void 0)throw new Error("Connection closed while awaiting server hello");let f=new x(p.content),U=Nt(f,g),M=await xt(t,20);if(M===void 0)throw new Error("Connection closed awaiting server cipher change");let O=new x(M.content),[j]=O.expectLength(1);O.expectUint8(1,0),j();let A=S.subarray(5),z=p.content,q=C(A,z),H=await jt(U,m.privateKey,q,256,16),J=await y.importKey("raw",H.serverHandshakeKey,{name:"AES-GCM"},!1,["decrypt"]),K=new rt("decrypt",J,H.serverHandshakeIV),I=await y.importKey("raw",H.clientHandshakeKey,{name:"AES-GCM"},!1,["encrypt"]),L=new rt("encrypt",I,H.clientHandshakeIV),b=async()=>{let k=await At(t,K,22);if(k===void 0)throw new Error("Premature end of encrypted server handshake");return k},[R,u]=await _t(i,b,H.serverSecret,q,e,o,a),E=new x(6);E.writeUint8(20,0),E.writeUint16(771,0);let $=E.writeLengthUint16();E.writeUint8(1,0),$();let w=E.array(),X=new Uint8Array(0);if(u){let k=new x(8);k.writeUint8(11,0);let ht=k.writeLengthUint24("client certificate data");k.writeUint8(0,0),k.writeUint24(0,0),ht(),X=k.array()}let N=C(q,R,X),Q=await y.digest("SHA-256",N),P=new Uint8Array(Q),ot=await v(H.clientSecret,"finished",new Uint8Array(0),32,256),B=await y.importKey("raw",ot,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),F=await y.sign("HMAC",B,P),et=new Uint8Array(F),G=new x(36);G.writeUint8(20,0);let nt=G.writeLengthUint24(0);G.writeBytes(et),nt();let ct=G.array(),ut=await kt(C(X,ct),L,22),pt=P;if(X.length>0){let k=N.subarray(0,N.length-X.length),ht=await y.digest("SHA-256",k);pt=new Uint8Array(ht)}let ft=await Qt(H.handshakeSecret,pt,256,16),oe=await y.importKey("raw",ft.clientApplicationKey,{name:"AES-GCM"},!0,["encrypt"]),ae=new rt("encrypt",oe,ft.clientApplicationIV),ce=await y.importKey("raw",ft.serverApplicationKey,{name:"AES-GCM"},!0,["decrypt"]),he=new rt("decrypt",ce,ft.serverApplicationIV),wt=!1;return[()=>{if(!wt){let k=C(w,...ut);r(k),wt=!0}return At(t,he)},async k=>{let ht=wt;wt=!0;let Ot=await kt(k,ae,23),le=ht?C(...Ot):C(w,...ut,...Ot);r(le)}]}var vt=`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
TzELMAkGA1UEBhMCVVMxKTAnBgNVBAoTIEludGVybmV0IFNlY3VyaXR5IFJlc2Vh
cmNoIEdyb3VwMRUwEwYDVQQDEwxJU1JHIFJvb3QgWDEwHhcNMTUwNjA0MTEwNDM4
WhcNMzUwNjA0MTEwNDM4WjBPMQswCQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJu
ZXQgU2VjdXJpdHkgUmVzZWFyY2ggR3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBY
MTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAK3oJHP0FDfzm54rVygc
h77ct984kIxuPOZXoHj3dcKi/vVqbvYATyjb3miGbESTtrFj/RQSa78f0uoxmyF+
0TM8ukj13Xnfs7j/EvEhmkvBioZxaUpmZmyPfjxwv60pIgbz5MDmgK7iS4+3mX6U
A5/TR5d8mUgjU+g4rk8Kb4Mu0UlXjIB0ttov0DiNewNwIRt18jA8+o+u3dpjq+sW
T8KOEUt+zwvo/7V3LvSye0rgTBIlDHCNAymg4VMk7BPZ7hm/ELNKjD+Jo2FR3qyH
B5T0Y3HsLuJvW5iB4YlcNHlsdu87kGJ55tukmi8mxdAQ4Q7e2RCOFvu396j3x+UC
B5iPNgiV5+I3lg02dZ77DnKxHZu8A/lJBdiB3QW0KtZB6awBdpUKD9jf1b0SHzUv
KBds0pjBqAlkd25HN7rOrFleaJ1/ctaJxQZBKT5ZPt0m9STJEadao0xAH0ahmbWn
OlFuhjuefXKnEgV4We0+UXgVCwOPjdAvBbI+e0ocS3MFEvzG6uBQE3xDk3SzynTn
jh8BCNAw1FtxNrQHusEwMFxIt4I7mKZ9YIqioymCzLq9gwQbooMDQaHWBfEbwrbw
qHyGO0aoSCqI3Haadr8faqU9GY/rOPNk3sgrDQoo//fb4hVC1CLQJ13hef4Y53CI
rU7m2Ys6xt0nUW7/vGT1M0NPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNV
HRMBAf8EBTADAQH/MB0GA1UdDgQWBBR5tFnme7bl5AFzgAiIyBpY9umbbjANBgkq
hkiG9w0BAQsFAAOCAgEAVR9YqbyyqFDQDLHYGmkgJykIrGF1XIpu+ILlaS/V9lZL
ubhzEFnTIZd+50xx+7LSYK05qAvqFyFWhfFQDlnrzuBZ6brJFe+GnY+EgPbk6ZGQ
3BebYhtF8GaV0nxvwuo77x/Py9auJ/GpsMiu/X1+mvoiBOv/2X/qkSsisRcOj/KK
NFtY2PwByVS5uCbMiogziUwthDyC3+6WVwW6LLv3xLfHTjuCvjHIInNzktHCgKQ5
ORAzI4JMPJ+GslWYHb4phowim57iaztXOoJwTdwJx4nLCgdNbOhdjsnvzqvHu7Ur
TkXWStAmzOVyyghqpZXjFaH3pO3JLF+l+/+sKAIuvtd7u+Nxe5AW0wdeRlN8NwdC
jNPElpzVmbUq4JUagEiuTDkHzsxHpFKVK7q4+63SM1N95R1NbdWhscdCb+ZAJzVc
oyi3B43njTOQ5yOf+1CceWxG1bQVs5ZufpsMljq4Ui0/1lvh+wjChP4kqKOJ2qxq
4RgqsahDYVvTH9w7jXbyLeiNdd8XM2w9U/t7y0Ff/9yi0GE44Za4rF2LN9d11TPA
mRGunUHBcnWEvgJBQl9nJEiU0Zsnvgc/ubhPgXRR4Xq37Z0j4r7g1SgEEzwxA57d
emyPxgcYxn/eR44/KJ4EBs+lVDR3veyJm+kXQ99b21/+jh5Xos1AnX5iItreGCc=
-----END CERTIFICATE-----
`;var It=`-----BEGIN CERTIFICATE-----
MIICGzCCAaGgAwIBAgIQQdKd0XLq7qeAwSxs6S+HUjAKBggqhkjOPQQDAzBPMQsw
CQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJuZXQgU2VjdXJpdHkgUmVzZWFyY2gg
R3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBYMjAeFw0yMDA5MDQwMDAwMDBaFw00
MDA5MTcxNjAwMDBaME8xCzAJBgNVBAYTAlVTMSkwJwYDVQQKEyBJbnRlcm5ldCBT
ZWN1cml0eSBSZXNlYXJjaCBHcm91cDEVMBMGA1UEAxMMSVNSRyBSb290IFgyMHYw
EAYHKoZIzj0CAQYFK4EEACIDYgAEzZvVn4CDCuwJSvMWSj5cz3es3mcFDR0HttwW
+1qLFNvicWDEukWVEYmO6gbf9yoWHKS5xcUy4APgHoIYOIvXRdgKam7mAHf7AlF9
ItgKbppbd9/w+kHsOdx1ymgHDB/qo0IwQDAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUfEKWrt5LSDv6kviejM9ti6lyN5UwCgYIKoZI
zj0EAwMDaAAwZQIwe3lORlCEwkSHRhtFcP9Ymd70/aTSVaYgLXTWNLxBo1BfASdW
tL4ndQavEi51mI38AjEAi/V3bNTIZargCyzuFJ0nN6T5U6VR5CmD1/iQMVtCnwr1
/q4AaOeMSQ+2b1tbFfLn
-----END CERTIFICATE-----
`;async function te(i,e){let t=Date.now(),r=Ee(i),n=r.hostname,o=/[.]neon[.]tech$/.test(n),a=!1,s=o,c=r.port||"5432",h=r.username,m=s?`project=${n.match(/^[^.]+/)[0]};${r.password}`:r.password,l=r.pathname.slice(1),g=!1,d=await e(n,c,()=>{if(!g)throw new Error("Unexpected connection close")}),S=new x(8),T=S.writeLengthUint32Incl(0);S.writeUint32(80877103,"[SSLRequest](https://www.postgresql.org/docs/current/protocol-message-formats.html#PROTOCOL-MESSAGE-FORMATS-SSLREQUEST) code"),T();let p=S.array();if(!a){d.write(p);let B=await d.read(1);new x(B).expectUint8(83,'"S" = SSL connection supported')}let f=new x(1);f.writeUTF8String("S");let U=f.array(),M=tt.fromPEM(vt+It),[O,j]=a?await yt(n,M,d.read,d.write,{useSNI:!s,requireServerTlsExtKeyUsage:!1,requireDigitalSigKeyUsage:!1,writePreData:p,expectPreData:U,commentPreData:'"S" = SSL connection supported'}):await yt(n,M,d.read,d.write,{useSNI:!s,requireServerTlsExtKeyUsage:!1,requireDigitalSigKeyUsage:!1}),A=new x(1024),z=A.writeLengthUint32Incl(0);A.writeUint32(196608,0),A.writeUTF8StringNullTerminated("user"),A.writeUTF8StringNullTerminated(h),A.writeUTF8StringNullTerminated("database"),A.writeUTF8StringNullTerminated(l),A.writeUint8(0,0),z(),A.writeUTF8String("p");let q=A.writeLengthUint32Incl(0);A.writeUTF8StringNullTerminated(m),q(),A.writeUTF8String("Q");let H=A.writeLengthUint32Incl(0);A.writeUTF8StringNullTerminated("SELECT now()"),H(),await j(A.array());let J=await O(),K=new x(J);K.expectUint8("R".charCodeAt(0),0);let[I,L]=K.expectLengthUint32Incl("request"),b=K.readUint32();if(b!==3)if(b===10){for(;L()>1;){let B=K.readUTF8StringNullTerminated()}K.expectUint8(0,"null terminated list")}else throw new Error(`Unsupported auth mechanism (${b})`);if(I(),b===10)throw new Error("Unsupported SCRAM-SHA-256 auth");let R=await O(),u=new x(R);u.expectUint8("R".charCodeAt(0),0);let[E]=u.expectLengthUint32Incl(0);for(u.expectUint32(0,0),E();u.remaining()>0;){let B=u.readUTF8String(1);if(B==="S"){let[F,et]=u.expectLengthUint32Incl(0);for(;et()>0;){let G=u.readUTF8StringNullTerminated(),nt=u.readUTF8StringNullTerminated()}F()}else if(B==="K"){let[F]=u.expectLengthUint32Incl();u.readUint32(0),u.readUint32(0),F()}else if(B==="Z"){let[F]=u.expectLengthUint32Incl(0);u.expectUint8("I".charCodeAt(0),0),F()}}let $=await O(),w=new x($);w.expectUint8("T".charCodeAt(0),0);let[X]=w.expectLengthUint32Incl(),N=w.readUint16(0);for(let B=0;B<N;B++){let F=w.readUTF8StringNullTerminated(),et=w.readUint32(0),G=w.readUint16(0),nt=w.readUint32(0),ct=w.readUint16(0),ut=w.readUint32(0),pt=w.readUint16(0)}X();let Q;for(;w.remaining()>0;){let B=w.readUTF8String(1);if(B==="D"){let[F]=w.expectLengthUint32Incl(),et=w.readUint16(0);for(let G=0;G<et;G++){let[nt,ct]=w.expectLengthUint32();Q=w.readUTF8String(ct()),nt()}F()}else if(B==="C"){let[F]=w.expectLengthUint32Incl();w.readUTF8StringNullTerminated(),F()}else if(B==="Z"){let[F]=w.expectLengthUint32Incl();w.expectUint8("I".charCodeAt(0),0),F()}else throw new Error(`Unexpected message type: ${B}`)}gt("%c%s","font-size: 2em",Q),gt(`time taken: ${Date.now()-t}ms`);let P=new x(5);P.writeUTF8String("X"),P.writeLengthUint32Incl()(),await j(P.array()),g=!0}function Ee(i,e=!1){let{protocol:t}=new URL(i),r="http:"+i.substring(t.length),{username:n,password:o,hostname:a,port:s,pathname:c,search:h,searchParams:m,hash:l}=new URL(r);o=decodeURIComponent(o);let g=n+":"+o,d=e?Object.fromEntries(m.entries()):h;return{href:i,protocol:t,auth:g,username:n,password:o,hostname:a,port:s,pathname:c,search:h,query:d,hash:l}}var ee=`-----BEGIN CERTIFICATE-----\r
MIIDdzCCAl+gAwIBAgIEAgAAuTANBgkqhkiG9w0BAQUFADBaMQswCQYDVQQGEwJJ\r
RTESMBAGA1UEChMJQmFsdGltb3JlMRMwEQYDVQQLEwpDeWJlclRydXN0MSIwIAYD\r
VQQDExlCYWx0aW1vcmUgQ3liZXJUcnVzdCBSb290MB4XDTAwMDUxMjE4NDYwMFoX\r
DTI1MDUxMjIzNTkwMFowWjELMAkGA1UEBhMCSUUxEjAQBgNVBAoTCUJhbHRpbW9y\r
ZTETMBEGA1UECxMKQ3liZXJUcnVzdDEiMCAGA1UEAxMZQmFsdGltb3JlIEN5YmVy\r
VHJ1c3QgUm9vdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKMEuyKr\r
mD1X6CZymrV51Cni4eiVgLGw41uOKymaZN+hXe2wCQVt2yguzmKiYv60iNoS6zjr\r
IZ3AQSsBUnuId9Mcj8e6uYi1agnnc+gRQKfRzMpijS3ljwumUNKoUMMo6vWrJYeK\r
mpYcqWe4PwzV9/lSEy/CG9VwcPCPwBLKBsua4dnKM3p31vjsufFoREJIE9LAwqSu\r
XmD+tqYF/LTdB1kC1FkYmGP1pWPgkAx9XbIGevOF6uvUA65ehD5f/xXtabz5OTZy\r
dc93Uk3zyZAsuT3lySNTPx8kmCFcB5kpvcY67Oduhjprl3RjM71oGDHweI12v/ye\r
jl0qhqdNkNwnGjkCAwEAAaNFMEMwHQYDVR0OBBYEFOWdWTCCR1jMrPoIVDaGezq1\r
BE3wMBIGA1UdEwEB/wQIMAYBAf8CAQMwDgYDVR0PAQH/BAQDAgEGMA0GCSqGSIb3\r
DQEBBQUAA4IBAQCFDF2O5G9RaEIFoN27TyclhAO992T9Ldcw46QQF+vaKSm2eT92\r
9hkTI7gQCvlYpNRhcL0EYWoSihfVCr3FvDB81ukMJY2GQE/szKN+OMY3EU/t3Wgx\r
jkzSswF07r51XgdIGn9w/xZchMB5hbgF/X++ZRGjD8ACtPhSNzkE1akxehi/oCr0\r
Epn3o0WC4zxe9Z2etciefC7IpJ5OCBRLbf1wbWsaY71k5h+3zvDyny67G7fyUIhz\r
ksLi4xaNmjICq44Y3ekQEe5+NauQrz4wlHrQMz2nZQ/1/I6eYs9HRCwBXbsdtTLS\r
R9I4LtD+gdwyah617jzV/OeBHRnDJELqYzmp\r
-----END CERTIFICATE-----\r
`;var ne=`-----BEGIN CERTIFICATE-----\r
MIIDrzCCApegAwIBAgIQCDvgVpBCRrGhdWrJWZHHSjANBgkqhkiG9w0BAQUFADBh\r
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3\r
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD\r
QTAeFw0wNjExMTAwMDAwMDBaFw0zMTExMTAwMDAwMDBaMGExCzAJBgNVBAYTAlVT\r
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5j\r
b20xIDAeBgNVBAMTF0RpZ2lDZXJ0IEdsb2JhbCBSb290IENBMIIBIjANBgkqhkiG\r
9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4jvhEXLeqKTTo1eqUKKPC3eQyaKl7hLOllsB\r
CSDMAZOnTjC3U/dDxGkAV53ijSLdhwZAAIEJzs4bg7/fzTtxRuLWZscFs3YnFo97\r
nh6Vfe63SKMI2tavegw5BmV/Sl0fvBf4q77uKNd0f3p4mVmFaG5cIzJLv07A6Fpt\r
43C/dxC//AH2hdmoRBBYMql1GNXRor5H4idq9Joz+EkIYIvUX7Q6hL+hqkpMfT7P\r
T19sdl6gSzeRntwi5m3OFBqOasv+zbMUZBfHWymeMr/y7vrTC0LUq7dBMtoM1O/4\r
gdW7jVg/tRvoSSiicNoxBN33shbyTApOB6jtSj1etX+jkMOvJwIDAQABo2MwYTAO\r
BgNVHQ8BAf8EBAMCAYYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUA95QNVbR\r
TLtm8KPiGxvDl7I90VUwHwYDVR0jBBgwFoAUA95QNVbRTLtm8KPiGxvDl7I90VUw\r
DQYJKoZIhvcNAQEFBQADggEBAMucN6pIExIK+t1EnE9SsPTfrgT1eXkIoyQY/Esr\r
hMAtudXH/vTBH1jLuG2cenTnmCmrEbXjcKChzUyImZOMkXDiqw8cvpOp/2PV5Adg\r
06O/nVsJ8dWO41P0jmP6P6fbtGbfYmbW0W5BjfIttep3Sp+dWOIrWcBAI+0tKIJF\r
PnlUkiaY4IBIqDfv8NZ5YBberOgOzW6sRBc4L0na4UU+Krk2U886UAb3LujEV0ls\r
YSEY1QSteDwsOoBrp+uvFRTp2InBuThs4pFsiv9kuXclVzDAGySj4dzp30d8tbQk\r
CAUw7C29C79Fv1C5qfPrmAESrciIxpg0X40KPMbp1ZWVbd4=\r
-----END CERTIFICATE-----\r
`;var ve=new TextDecoder;async function re(i,e,t){let r=Date.now(),n=new URL(i);if(n.protocol!=="https:")throw new Error("Wrong protocol");let o=n.hostname,a=n.port||443,s=n.pathname+n.search,c=tt.fromPEM(vt+It+ee+ne),h=await t(o,a),[m,l]=await yt(o,c,h.read,h.write),g=new x(1024);g.writeUTF8String(`${e} ${s} HTTP/1.0\r
Host: ${o}\r
\r
`),await l(g.array());let d,S="";do if(d=await m(),d){let T=ve.decode(d);S+=T}while(d);return gt(`time taken: ${Date.now()-r}ms`),S}var Ft=class{queue;outstandingRequest;constructor(){this.queue=[]}enqueue(e){this.queue.push(e),this.dequeue()}dequeue(){if(this.outstandingRequest===void 0)return;let{resolve:e,bytes:t}=this.outstandingRequest,r=this.bytesInQueue();if(r<t&&this.socketIsNotClosed())return;if(t=Math.min(t,r),t===0)return e(void 0);this.outstandingRequest=void 0;let n=this.queue[0],o=n.length;if(o===t)return this.queue.shift(),e(n);if(o>t)return this.queue[0]=n.subarray(t),e(n.subarray(0,t));{let a=new Uint8Array(t),s=t,c=0;for(;s>0;){let h=this.queue[0],m=h.length;m<=s?(this.queue.shift(),a.set(h,c),c+=m,s-=m):(this.queue[0]=h.subarray(s),a.set(h.subarray(0,s),c),s-=s,c+=s)}return e(a)}}bytesInQueue(){return this.queue.reduce((e,t)=>e+t.length,0)}async read(e){if(this.outstandingRequest!==void 0)throw new Error("Can\u2019t read while already awaiting read");return new Promise(t=>{this.outstandingRequest={resolve:t,bytes:e},this.dequeue()})}},Rt=class extends Ft{constructor(t){super();this.socket=t;t.addEventListener("message",r=>this.enqueue(new Uint8Array(r.data))),t.addEventListener("close",()=>this.dequeue())}socketIsNotClosed(){let{socket:t}=this,{readyState:r}=t;return r<=1}};async function Bt(i,e,t=()=>{}){let r=await new Promise(s=>{let c=new WebSocket(`wss://ws.manipulexity.com/v1?address=${i}:${e}`);c.binaryType="arraybuffer",c.addEventListener("open",()=>s(c)),c.addEventListener("error",h=>{console.log("ws error:",h)}),c.addEventListener("close",()=>{console.log("connection closed"),t()})}),n=new Rt(r),o=n.read.bind(n),a=r.send.bind(r);return{read:o,write:a}}var Mt=location.hash.slice(1),ie=Mt&&Mt.startsWith("postgres"),se=document.getElementById("go"),Ie=document.getElementById("heading");ie&&(se.value="Ask Postgres the time over TLS",Ie.textContent="Postgres + TLS, byte-by-byte, LIVE!");se.addEventListener("click",()=>{ie?te(Mt,Bt):re("https://subtls.pages.dev","GET",Bt)});
