function b(...s){if(s.length===1&&s[0]instanceof Uint8Array)return s[0];let e=s.reduce((n,r)=>n+r.length,0),t=new Uint8Array(e),i=0;for(let n of s)t.set(n,i),i+=n.length;return t}function G(s,e){let t=s.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(s[i]!==e[i])return!1;return!0}var ht="\xB7\xB7 ";var qt=new TextEncoder,ae=new TextDecoder,w=class{offset;dataView;data;comments;indents;indent;constructor(e){this.offset=0,this.data=typeof e=="number"?new Uint8Array(e):e,this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength),this.comments={},this.indents={},this.indent=0}extend(e){let t=typeof e=="number"?new Uint8Array(e):e;this.data=b(this.data,t),this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}remaining(){return this.data.length-this.offset}subarray(e){return this.data.subarray(this.offset,this.offset+=e)}skip(e,t){return this.offset+=e,t&&this.comment(t),this}comment(e,t=this.offset){throw new Error("No comments should be emitted outside of chatty mode")}readBytes(e){return this.data.slice(this.offset,this.offset+=e)}readUTF8String(e){let t=this.subarray(e);return ae.decode(t)}readUTF8StringNullTerminated(){let e=this.offset;for(;this.data[e]!==0;)e++;let t=this.readUTF8String(e-this.offset);return this.expectUint8(0,"end of string"),t}readUint8(e){let t=this.dataView.getUint8(this.offset);return this.offset+=1,t}readUint16(e){let t=this.dataView.getUint16(this.offset);return this.offset+=2,t}readUint24(e){let t=this.readUint8(),i=this.readUint16();return(t<<16)+i}readUint32(e){let t=this.dataView.getUint32(this.offset);return this.offset+=4,t}expectBytes(e,t){let i=this.readBytes(e.length);if(!G(i,e))throw new Error("Unexpected bytes")}expectUint8(e,t){let i=this.readUint8();if(i!==e)throw new Error(`Expected ${e}, got ${i}`)}expectUint16(e,t){let i=this.readUint16();if(i!==e)throw new Error(`Expected ${e}, got ${i}`)}expectUint24(e,t){let i=this.readUint24();if(i!==e)throw new Error(`Expected ${e}, got ${i}`)}expectUint32(e,t){let i=this.readUint32();if(i!==e)throw new Error(`Expected ${e}, got ${i}`)}expectLength(e,t=1){let i=this.offset,n=i+e;if(n>this.data.length)throw new Error("Expected length exceeds remaining data length");return this.indent+=t,this.indents[i]=this.indent,[()=>{if(this.indent-=t,this.indents[this.offset]=this.indent,this.offset!==n)throw new Error(`${e} bytes expected but ${this.offset-i} read`)},()=>n-this.offset]}expectLengthUint8(e){let t=this.readUint8();return this.expectLength(t)}expectLengthUint16(e){let t=this.readUint16();return this.expectLength(t)}expectLengthUint24(e){let t=this.readUint24();return this.expectLength(t)}expectLengthUint32(e){let t=this.readUint32();return this.expectLength(t)}expectLengthUint8Incl(e){let t=this.readUint8();return this.expectLength(t-1)}expectLengthUint16Incl(e){let t=this.readUint16();return this.expectLength(t-2)}expectLengthUint24Incl(e){let t=this.readUint24();return this.expectLength(t-3)}expectLengthUint32Incl(e){let t=this.readUint32();return this.expectLength(t-4)}writeBytes(e){return this.data.set(e,this.offset),this.offset+=e.length,this}writeUTF8String(e){let t=qt.encode(e);return this.writeBytes(t),this}writeUTF8StringNullTerminated(e){let t=qt.encode(e);return this.writeBytes(t),this.writeUint8(0),this}writeUint8(e,t){return this.dataView.setUint8(this.offset,e),this.offset+=1,this}writeUint16(e,t){return this.dataView.setUint16(this.offset,e),this.offset+=2,this}writeUint24(e,t){return this.writeUint8((e&16711680)>>16),this.writeUint16(e&65535,t),this}writeUint32(e,t){return this.dataView.setUint32(this.offset,e),this.offset+=4,this}_writeLengthGeneric(e,t,i){let n=this.offset;this.offset+=e;let r=this.offset;return this.indent+=1,this.indents[r]=this.indent,()=>{let o=this.offset-(t?n:r);if(e===1)this.dataView.setUint8(n,o);else if(e===2)this.dataView.setUint16(n,o);else if(e===3)this.dataView.setUint8(n,(o&16711680)>>16),this.dataView.setUint16(n+1,o&65535);else if(e===4)this.dataView.setUint32(n,o);else throw new Error(`Invalid length for length field: ${e}`);this.indent-=1,this.indents[this.offset]=this.indent}}writeLengthUint8(e){return this._writeLengthGeneric(1,!1,e)}writeLengthUint16(e){return this._writeLengthGeneric(2,!1,e)}writeLengthUint24(e){return this._writeLengthGeneric(3,!1,e)}writeLengthUint32(e){return this._writeLengthGeneric(4,!1,e)}writeLengthUint8Incl(e){return this._writeLengthGeneric(1,!0,e)}writeLengthUint16Incl(e){return this._writeLengthGeneric(2,!0,e)}writeLengthUint24Incl(e){return this._writeLengthGeneric(3,!0,e)}writeLengthUint32Incl(e){return this._writeLengthGeneric(4,!0,e)}array(){return this.data.subarray(0,this.offset)}commentedString(e=!1){let t=this.indents[0]!==void 0?ht.repeat(this.indents[0]):"",i=this.indents[0]??0,n=e?this.data.length:this.offset;for(let r=0;r<n;r++){t+=this.data[r].toString(16).padStart(2,"0")+" ";let o=this.comments[r+1];this.indents[r+1]!==void 0&&(i=this.indents[r+1]),o&&(t+=` ${o}
${ht.repeat(i)}`)}return t}};var Re=new RegExp(`  .+|^(${ht})+`,"gm");function Ft(s,e=!0){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},i=new RegExp((e?`\\bhttps?:[/][/][^\\s\\u200b"'<>]+[^\\s\\u200b"'<>.),:;?!]\\b|`:"")+"["+Object.keys(t).join("")+"]","gi");return s.replace(i,r=>r.length===1?t[r]:`<a target="_blank" href="${r}">${Ft(r,!1)}</a>`)}function ce(...s){let e="<span>",t,i,n="";for(;(t=s.shift())!==void 0;){t=n+Ft(String(t)),n=" ";let r=/([\s\S]*?)%([csoOidf])|[\s\S]+/g;for(;(i=r.exec(t))!==null;){let[o,c,a]=i;a===void 0?e+=o:(e+=c,a==="c"?e+=`</span><span style="${s.shift()}">`:a==="s"?e+=s.shift():a==="o"||a==="O"?e+=JSON.stringify(s.shift(),void 0,a==="O"?2:void 0):(a==="i"||a==="d"||a==="f")&&(e+=String(s.shift())))}}return e+="</span>",e}var he=0;function dt(...s){if(console.log(...s,`
`),typeof document>"u")return;let e=document.querySelector("#logs");e.innerHTML+=`<label><input type="checkbox" name="c${he++}" checked="checked"><div class="section">`+ce(...s)+"</div></label>",(document.body.scrollTop>=document.body.scrollHeight-document.body.clientHeight-1||document.body.clientHeight>=document.body.scrollHeight)&&window.scrollTo({top:99999})}function Lt(s,e,t,i=!0){let n=new w(1024);n.writeUint8(22,0),n.writeUint16(769,0);let r=n.writeLengthUint16();n.writeUint8(1,0);let o=n.writeLengthUint24();n.writeUint16(771,0),crypto.getRandomValues(n.subarray(32));let c=n.writeLengthUint8(0);n.writeBytes(t),c();let a=n.writeLengthUint16(0);n.writeUint16(4865,0),a();let h=n.writeLengthUint8(0);n.writeUint8(0,0),h();let d=n.writeLengthUint16(0);if(i){n.writeUint16(0,0);let f=n.writeLengthUint16(0),H=n.writeLengthUint16(0);n.writeUint8(0,0);let j=n.writeLengthUint16(0);n.writeUTF8String(s),j(),H(),f()}n.writeUint16(11,0);let l=n.writeLengthUint16(0),g=n.writeLengthUint8(0);n.writeUint8(0,0),g(),l(),n.writeUint16(10,0);let u=n.writeLengthUint16(0),p=n.writeLengthUint16(0);n.writeUint16(23,0),p(),u(),n.writeUint16(13,0);let S=n.writeLengthUint16(0),v=n.writeLengthUint16(0);n.writeUint16(1027,0),n.writeUint16(2052,0),v(),S(),n.writeUint16(43,0);let x=n.writeLengthUint16(0),E=n.writeLengthUint8(0);n.writeUint16(772,0),E(),x(),n.writeUint16(51,0);let $=n.writeLengthUint16(0),K=n.writeLengthUint16(0);n.writeUint16(23,0);let V=n.writeLengthUint16(0);return n.writeBytes(new Uint8Array(e)),V(),K(),$(),d(),o(),r(),n}function M(s,e=""){return[...s].map(t=>t.toString(16).padStart(2,"0")).join(e)}function Tt(s,e){let t,i,[n]=s.expectLength(s.remaining());s.expectUint8(2,0);let[r]=s.expectLengthUint24(0);s.expectUint16(771,0);let o=s.readBytes(32);if(G(o,[207,33,173,116,229,154,97,17,190,29,140,2,30,101,184,145,194,162,17,22,122,187,140,94,7,158,9,226,200,168,51,156]))throw new Error("Unexpected HelloRetryRequest");s.expectUint8(e.length,0),s.expectBytes(e,0),s.expectUint16(4865,0),s.expectUint8(0,0);let[c,a]=s.expectLengthUint16(0);for(;a()>0;){let h=s.readUint16(0),[d]=s.expectLengthUint16(0);if(h===43)s.expectUint16(772,0),i=!0;else if(h===51)s.expectUint16(23,0),s.expectUint16(65),t=s.readBytes(65);else throw new Error(`Unexpected extension 0x${M([h])}`);d()}if(c(),r(),n(),i!==!0)throw new Error("No TLS version provided");if(t===void 0)throw new Error("No key provided");return t}var lt=1<<14,de=lt+1+255;async function ut(s,e,t=lt){let n=await s(5);if(n===void 0)return;if(n.length<5)throw new Error("TLS record header truncated");let r=new w(n),o=r.readUint8();if(o<20||o>24)throw new Error(`Illegal TLS record type 0x${o.toString(16)}`);if(e!==void 0&&o!==e)throw new Error(`Unexpected TLS record type 0x${o.toString(16).padStart(2,"0")} (expected 0x${e.toString(16).padStart(2,"0")})`);let c=r.readUint16(0);if([769,770,771].indexOf(c)<0)throw new Error(`Unsupported TLS record version 0x${c.toString(16).padStart(4,"0")}`);let a=r.readUint16(0);if(a>t)throw new Error(`Record too long: ${a} bytes`);let h=await s(a);if(h===void 0||h.length<a)throw new Error("TLS record content truncated");return{headerData:n,header:r,type:o,version:c,length:a,content:h}}async function pt(s,e,t){let i=await ut(s,23,de);if(i===void 0)return;let n=new w(i.content),[r]=n.expectLength(n.remaining());n.skip(i.length-16,0),n.skip(16,0),r();let o=await e.process(i.content,16,i.headerData),c=o.length-1;for(;o[c]===0;)c-=1;if(c<0)throw new Error("Decrypted message has no record type indicator (all zeroes)");let a=o[c],h=o.subarray(0,c);if(!(a===21&&h.length===2&&h[0]===1&&h[1]===0)){if(a===22&&h[0]===4)return pt(s,e,t);if(t!==void 0&&a!==t)throw new Error(`Unexpected TLS record type 0x${a.toString(16).padStart(2,"0")} (expected 0x${t.toString(16).padStart(2,"0")})`);return h}}async function le(s,e,t){let i=b(s,[t]),n=5,c=i.length+16,a=new w(n+c);a.writeUint8(23,0),a.writeUint16(771,0),a.writeUint16(c,`${c} bytes follow`);let[h]=a.expectLength(c),d=a.array(),l=await e.process(i,16,d);return a.writeBytes(l.subarray(0,l.length-16)),a.writeBytes(l.subarray(l.length-16)),h(),a.array()}async function It(s,e,t){let i=Math.ceil(s.length/lt),n=[];for(let r=0;r<i;r++){let o=s.subarray(r*lt,(r+1)*lt),c=await le(o,e,t);n.push(c)}return n}var m=crypto.subtle;var $t=new TextEncoder;async function kt(s,e,t){let i=await m.importKey("raw",s,{name:"HMAC",hash:{name:`SHA-${t}`}},!1,["sign"]);var n=new Uint8Array(await m.sign("HMAC",i,e));return n}async function ye(s,e,t,i){let n=i>>3,r=Math.ceil(t/n),o=new Uint8Array(r*n),c=await m.importKey("raw",s,{name:"HMAC",hash:{name:`SHA-${i}`}},!1,["sign"]),a=new Uint8Array(0);for(let h=0;h<r;h++){let d=b(a,e,[h+1]),l=await m.sign("HMAC",c,d),g=new Uint8Array(l);o.set(g,n*h),a=g}return o.subarray(0,t)}var Mt=$t.encode("tls13 ");async function k(s,e,t,i,n){let r=$t.encode(e),o=b([(i&65280)>>8,i&255],[Mt.length+r.length],Mt,r,[t.length],t);return ye(s,o,i,n)}async function Vt(s,e,t,i,n){let r=i>>3,o=new Uint8Array(r),c=await m.importKey("raw",s,{name:"ECDH",namedCurve:"P-256"},!1,[]),a=await m.deriveBits({name:"ECDH",public:c},e,256),h=new Uint8Array(a),d=await m.digest("SHA-256",t),l=new Uint8Array(d),g=await kt(new Uint8Array(1),o,i),u=await m.digest(`SHA-${i}`,new Uint8Array(0)),p=new Uint8Array(u),S=await k(g,"derived",p,r,i),v=await kt(S,h,i),x=await k(v,"c hs traffic",l,r,i),E=await k(v,"s hs traffic",l,r,i),$=await k(x,"key",new Uint8Array(0),n,i),K=await k(E,"key",new Uint8Array(0),n,i),V=await k(x,"iv",new Uint8Array(0),12,i),f=await k(E,"iv",new Uint8Array(0),12,i);return{serverHandshakeKey:K,serverHandshakeIV:f,clientHandshakeKey:$,clientHandshakeIV:V,handshakeSecret:v,clientSecret:x,serverSecret:E}}async function Pt(s,e,t,i){let n=t>>3,r=new Uint8Array(n),o=await m.digest(`SHA-${t}`,new Uint8Array(0)),c=new Uint8Array(o),a=await k(s,"derived",c,n,t),h=await kt(a,r,t),d=await k(h,"c ap traffic",e,n,t),l=await k(h,"s ap traffic",e,n,t),g=await k(d,"key",new Uint8Array(0),i,t),u=await k(l,"key",new Uint8Array(0),i,t),p=await k(d,"iv",new Uint8Array(0),12,t),S=await k(l,"iv",new Uint8Array(0),12,t);return{serverApplicationKey:u,serverApplicationIV:S,clientApplicationKey:g,clientApplicationIV:p}}var me=2**31-1,nt=class{constructor(e,t,i){this.mode=e;this.key=t;this.initialIv=i}recordsProcessed=0;priorPromise=Promise.resolve(new Uint8Array);async process(e,t,i){let n=this.processUnsequenced(e,t,i);return this.priorPromise=this.priorPromise.then(()=>n)}async processUnsequenced(e,t,i){let n=this.recordsProcessed;if(n===me)throw new Error("Cannot encrypt/decrypt any more records");this.recordsProcessed+=1;let r=this.initialIv.slice(),o=r.length;r[o-1]^=n&255,r[o-2]^=n>>>8&255,r[o-3]^=n>>>16&255,r[o-4]^=n>>>24&255;let c=t<<3,a={name:"AES-GCM",iv:r,tagLength:c,additionalData:i},h=await m[this.mode](a,this.key,e);return new Uint8Array(h)}};function ft(s){return s>64&&s<91?s-65:s>96&&s<123?s-71:s>47&&s<58?s+4:s===43?62:s===47?63:s===61?64:void 0}function Ot(s){let e=s.length,t=0,i=0,n=64,r=64,o=64,c=64,a=new Uint8Array(e*.75);for(;t<e;)n=ft(s.charCodeAt(t++)),r=ft(s.charCodeAt(t++)),o=ft(s.charCodeAt(t++)),c=ft(s.charCodeAt(t++)),a[i++]=n<<2|r>>4,a[i++]=(r&15)<<4|o>>2,a[i++]=(o&3)<<6|c;let h=r===64?0:o===64?2:c===64?1:0;return a.subarray(0,i-h)}var z=class extends w{readASN1Length(e){let t=this.readUint8();if(t<128)return t;let i=t&127,n=0;if(i===1)return this.readUint8(n);if(i===2)return this.readUint16(n);if(i===3)return this.readUint24(n);if(i===4)return this.readUint32(n);throw new Error(`ASN.1 length fields are only supported up to 4 bytes (this one is ${i} bytes)`)}expectASN1Length(e){let t=this.readASN1Length(e);return this.expectLength(t)}readASN1OID(){let[e,t]=this.expectASN1Length(0),i=this.readUint8(),n=`${Math.floor(i/40)}.${i%40}`;for(;t()>0;){let r=0;for(;;){let o=this.readUint8();if(r<<=7,r+=o&127,o<128)break}n+=`.${r}`}return e(),n}readASN1Boolean(){let[e,t]=this.expectASN1Length(0),i=t();if(i!==1)throw new Error(`Boolean has weird length: ${i}`);let n=this.readUint8(),r;if(n===255)r=!0;else if(n===0)r=!1;else throw new Error(`Boolean has weird value: 0x${M([n])}`);return e(),r}readASN1UTCTime(){let[e,t]=this.expectASN1Length(0),n=this.readUTF8String(t()).match(/^(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z$/);if(!n)throw new Error("Unrecognised ASN.1 UTC time format");let[,r,o,c,a,h,d]=n,l=parseInt(r,10),g=l+(l>=50?1900:2e3),u=new Date(`${g}-${o}-${c}T${a}:${h}:${d}Z`);return e(),u}readASN1BitString(){let[e,t]=this.expectASN1Length(0),i=this.readUint8(0),n=t(),r=this.readBytes(n);if(i>7)throw new Error(`Invalid right pad value: ${i}`);if(i>0){let o=8-i;for(let c=n-1;c>0;c--)r[c]=255&r[c-1]<<o|r[c]>>>i;r[0]=r[0]>>>i}return e(),r}};var wt=1,ot=2,D=48,ge=49,rt=6,ue=19,pe=12,Dt=23,xt=5,X=4,Ut=3,jt=163,at=128;var fe={"2.5.4.6":"C","2.5.4.10":"O","2.5.4.11":"OU","2.5.4.3":"CN","2.5.4.7":"L","2.5.4.8":"ST","2.5.4.12":"T","2.5.4.42":"GN","2.5.4.43":"I","2.5.4.4":"SN","1.2.840.113549.1.9.1":"E-mail"};function Qt(s){let{length:e}=s;if(e>4)throw new Error(`Bit string length ${e} would overflow JS bit operators`);let t=0,i=0;for(let n=s.length-1;n>=0;n--)t|=s[n]<<i,i+=8;return t}function Bt(s,e){let t={};s.expectUint8(D,0);let[i,n]=s.expectASN1Length(0);for(;n()>0;){s.expectUint8(ge,0);let[r]=s.expectASN1Length(0);s.expectUint8(D,0);let[o]=s.expectASN1Length(0);s.expectUint8(rt,0);let c=s.readASN1OID(),a=fe[c]??c,h=s.readUint8();if(h!==ue){if(h!==pe)throw new Error(`Unexpected item type in certificate ${e}: 0x${M([h])}`)}let[d,l]=s.expectASN1Length(0),g=s.readUTF8String(l());if(d(),o(),r(),t[a]!==void 0)throw new Error(`Duplicate OID ${a} in certificate ${e}`);t[a]=g}return i(),t}function Gt(s,e=0){let t=[],[i,n]=s.expectASN1Length(0);for(;n()>0;){let r=s.readUint8(0),[o,c]=s.expectASN1Length(0),a;r===(e|2)?a=s.readUTF8String(c()):a=s.readBytes(c()),t.push({name:a,type:r}),o()}return i(),t}function Yt(s){let e={"1.2.840.113549.1.1.1":{name:"RSAES-PKCS1-v1_5"},"1.2.840.113549.1.1.5":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}},"1.2.840.113549.1.1.11":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},"1.2.840.113549.1.1.12":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},"1.2.840.113549.1.1.13":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}},"1.2.840.113549.1.1.10":{name:"RSA-PSS"},"1.2.840.113549.1.1.7":{name:"RSA-OAEP"},"1.2.840.10045.2.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.3.2":{name:"ECDSA",hash:{name:"SHA-256"}},"1.2.840.10045.4.3.3":{name:"ECDSA",hash:{name:"SHA-384"}},"1.2.840.10045.4.3.4":{name:"ECDSA",hash:{name:"SHA-512"}},"1.3.133.16.840.63.0.2":{name:"ECDH",kdf:"SHA-1"},"1.3.132.1.11.1":{name:"ECDH",kdf:"SHA-256"},"1.3.132.1.11.2":{name:"ECDH",kdf:"SHA-384"},"1.3.132.1.11.3":{name:"ECDH",kdf:"SHA-512"},"2.16.840.1.101.3.4.1.2":{name:"AES-CBC",length:128},"2.16.840.1.101.3.4.1.22":{name:"AES-CBC",length:192},"2.16.840.1.101.3.4.1.42":{name:"AES-CBC",length:256},"2.16.840.1.101.3.4.1.6":{name:"AES-GCM",length:128},"2.16.840.1.101.3.4.1.26":{name:"AES-GCM",length:192},"2.16.840.1.101.3.4.1.46":{name:"AES-GCM",length:256},"2.16.840.1.101.3.4.1.4":{name:"AES-CFB",length:128},"2.16.840.1.101.3.4.1.24":{name:"AES-CFB",length:192},"2.16.840.1.101.3.4.1.44":{name:"AES-CFB",length:256},"2.16.840.1.101.3.4.1.5":{name:"AES-KW",length:128},"2.16.840.1.101.3.4.1.25":{name:"AES-KW",length:192},"2.16.840.1.101.3.4.1.45":{name:"AES-KW",length:256},"1.2.840.113549.2.7":{name:"HMAC",hash:{name:"SHA-1"}},"1.2.840.113549.2.9":{name:"HMAC",hash:{name:"SHA-256"}},"1.2.840.113549.2.10":{name:"HMAC",hash:{name:"SHA-384"}},"1.2.840.113549.2.11":{name:"HMAC",hash:{name:"SHA-512"}},"1.2.840.113549.1.9.16.3.5":{name:"DH"},"1.3.14.3.2.26":{name:"SHA-1"},"2.16.840.1.101.3.4.2.1":{name:"SHA-256"},"2.16.840.1.101.3.4.2.2":{name:"SHA-384"},"2.16.840.1.101.3.4.2.3":{name:"SHA-512"},"1.2.840.113549.1.5.12":{name:"PBKDF2"},"1.2.840.10045.3.1.7":{name:"P-256"},"1.3.132.0.34":{name:"P-384"},"1.3.132.0.35":{name:"P-521"}}[s];if(e===void 0)throw new Error(`Unsupported algorithm identifier: ${s}`);return e}function zt(s,e=[]){return Object.values(s).forEach(t=>{typeof t=="string"?e=[...e,t]:e=zt(t,e)}),e}function Wt(s){return zt(s).join(" / ")}var we=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],yt=class{serialNumber;algorithm;issuer;validityPeriod;subject;publicKey;signature;keyUsage;subjectAltNames;extKeyUsage;authorityKeyIdentifier;subjectKeyIdentifier;basicConstraints;signedData;constructor(e){let t=e instanceof z?e:new z(e);t.expectUint8(D,0);let[i]=t.expectASN1Length(0),n=t.offset;t.expectUint8(D,0);let[r]=t.expectASN1Length(0);t.expectBytes([160,3,2,1,2],0),t.expectUint8(ot,0);let[o,c]=t.expectASN1Length(0);this.serialNumber=t.subarray(c()),o(),t.expectUint8(D,0);let[a,h]=t.expectASN1Length(0);t.expectUint8(rt,0),this.algorithm=t.readASN1OID(),h()>0&&(t.expectUint8(xt,0),t.expectUint8(0,0)),a(),this.issuer=Bt(t,"issuer"),t.expectUint8(D,0);let[d]=t.expectASN1Length(0);t.expectUint8(Dt,0);let l=t.readASN1UTCTime();t.expectUint8(Dt,0);let g=t.readASN1UTCTime();this.validityPeriod={notBefore:l,notAfter:g},d(),this.subject=Bt(t,"subject");let u=t.offset;t.expectUint8(D,0);let[p]=t.expectASN1Length(0);t.expectUint8(D,0);let[S,v]=t.expectASN1Length(0),x=[];for(;v()>0;){let Q=t.readUint8();if(Q===rt){let Y=t.readASN1OID();x.push(Y)}else Q===xt&&t.expectUint8(0,0)}S(),t.expectUint8(Ut,0);let E=t.readASN1BitString();this.publicKey={identifiers:x,data:E,all:t.data.subarray(u,t.offset)},p(),t.expectUint8(jt,0);let[$]=t.expectASN1Length();t.expectUint8(D,0);let[K,V]=t.expectASN1Length(0);for(;V()>0;){t.expectUint8(D,0);let[Q,Y]=t.expectASN1Length();t.expectUint8(rt,0);let N=t.readASN1OID();if(N==="2.5.29.17"){t.expectUint8(X,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let L=Gt(t,at);this.subjectAltNames=L.filter(A=>A.type===(2|at)).map(A=>A.name),I()}else if(N==="2.5.29.15"){t.expectUint8(wt,0);let I=t.readASN1Boolean();t.expectUint8(X,0);let[L]=t.expectASN1Length(0);t.expectUint8(Ut,0);let A=t.readASN1BitString(),C=Qt(A),U=new Set(we.filter((F,q)=>C&1<<q));L(),this.keyUsage={critical:I,usages:U}}else if(N==="2.5.29.37"){this.extKeyUsage={},t.expectUint8(X,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let[L,A]=t.expectASN1Length(0);for(;A()>0;){t.expectUint8(rt,0);let C=t.readASN1OID();C==="1.3.6.1.5.5.7.3.1"&&(this.extKeyUsage.serverTls=!0),C==="1.3.6.1.5.5.7.3.2"&&(this.extKeyUsage.clientTls=!0)}L(),I()}else if(N==="2.5.29.35"){t.expectUint8(X,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let[L,A]=t.expectASN1Length(0);for(;A()>0;){let C=t.readUint8();if(C===(at|0)){let[U,F]=t.expectASN1Length(0);this.authorityKeyIdentifier=t.readBytes(F()),U()}else if(C===(at|1)||C===(at|2)){let[U,F]=t.expectASN1Length(0);t.skip(F(),0),U()}else throw new Error("Unexpected data type in authorityKeyIdentifier certificate extension")}L(),I()}else if(N==="2.5.29.14"){t.expectUint8(X,0);let[I]=t.expectASN1Length(0);t.expectUint8(X,0);let[L,A]=t.expectASN1Length(0);this.subjectKeyIdentifier=t.readBytes(A()),L(),I()}else if(N==="2.5.29.19"){let I,L=t.readUint8();if(L===wt&&(I=t.readASN1Boolean(),L=t.readUint8()),L!==X)throw new Error("Unexpected type in certificate basic constraints");let[A]=t.expectASN1Length(0);t.expectUint8(D,0);let[C,U]=t.expectASN1Length(),F;U()>0&&(t.expectUint8(wt,0),F=t.readASN1Boolean());let q;if(U()>0){t.expectUint8(ot,0);let y=t.readASN1Length(0);if(q=y===1?t.readUint8():y===2?t.readUint16():y===3?t.readUint24():void 0,q===void 0)throw new Error("Too many bytes in max path length in certificate basicConstraints")}C(),A(),this.basicConstraints={critical:I,ca:F,pathLength:q}}else t.skip(Y(),0);Q()}K(),$(),r(),this.signedData=t.data.subarray(n,t.offset),t.expectUint8(D,0);let[f,H]=t.expectASN1Length(0);t.expectUint8(rt,0);let j=t.readASN1OID();if(H()>0&&(t.expectUint8(xt,0),t.expectUint8(0,0)),f(),j!==this.algorithm)throw new Error(`Certificate specifies different signature algorithms inside (${this.algorithm}) and out (${j})`);t.expectUint8(Ut,0),this.signature=t.readASN1BitString(),i()}static fromPEM(e){let t="[A-Z0-9 ]+",i=new RegExp(`-{5}BEGIN ${t}-{5}([a-zA-Z0-9=+\\/\\n\\r]+)-{5}END ${t}-{5}`,"g"),n=[],r=null;for(;r=i.exec(e);){let o=r[1].replace(/[\r\n]/g,""),c=Ot(o),a=new this(c);n.push(a)}return n}subjectAltNameMatchingHost(e){let t=/[.][^.]+[.][^.]+$/;return(this.subjectAltNames??[]).find(i=>{let n=i,r=e;if(t.test(e)&&t.test(n)&&n.startsWith("*.")&&(n=n.slice(1),r=r.slice(r.indexOf("."))),n===r)return!0})}isValidAtMoment(e=new Date){return e>=this.validityPeriod.notBefore&&e<=this.validityPeriod.notAfter}description(){return"subject: "+Object.entries(this.subject).map(e=>e.join("=")).join(", ")+(this.subjectAltNames?`
subject alt names: `+this.subjectAltNames.join(", "):"")+(this.subjectKeyIdentifier?`
subject key id: ${M(this.subjectKeyIdentifier," ")}`:"")+`
issuer: `+Object.entries(this.issuer).map(e=>e.join("=")).join(", ")+(this.authorityKeyIdentifier?`
authority key id: ${M(this.authorityKeyIdentifier," ")}`:"")+`
validity: `+this.validityPeriod.notBefore.toISOString()+" \u2013 "+this.validityPeriod.notAfter.toISOString()+` (${this.isValidAtMoment()?"currently valid":"not valid"})`+(this.keyUsage?`
key usage (${this.keyUsage.critical?"critical":"non-critical"}): `+[...this.keyUsage.usages].join(", "):"")+(this.extKeyUsage?`
extended key usage: TLS server \u2014\xA0${this.extKeyUsage.serverTls}, TLS client \u2014\xA0${this.extKeyUsage.clientTls}`:"")+(this.basicConstraints?`
basic constraints (${this.basicConstraints.critical?"critical":"non-critical"}): CA \u2014\xA0${this.basicConstraints.ca}, path length \u2014 ${this.basicConstraints.pathLength}`:"")+`
signature algorithm: `+Wt(Yt(this.algorithm))}toJSON(){return{serialNumber:[...this.serialNumber],algorithm:this.algorithm,issuer:this.issuer,validityPeriod:{notBefore:this.validityPeriod.notBefore.toISOString(),notAfter:this.validityPeriod.notAfter.toISOString()},subject:this.subject,publicKey:{identifiers:this.publicKey.identifiers,data:[...this.publicKey.data],all:[...this.publicKey.all]},signature:[...this.signature],keyUsage:{critical:this.keyUsage?.critical,usages:[...this.keyUsage?.usages??[]]},subjectAltNames:this.subjectAltNames,extKeyUsage:this.extKeyUsage,authorityKeyIdentifier:this.authorityKeyIdentifier&&[...this.authorityKeyIdentifier],subjectKeyIdentifier:this.subjectKeyIdentifier&&[...this.subjectKeyIdentifier],basicConstraints:this.basicConstraints,signedData:[...this.signedData]}}},_=class extends yt{};async function St(s,e,t,i,n){s.expectUint8(D,0);let[r]=s.expectASN1Length(0);s.expectUint8(ot,0);let[o,c]=s.expectASN1Length(0),a=s.readBytes(c());o(),s.expectUint8(ot,0);let[h,d]=s.expectASN1Length(0),l=s.readBytes(d());h(),r();let g=(x,E)=>x.length>E?x.subarray(x.length-E):x.length<E?b(new Uint8Array(E-x.length),x):x,u=i==="P-256"?32:48,p=b(g(a,u),g(l,u)),S=await m.importKey("spki",e,{name:"ECDSA",namedCurve:i},!1,["verify"]);if(await m.verify({name:"ECDSA",hash:n},S,p,t)!==!0)throw new Error("ECDSA-SECP256R1-SHA256 certificate verify failed")}async function Jt(s,e,t){for(let c of e);let i=e[0];if(i.subjectAltNameMatchingHost(s)===void 0)throw new Error(`No matching subjectAltName for ${s}`);if(!i.isValidAtMoment())throw new Error("End-user certificate is not valid now");if(!i.extKeyUsage?.serverTls)throw new Error("End-user certificate has no TLS server extKeyUsage");let o=!1;for(let c of t);for(let c=0,a=e.length;c<a;c++){let h=e[c],d=h.authorityKeyIdentifier;if(d===void 0)throw new Error("Certificates without an authorityKeyIdentifier are not supported");let l=t.find(p=>p.subjectKeyIdentifier!==void 0&&G(p.subjectKeyIdentifier,d));if(l===void 0&&(l=e[c+1]),l===void 0)throw new Error("Ran out of certificates before reaching trusted root");let g=l instanceof _;if(l.isValidAtMoment()!==!0)throw new Error("Signing certificate is not valid now");if(l.keyUsage?.usages.has("digitalSignature")!==!0)throw new Error("Signing certificate keyUsage does not include digital signatures");if(l.basicConstraints?.ca!==!0)throw new Error("Signing certificate basicConstraints do not indicate a CA certificate");let{pathLength:u}=l.basicConstraints;if(u!==void 0&&u<c)throw new Error("Exceeded certificate path length");if(h.algorithm==="1.2.840.10045.4.3.2"||h.algorithm==="1.2.840.10045.4.3.3"){let p=h.algorithm==="1.2.840.10045.4.3.2"?"SHA-256":"SHA-384",S=l.publicKey.identifiers,v=S.includes("1.2.840.10045.3.1.7")?"P-256":S.includes("1.3.132.0.34")?"P-384":void 0;if(v===void 0)throw new Error("Unsupported signing key curve");let x=new z(h.signature);await St(x,l.publicKey.all,h.signedData,v,p)}else if(h.algorithm==="1.2.840.113549.1.1.11"||h.algorithm==="1.2.840.113549.1.1.12"){let p=h.algorithm==="1.2.840.113549.1.1.11"?"SHA-256":"SHA-384",S=await m.importKey("spki",l.publicKey.all,{name:"RSASSA-PKCS1-v1_5",hash:p},!1,["verify"]);if(await m.verify({name:"RSASSA-PKCS1-v1_5"},S,h.signature,h.signedData)!==!0)throw new Error("RSASSA_PKCS1-v1_5-SHA256 certificate verify failed")}else throw new Error("Unsupported signing algorithm");if(g){o=!0;break}}return o}var xe=new TextEncoder;async function Zt(s,e,t,i,n){let r=new z(await e());r.expectUint8(8,0);let[o]=r.expectLengthUint24(),[c,a]=r.expectLengthUint16(0);for(;a()>0;){let y=r.readUint16(0);if(y===0)r.expectUint16(0,0);else if(y===10){let[O,P]=r.expectLengthUint16("groups data");r.skip(P(),0),O()}else throw new Error(`Unsupported server encrypted extension type 0x${M([y]).padStart(4,"0")}`)}c(),o(),r.remaining()===0&&r.extend(await e());let h=!1,d=r.readUint8();if(d===13){h=!0;let[y]=r.expectLengthUint24("certificate request data");r.expectUint8(0,0);let[O,P]=r.expectLengthUint16("certificate request extensions");r.skip(P(),0),O(),y(),r.remaining()===0&&r.extend(await e()),d=r.readUint8()}if(d!==11)throw new Error(`Unexpected handshake message type 0x${M([d])}`);let[l]=r.expectLengthUint24(0);r.expectUint8(0,0);let[g,u]=r.expectLengthUint24(0),p=[];for(;u()>0;){let[y]=r.expectLengthUint24(0),O=new yt(r);p.push(O),y();let[P,W]=r.expectLengthUint16(),tt=r.subarray(W());P()}if(g(),l(),p.length===0)throw new Error("No certificates supplied");let S=p[0],v=r.data.subarray(0,r.offset),x=b(i,v),E=await m.digest("SHA-256",x),$=new Uint8Array(E),K=b(xe.encode(" ".repeat(64)+"TLS 1.3, server CertificateVerify"),[0],$);r.remaining()===0&&r.extend(await e()),r.expectUint8(15,0);let[V]=r.expectLengthUint24(0),f=r.readUint16();if(f===1027){let[y]=r.expectLengthUint16();await St(r,S.publicKey.all,K,"P-256","SHA-256"),y()}else if(f===2052){let[y,O]=r.expectLengthUint16(),P=r.subarray(O());y();let W=await m.importKey("spki",S.publicKey.all,{name:"RSA-PSS",hash:"SHA-256"},!1,["verify"]);if(await m.verify({name:"RSA-PSS",saltLength:32},W,P,K)!==!0)throw new Error("RSA-PSS-RSAE-SHA256 certificate verify failed")}else throw new Error(`Unsupported certificate verify signature type 0x${M([f]).padStart(4,"0")}`);V();let H=r.data.subarray(0,r.offset),j=b(i,H),Q=await k(t,"finished",new Uint8Array(0),32,256),Y=await m.digest("SHA-256",j),N=await m.importKey("raw",Q,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),I=await m.sign("HMAC",N,Y),L=new Uint8Array(I);r.remaining()===0&&r.extend(await e()),r.expectUint8(20,0);let[A,C]=r.expectLengthUint24(0),U=r.readBytes(C());if(A(),r.remaining()!==0)throw new Error("Unexpected extra bytes in server handshake");if(G(U,L)!==!0)throw new Error("Invalid server verify hash");if(!await Jt(s,p,n))throw new Error("Validated certificate chain did not end in a trusted root");return[r.data,h]}async function mt(s,e,t,i,n=!0,r,o,c){let a=await m.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),h=await m.exportKey("raw",a.publicKey),d=new Uint8Array(32);crypto.getRandomValues(d);let g=Lt(s,h,d,n).array(),u=r?b(r,g):g;if(i(u),o){let B=await t(o.length);if(!B||!G(B,o))throw new Error("Pre data did not match expectation")}let p=await ut(t,22);if(p===void 0)throw new Error("Connection closed while awaiting server hello");let S=new w(p.content),v=Tt(S,d),x=await ut(t,20);if(x===void 0)throw new Error("Connection closed awaiting server cipher change");let E=new w(x.content),[$]=E.expectLength(1);E.expectUint8(1,0),$();let K=g.subarray(5),V=p.content,f=b(K,V),H=await Vt(v,a.privateKey,f,256,16),j=await m.importKey("raw",H.serverHandshakeKey,{name:"AES-GCM"},!1,["decrypt"]),Q=new nt("decrypt",j,H.serverHandshakeIV),Y=await m.importKey("raw",H.clientHandshakeKey,{name:"AES-GCM"},!1,["encrypt"]),N=new nt("encrypt",Y,H.clientHandshakeIV),I=async()=>{let B=await pt(t,Q,22);if(B===void 0)throw new Error("Premature end of encrypted server handshake");return B},[L,A]=await Zt(s,I,H.serverSecret,f,e),C=new w(6);C.writeUint8(20,0),C.writeUint16(771,0);let U=C.writeLengthUint16();C.writeUint8(1,0),U();let F=C.array(),q=new Uint8Array(0);if(A){let B=new w(8);B.writeUint8(11,0);let ct=B.writeLengthUint24("client certificate data");B.writeUint8(0,0),B.writeUint24(0,0),ct(),q=B.array()}let y=b(f,L,q),O=await m.digest("SHA-256",y),P=new Uint8Array(O),W=await k(H.clientSecret,"finished",new Uint8Array(0),32,256),tt=await m.importKey("raw",W,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),Ht=await m.sign("HMAC",tt,P),R=new Uint8Array(Ht),T=new w(36);T.writeUint8(20,0);let et=T.writeLengthUint24(0);T.writeBytes(R),et();let J=T.array(),Z=await It(b(q,J),N,22),it=P;if(q.length>0){let B=y.subarray(0,y.length-q.length),ct=await m.digest("SHA-256",B);it=new Uint8Array(ct)}let st=await Pt(H.handshakeSecret,it,256,16),Et=await m.importKey("raw",st.clientApplicationKey,{name:"AES-GCM"},!0,["encrypt"]),re=new nt("encrypt",Et,st.clientApplicationIV),ie=await m.importKey("raw",st.serverApplicationKey,{name:"AES-GCM"},!0,["decrypt"]),se=new nt("decrypt",ie,st.serverApplicationIV),gt=!1;return[()=>{if(!gt){let B=b(F,...Z);i(B),gt=!0}return pt(t,se)},async B=>{let ct=gt;gt=!0;let Kt=await It(B,re,23),oe=ct?b(...Kt):b(F,...Z,...Kt);i(oe)}]}var At=`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
TzELMAkGA1UEBhMCVVMxKTAnBgNVBAoTIEludGVybmV0IFNlY3VyaXR5IFJlc2Vh
cmNoIEdyb3VwMRUwEwYDVQQDEwxJU1JHIFJvb3QgWDEwHhcNMTUwNjA0MTEwNDM4
WhcNMzUwNjA0MTEwNDM4WjBPMQswCQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJu
ZXQgU2VjdXJpdHkgUmVzZWFyY2ggR3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBY
MTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAK3oJHP0FDfzm54rVygc
h77ct984kIxuPOZXoHj3dcKi/vVqbvYATyjb3miGbESTtrFj/RQSa78f0uoxmyF+
0TM8ukj13Xnfs7j/EvEhmkvBioZxaUpmZmyPfjxwv60pIgbz5MDmgK7iS4+3mX6U
A5/TR5d8mUgjU+g4rk8Kb4Mu0UlXjIB0ttov0DiNewNwIRt18jA8+o+u3dpjq+sW
T8KOEUt+zwvo/7V3LvSye0rgTBIlDHCNAymg4VMk7BPZ7hm/ELNKjD+Jo2FR3qyH
B5T0Y3HsLuJvW5iB4YlcNHlsdu87kGJ55tukmi8mxdAQ4Q7e2RCOFvu396j3x+UC
B5iPNgiV5+I3lg02dZ77DnKxHZu8A/lJBdiB3QW0KtZB6awBdpUKD9jf1b0SHzUv
KBds0pjBqAlkd25HN7rOrFleaJ1/ctaJxQZBKT5ZPt0m9STJEadao0xAH0ahmbWn
OlFuhjuefXKnEgV4We0+UXgVCwOPjdAvBbI+e0ocS3MFEvzG6uBQE3xDk3SzynTn
jh8BCNAw1FtxNrQHusEwMFxIt4I7mKZ9YIqioymCzLq9gwQbooMDQaHWBfEbwrbw
qHyGO0aoSCqI3Haadr8faqU9GY/rOPNk3sgrDQoo//fb4hVC1CLQJ13hef4Y53CI
rU7m2Ys6xt0nUW7/vGT1M0NPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNV
HRMBAf8EBTADAQH/MB0GA1UdDgQWBBR5tFnme7bl5AFzgAiIyBpY9umbbjANBgkq
hkiG9w0BAQsFAAOCAgEAVR9YqbyyqFDQDLHYGmkgJykIrGF1XIpu+ILlaS/V9lZL
ubhzEFnTIZd+50xx+7LSYK05qAvqFyFWhfFQDlnrzuBZ6brJFe+GnY+EgPbk6ZGQ
3BebYhtF8GaV0nxvwuo77x/Py9auJ/GpsMiu/X1+mvoiBOv/2X/qkSsisRcOj/KK
NFtY2PwByVS5uCbMiogziUwthDyC3+6WVwW6LLv3xLfHTjuCvjHIInNzktHCgKQ5
ORAzI4JMPJ+GslWYHb4phowim57iaztXOoJwTdwJx4nLCgdNbOhdjsnvzqvHu7Ur
TkXWStAmzOVyyghqpZXjFaH3pO3JLF+l+/+sKAIuvtd7u+Nxe5AW0wdeRlN8NwdC
jNPElpzVmbUq4JUagEiuTDkHzsxHpFKVK7q4+63SM1N95R1NbdWhscdCb+ZAJzVc
oyi3B43njTOQ5yOf+1CceWxG1bQVs5ZufpsMljq4Ui0/1lvh+wjChP4kqKOJ2qxq
4RgqsahDYVvTH9w7jXbyLeiNdd8XM2w9U/t7y0Ff/9yi0GE44Za4rF2LN9d11TPA
mRGunUHBcnWEvgJBQl9nJEiU0Zsnvgc/ubhPgXRR4Xq37Z0j4r7g1SgEEzwxA57d
emyPxgcYxn/eR44/KJ4EBs+lVDR3veyJm+kXQ99b21/+jh5Xos1AnX5iItreGCc=
-----END CERTIFICATE-----
`;var bt=`-----BEGIN CERTIFICATE-----
MIICGzCCAaGgAwIBAgIQQdKd0XLq7qeAwSxs6S+HUjAKBggqhkjOPQQDAzBPMQsw
CQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJuZXQgU2VjdXJpdHkgUmVzZWFyY2gg
R3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBYMjAeFw0yMDA5MDQwMDAwMDBaFw00
MDA5MTcxNjAwMDBaME8xCzAJBgNVBAYTAlVTMSkwJwYDVQQKEyBJbnRlcm5ldCBT
ZWN1cml0eSBSZXNlYXJjaCBHcm91cDEVMBMGA1UEAxMMSVNSRyBSb290IFgyMHYw
EAYHKoZIzj0CAQYFK4EEACIDYgAEzZvVn4CDCuwJSvMWSj5cz3es3mcFDR0HttwW
+1qLFNvicWDEukWVEYmO6gbf9yoWHKS5xcUy4APgHoIYOIvXRdgKam7mAHf7AlF9
ItgKbppbd9/w+kHsOdx1ymgHDB/qo0IwQDAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUfEKWrt5LSDv6kviejM9ti6lyN5UwCgYIKoZI
zj0EAwMDaAAwZQIwe3lORlCEwkSHRhtFcP9Ymd70/aTSVaYgLXTWNLxBo1BfASdW
tL4ndQavEi51mI38AjEAi/V3bNTIZargCyzuFJ0nN6T5U6VR5CmD1/iQMVtCnwr1
/q4AaOeMSQ+2b1tbFfLn
-----END CERTIFICATE-----
`;async function Xt(s,e){let t=Date.now(),i=Ae(s),n=i.hostname,r=/[.]neon[.]tech$/.test(n),o=!1,c=r,a=i.port||"5432",h=i.username,d=c?`project=${n.match(/^[^.]+/)[0]};${i.password}`:i.password,l=i.pathname.slice(1),g=!1,u=await e(n,a,()=>{if(!g)throw new Error("Unexpected connection close")}),p=new w(8),S=p.writeLengthUint32Incl(0);p.writeUint32(80877103,"SSL request code"),S();let v=p.array();if(!o){u.write(v);let R=await u.read(1);new w(R).expectUint8(83,'"S" = SSL connection supported')}let x=new w(1);x.writeUTF8String("S");let E=x.array(),$=_.fromPEM(At+bt),[K,V]=o?await mt(n,$,u.read,u.write,!c,v,E,'"S" = SSL connection supported'):await mt(n,$,u.read,u.write,!c),f=new w(1024),H=f.writeLengthUint32Incl(0);f.writeUint32(196608,0),f.writeUTF8StringNullTerminated("user"),f.writeUTF8StringNullTerminated(h),f.writeUTF8StringNullTerminated("database"),f.writeUTF8StringNullTerminated(l),f.writeUint8(0,0),H(),f.writeUTF8String("p");let j=f.writeLengthUint32Incl(0);f.writeUTF8StringNullTerminated(d),j(),f.writeUTF8String("Q");let Q=f.writeLengthUint32Incl(0);f.writeUTF8StringNullTerminated("SELECT now()"),Q(),await V(f.array());let Y=await K(),N=new w(Y);N.expectUint8("R".charCodeAt(0),0);let[I,L]=N.expectLengthUint32Incl("request"),A=N.readUint32();if(A!==3)if(A===10){for(;L()>1;){let R=N.readUTF8StringNullTerminated()}N.expectUint8(0,"null terminated list")}else throw new Error(`Unsupported auth mechanism (${A})`);if(I(),A===10)throw new Error("Unsupported SCRAM-SHA-256 auth");let C=await K(),U=new w(C);U.expectUint8("R".charCodeAt(0),0);let[F]=U.expectLengthUint32Incl(0);for(U.expectUint32(0,0),F();U.remaining()>0;){let R=U.readUTF8String(1);if(R==="S"){let[T,et]=U.expectLengthUint32Incl(0);for(;et()>0;){let J=U.readUTF8StringNullTerminated(),Z=U.readUTF8StringNullTerminated()}T()}else if(R==="K"){let[T]=U.expectLengthUint32Incl();U.readUint32(0),U.readUint32(0),T()}else if(R==="Z"){let[T]=U.expectLengthUint32Incl(0);U.expectUint8("I".charCodeAt(0),0),T()}}let q=await K(),y=new w(q);y.expectUint8("T".charCodeAt(0),0);let[O]=y.expectLengthUint32Incl(),P=y.readUint16(0);for(let R=0;R<P;R++){let T=y.readUTF8StringNullTerminated(),et=y.readUint32(0),J=y.readUint16(0),Z=y.readUint32(0),it=y.readUint16(0),st=y.readUint32(0),Et=y.readUint16(0)}O();let W;for(;y.remaining()>0;){let R=y.readUTF8String(1);if(R==="D"){let[T]=y.expectLengthUint32Incl(),et=y.readUint16(0);for(let J=0;J<et;J++){let[Z,it]=y.expectLengthUint32();W=y.readUTF8String(it()),Z()}T()}else if(R==="C"){let[T]=y.expectLengthUint32Incl();y.readUTF8StringNullTerminated(),T()}else if(R==="Z"){let[T]=y.expectLengthUint32Incl();y.expectUint8("I".charCodeAt(0),0),T()}else throw new Error(`Unexpected message type: ${R}`)}dt("%c%s","font-size: 2em",W),dt(`time taken: ${Date.now()-t}ms`);let tt=new w(5);tt.writeUTF8String("X"),tt.writeLengthUint32Incl()(),await V(tt.array()),g=!0}function Ae(s,e=!1){let{protocol:t}=new URL(s),i="http:"+s.substring(t.length),{username:n,password:r,hostname:o,port:c,pathname:a,search:h,searchParams:d,hash:l}=new URL(i);r=decodeURIComponent(r);let g=n+":"+r,u=e?Object.fromEntries(d.entries()):h;return{href:s,protocol:t,auth:g,username:n,password:r,hostname:o,port:c,pathname:a,search:h,query:u,hash:l}}var _t=`-----BEGIN CERTIFICATE-----\r
MIIDdzCCAl+gAwIBAgIEAgAAuTANBgkqhkiG9w0BAQUFADBaMQswCQYDVQQGEwJJ\r
RTESMBAGA1UEChMJQmFsdGltb3JlMRMwEQYDVQQLEwpDeWJlclRydXN0MSIwIAYD\r
VQQDExlCYWx0aW1vcmUgQ3liZXJUcnVzdCBSb290MB4XDTAwMDUxMjE4NDYwMFoX\r
DTI1MDUxMjIzNTkwMFowWjELMAkGA1UEBhMCSUUxEjAQBgNVBAoTCUJhbHRpbW9y\r
ZTETMBEGA1UECxMKQ3liZXJUcnVzdDEiMCAGA1UEAxMZQmFsdGltb3JlIEN5YmVy\r
VHJ1c3QgUm9vdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKMEuyKr\r
mD1X6CZymrV51Cni4eiVgLGw41uOKymaZN+hXe2wCQVt2yguzmKiYv60iNoS6zjr\r
IZ3AQSsBUnuId9Mcj8e6uYi1agnnc+gRQKfRzMpijS3ljwumUNKoUMMo6vWrJYeK\r
mpYcqWe4PwzV9/lSEy/CG9VwcPCPwBLKBsua4dnKM3p31vjsufFoREJIE9LAwqSu\r
XmD+tqYF/LTdB1kC1FkYmGP1pWPgkAx9XbIGevOF6uvUA65ehD5f/xXtabz5OTZy\r
dc93Uk3zyZAsuT3lySNTPx8kmCFcB5kpvcY67Oduhjprl3RjM71oGDHweI12v/ye\r
jl0qhqdNkNwnGjkCAwEAAaNFMEMwHQYDVR0OBBYEFOWdWTCCR1jMrPoIVDaGezq1\r
BE3wMBIGA1UdEwEB/wQIMAYBAf8CAQMwDgYDVR0PAQH/BAQDAgEGMA0GCSqGSIb3\r
DQEBBQUAA4IBAQCFDF2O5G9RaEIFoN27TyclhAO992T9Ldcw46QQF+vaKSm2eT92\r
9hkTI7gQCvlYpNRhcL0EYWoSihfVCr3FvDB81ukMJY2GQE/szKN+OMY3EU/t3Wgx\r
jkzSswF07r51XgdIGn9w/xZchMB5hbgF/X++ZRGjD8ACtPhSNzkE1akxehi/oCr0\r
Epn3o0WC4zxe9Z2etciefC7IpJ5OCBRLbf1wbWsaY71k5h+3zvDyny67G7fyUIhz\r
ksLi4xaNmjICq44Y3ekQEe5+NauQrz4wlHrQMz2nZQ/1/I6eYs9HRCwBXbsdtTLS\r
R9I4LtD+gdwyah617jzV/OeBHRnDJELqYzmp\r
-----END CERTIFICATE-----\r
`;var Ce=new TextDecoder;async function te(s,e,t){let i=Date.now(),n=new URL(s);if(n.protocol!=="https:")throw new Error("Wrong protocol");let r=n.hostname,o=n.port||443,c=n.pathname+n.search,a=_.fromPEM(At+bt+_t),h=await t(r,o),[d,l]=await mt(r,a,h.read,h.write),g=new w(1024);g.writeUTF8String(`${e} ${c} HTTP/1.0\r
Host: ${r}\r
\r
`),await l(g.array());let u,p="";do if(u=await d(),u){let S=Ce.decode(u);p+=S}while(u);return dt(`time taken: ${Date.now()-i}ms`),p}var Nt=class{addEventListener(...e){}},Ct=class{constructor(e){this.socket=e;this.queue=[],e instanceof(globalThis.WebSocket??Nt)?(this.socketIsWebSocket=!0,e.addEventListener("message",t=>this.enqueue(new Uint8Array(t.data))),e.addEventListener("close",()=>this.dequeue())):(this.socketIsWebSocket=!1,e.on("data",t=>this.enqueue(new Uint8Array(t))),e.on("close",()=>this.dequeue()))}queue;socketIsWebSocket;outstandingRequest;enqueue(e){this.queue.push(e),this.dequeue()}socketIsNotClosed(){let{socket:e}=this,{readyState:t}=e;return this.socketIsWebSocket?t<=1:t==="opening"||t==="open"}dequeue(){if(this.outstandingRequest===void 0)return;let{resolve:e,bytes:t}=this.outstandingRequest,i=this.bytesInQueue();if(i<t&&this.socketIsNotClosed())return;if(t=Math.min(t,i),t===0)return e(void 0);this.outstandingRequest=void 0;let n=this.queue[0],r=n.length;if(r===t)return this.queue.shift(),e(n);if(r>t)return this.queue[0]=n.subarray(t),e(n.subarray(0,t));{let o=new Uint8Array(t),c=t,a=0;for(;c>0;){let h=this.queue[0],d=h.length;d<=c?(this.queue.shift(),o.set(h,a),a+=d,c-=d):(this.queue[0]=h.subarray(c),o.set(h.subarray(0,c),a),c-=c,a+=c)}return e(o)}}bytesInQueue(){return this.queue.reduce((e,t)=>e+t.length,0)}async read(e){if(this.outstandingRequest!==void 0)throw new Error("Can\u2019t read while already awaiting read");return new Promise(t=>{this.outstandingRequest={resolve:t,bytes:e},this.dequeue()})}};async function vt(s,e,t=()=>{}){let i=await new Promise(c=>{let a=new WebSocket(`wss://ws.manipulexity.com/v1?address=${s}:${e}`);a.binaryType="arraybuffer",a.addEventListener("open",()=>c(a)),a.addEventListener("error",h=>{console.log("ws error:",h)}),a.addEventListener("close",()=>{console.log("connection closed"),t()})}),n=new Ct(i),r=n.read.bind(n),o=i.send.bind(i);return{read:r,write:o}}var Rt=location.hash.slice(1),ee=Rt&&Rt.startsWith("postgres"),ne=document.getElementById("go"),ve=document.getElementById("heading");ee&&(ne.value="Ask Postgres the time over TLS",ve.textContent="Postgres + TLS, byte-by-byte, LIVE!");ne.addEventListener("click",()=>{ee?Xt(Rt,vt):te("https://subtls.pages.dev","GET",vt)});
