var rt=class{constructor(e){this.ws=e;this.queue=[],e.addEventListener("message",t=>this.enqueue(new Uint8Array(t.data))),e.addEventListener("close",()=>this.dequeue())}queue;outstandingRequest;enqueue(e){this.queue.push(e),this.dequeue()}dequeue(){if(this.outstandingRequest===void 0)return;let{resolve:e,bytes:t}=this.outstandingRequest,r=this.bytesInQueue();if(r<t&&this.ws.readyState<=1)return;if(t=Math.min(t,r),t===0)return e(void 0);this.outstandingRequest=void 0;let n=this.queue[0],i=n.length;if(i===t)return this.queue.shift(),e(n);if(i>t)return this.queue[0]=n.subarray(t),e(n.subarray(0,t));{let o=new Uint8Array(t),a=t,c=0;for(;a>0;){let h=this.queue[0],l=h.length;l<=a?(this.queue.shift(),o.set(h,c),c+=l,a-=l):(this.queue[0]=h.subarray(a),o.set(h.subarray(0,a),c),a-=a,c+=a)}return e(o)}}bytesInQueue(){return this.queue.reduce((e,t)=>e+t.length,0)}async read(e){if(this.outstandingRequest!==void 0)throw new Error("Can\u2019t read while already awaiting read");return new Promise(t=>{this.outstandingRequest={resolve:t,bytes:e},this.dequeue()})}};function v(...s){if(s.length===1&&s[0]instanceof Uint8Array)return s[0];let e=s.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e),r=0;for(let n of s)t.set(n,r),r+=n.length;return t}function G(s,e){let t=s.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(s[r]!==e[r])return!1;return!0}var ht="\xB7\xB7 ";var Bt=new TextEncoder,se=new TextDecoder,U=class{offset;dataView;data;comments;indents;indent;constructor(e){this.offset=0,this.data=typeof e=="number"?new Uint8Array(e):e,this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength),this.comments={},this.indents={},this.indent=0}extend(e){let t=typeof e=="number"?new Uint8Array(e):e;this.data=v(this.data,t),this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}remaining(){return this.data.length-this.offset}subarray(e){return this.data.subarray(this.offset,this.offset+=e)}skip(e,t){return this.offset+=e,t&&this.comment(t),this}comment(e,t=this.offset){throw new Error("No comments should be emitted outside of chatty mode")}readBytes(e){return this.data.slice(this.offset,this.offset+=e)}readUTF8String(e){let t=this.subarray(e);return se.decode(t)}readUTF8StringNullTerminated(){let e=this.offset;for(;this.data[e]!==0;)e++;let t=this.readUTF8String(e-this.offset);return this.expectUint8(0,"end of string"),t}readUint8(e){let t=this.dataView.getUint8(this.offset);return this.offset+=1,t}readUint16(e){let t=this.dataView.getUint16(this.offset);return this.offset+=2,t}readUint24(e){let t=this.readUint8(),r=this.readUint16();return(t<<16)+r}readUint32(e){let t=this.dataView.getUint32(this.offset);return this.offset+=4,t}expectBytes(e,t){let r=this.readBytes(e.length);if(!G(r,e))throw new Error("Unexpected bytes")}expectUint8(e,t){let r=this.readUint8();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint16(e,t){let r=this.readUint16();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint24(e,t){let r=this.readUint24();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint32(e,t){let r=this.readUint32();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectLength(e,t=1){let r=this.offset,n=r+e;if(n>this.data.length)throw new Error("Expected length exceeds remaining data length");return this.indent+=t,this.indents[r]=this.indent,[()=>{if(this.indent-=t,this.indents[this.offset]=this.indent,this.offset!==n)throw new Error(`${e} bytes expected but ${this.offset-r} read`)},()=>n-this.offset]}expectLengthUint8(e){let t=this.readUint8();return this.expectLength(t)}expectLengthUint16(e){let t=this.readUint16();return this.expectLength(t)}expectLengthUint24(e){let t=this.readUint24();return this.expectLength(t)}expectLengthUint32(e){let t=this.readUint32();return this.expectLength(t)}expectLengthUint8Incl(e){let t=this.readUint8();return this.expectLength(t-1)}expectLengthUint16Incl(e){let t=this.readUint16();return this.expectLength(t-2)}expectLengthUint24Incl(e){let t=this.readUint24();return this.expectLength(t-3)}expectLengthUint32Incl(e){let t=this.readUint32();return this.expectLength(t-4)}writeBytes(e){return this.data.set(e,this.offset),this.offset+=e.length,this}writeUTF8String(e){let t=Bt.encode(e);return this.writeBytes(t),this}writeUTF8StringNullTerminated(e){let t=Bt.encode(e);return this.writeBytes(t),this.writeUint8(0),this}writeUint8(e,t){return this.dataView.setUint8(this.offset,e),this.offset+=1,this}writeUint16(e,t){return this.dataView.setUint16(this.offset,e),this.offset+=2,this}writeUint24(e,t){return this.writeUint8((e&16711680)>>16),this.writeUint16(e&65535,t),this}writeUint32(e,t){return this.dataView.setUint32(this.offset,e),this.offset+=4,this}_writeLengthGeneric(e,t,r){let n=this.offset;this.offset+=e;let i=this.offset;return this.indent+=1,this.indents[i]=this.indent,()=>{let o=this.offset-(t?n:i);if(e===1)this.dataView.setUint8(n,o);else if(e===2)this.dataView.setUint16(n,o);else if(e===3)this.dataView.setUint8(n,(o&16711680)>>16),this.dataView.setUint16(n+1,o&65535);else if(e===4)this.dataView.setUint32(n,o);else throw new Error(`Invalid length for length field: ${e}`);this.indent-=1,this.indents[this.offset]=this.indent}}writeLengthUint8(e){return this._writeLengthGeneric(1,!1,e)}writeLengthUint16(e){return this._writeLengthGeneric(2,!1,e)}writeLengthUint24(e){return this._writeLengthGeneric(3,!1,e)}writeLengthUint32(e){return this._writeLengthGeneric(4,!1,e)}writeLengthUint8Incl(e){return this._writeLengthGeneric(1,!0,e)}writeLengthUint16Incl(e){return this._writeLengthGeneric(2,!0,e)}writeLengthUint24Incl(e){return this._writeLengthGeneric(3,!0,e)}writeLengthUint32Incl(e){return this._writeLengthGeneric(4,!0,e)}array(){return this.data.subarray(0,this.offset)}commentedString(e=!1){let t=this.indents[0]!==void 0?ht.repeat(this.indents[0]):"",r=this.indents[0]??0,n=e?this.data.length:this.offset;for(let i=0;i<n;i++){t+=this.data[i].toString(16).padStart(2,"0")+" ";let o=this.comments[i+1];this.indents[i+1]!==void 0&&(r=this.indents[i+1]),o&&(t+=` ${o}
${ht.repeat(r)}`)}return t}};var Ne=new RegExp(`  .+|^(${ht})+`,"gm");var Ht,Lt,Kt;function ae(s){return Lt??={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},Kt??=new RegExp("["+Object.keys(Lt).join("")+"]","g"),s.replace(Kt,e=>Lt[e])}function oe(...s){let e="<span>",t,r,n="";for(;(t=s.shift())!==void 0;){t=n+ae(String(t)),n=" ";let i=/([\s\S]*?)%([csoOidf])|[\s\S]+/g;for(;(r=i.exec(t))!==null;){let[o,a,c]=r;c===void 0?e+=o:(e+=a,c==="c"?e+=`</span><span style="${s.shift()}">`:c==="s"?e+=s.shift():c==="o"||c==="O"?e+=JSON.stringify(s.shift(),void 0,c==="O"?2:void 0):(c==="i"||c==="d"||c==="f")&&(e+=String(s.shift())))}}return e+="</span>",e}var ce=0;function dt(...s){console.log(...s),Ht??=document.querySelector("#logs"),Ht.innerHTML+=`<label><input type="checkbox" name="c${ce++}"><div class="section">`+oe(...s)+"</div></label>"}function Et(s,e,t,r=!0){let n=new U(1024);n.writeUint8(22,0),n.writeUint16(769,0);let i=n.writeLengthUint16();n.writeUint8(1,0);let o=n.writeLengthUint24();n.writeUint16(771,0),crypto.getRandomValues(n.subarray(32));let a=n.writeLengthUint8(0);n.writeBytes(t),a();let c=n.writeLengthUint16(0);n.writeUint16(4865,0),c();let h=n.writeLengthUint8(0);n.writeUint8(0,0),h();let l=n.writeLengthUint16(0);if(r){n.writeUint16(0,0);let B=n.writeLengthUint16(0),H=n.writeLengthUint16(0);n.writeUint8(0,0);let W=n.writeLengthUint16(0);n.writeUTF8String(s),W(),H(),B()}n.writeUint16(11,0);let d=n.writeLengthUint16(0),m=n.writeLengthUint8(0);n.writeUint8(0,0),m(),d(),n.writeUint16(10,0);let p=n.writeLengthUint16(0),f=n.writeLengthUint16(0);n.writeUint16(23,0),f(),p(),n.writeUint16(13,0);let x=n.writeLengthUint16(0),S=n.writeLengthUint16(0);n.writeUint16(1027,0),n.writeUint16(2052,0),S(),x(),n.writeUint16(43,0);let w=n.writeLengthUint16(0),L=n.writeLengthUint8(0);n.writeUint16(772,0),L(),w(),n.writeUint16(51,0);let q=n.writeLengthUint16(0),F=n.writeLengthUint16(0);n.writeUint16(23,0);let A=n.writeLengthUint16(0);return n.writeBytes(new Uint8Array(e)),A(),F(),q(),l(),o(),i(),n}function P(s,e=""){return[...s].map(t=>t.toString(16).padStart(2,"0")).join(e)}function Tt(s,e){let t,r,[n]=s.expectLength(s.remaining());s.expectUint8(2,0);let[i]=s.expectLengthUint24(0);s.expectUint16(771,0);let o=s.readBytes(32);if(G(o,[207,33,173,116,229,154,97,17,190,29,140,2,30,101,184,145,194,162,17,22,122,187,140,94,7,158,9,226,200,168,51,156]))throw new Error("Unexpected HelloRetryRequest");s.expectUint8(e.length,0),s.expectBytes(e,0),s.expectUint16(4865,0),s.expectUint8(0,0);let[a,c]=s.expectLengthUint16(0);for(;c()>0;){let h=s.readUint16(0),[l]=s.expectLengthUint16(0);if(h===43)s.expectUint16(772,0),r=!0;else if(h===51)s.expectUint16(23,0),s.expectUint16(65),t=s.readBytes(65);else throw new Error(`Unexpected extension 0x${P([h])}`);l()}if(a(),i(),n(),r!==!0)throw new Error("No TLS version provided");if(t===void 0)throw new Error("No key provided");return t}var lt=1<<14,he=lt+1+255;async function pt(s,e,t=lt){let n=await s(5);if(n===void 0)return;if(n.length<5)throw new Error("TLS record header truncated");let i=new U(n),o=i.readUint8();if(o<20||o>24)throw new Error(`Illegal TLS record type 0x${o.toString(16)}`);if(e!==void 0&&o!==e)throw new Error(`Unexpected TLS record type 0x${o.toString(16).padStart(2,"0")} (expected 0x${e.toString(16).padStart(2,"0")})`);let a=i.readUint16(0);if([769,770,771].indexOf(a)<0)throw new Error(`Unsupported TLS record version 0x${a.toString(16).padStart(4,"0")}`);let c=i.readUint16(0);if(c>t)throw new Error(`Record too long: ${c} bytes`);let h=await s(c);if(h===void 0||h.length<c)throw new Error("TLS record content truncated");return{headerData:n,header:i,type:o,version:a,length:c,content:h}}async function ft(s,e,t){let r=await pt(s,23,he);if(r===void 0)return;let n=new U(r.content),[i]=n.expectLength(n.remaining());n.skip(r.length-16,0),n.skip(16,0),i();let o=await e.process(r.content,16,r.headerData),a=o.length-1;for(;o[a]===0;)a-=1;if(a<0)throw new Error("Decrypted message has no record type indicator (all zeroes)");let c=o[a],h=o.subarray(0,a);if(!(c===21&&h.length===2&&h[0]===1&&h[1]===0)){if(c===22&&h[0]===4)return ft(s,e,t);if(t!==void 0&&c!==t)throw new Error(`Unexpected TLS record type 0x${c.toString(16).padStart(2,"0")} (expected 0x${t.toString(16).padStart(2,"0")})`);return h}}async function de(s,e,t){let r=v(s,[t]),n=5,a=r.length+16,c=new U(n+a);c.writeUint8(23,0),c.writeUint16(771,0),c.writeUint16(a,`${a} bytes follow`);let[h]=c.expectLength(a),l=c.array(),d=await e.process(r,16,l);return c.writeBytes(d.subarray(0,d.length-16)),c.writeBytes(d.subarray(d.length-16)),h(),c.array()}async function It(s,e,t){let r=Math.ceil(s.length/lt),n=[];for(let i=0;i<r;i++){let o=s.subarray(i*lt,(i+1)*lt),a=await de(o,e,t);n.push(a)}return n}var y=crypto.subtle;var Ft=new TextEncoder;async function kt(s,e,t){let r=await y.importKey("raw",s,{name:"HMAC",hash:{name:`SHA-${t}`}},!1,["sign"]);var n=new Uint8Array(await y.sign("HMAC",r,e));return n}async function le(s,e,t,r){let n=r>>3,i=Math.ceil(t/n),o=new Uint8Array(i*n),a=await y.importKey("raw",s,{name:"HMAC",hash:{name:`SHA-${r}`}},!1,["sign"]),c=new Uint8Array(0);for(let h=0;h<i;h++){let l=v(c,e,[h+1]),d=await y.sign("HMAC",a,l),m=new Uint8Array(d);o.set(m,n*h),c=m}return o.subarray(0,t)}var qt=Ft.encode("tls13 ");async function k(s,e,t,r,n){let i=Ft.encode(e),o=v([(r&65280)>>8,r&255],[qt.length+i.length],qt,i,[t.length],t);return le(s,o,r,n)}async function $t(s,e,t,r,n){let i=r>>3,o=new Uint8Array(i),a=await y.importKey("raw",s,{name:"ECDH",namedCurve:"P-256"},!1,[]),c=await y.deriveBits({name:"ECDH",public:a},e,256),h=new Uint8Array(c),l=await y.digest("SHA-256",t),d=new Uint8Array(l),m=await kt(new Uint8Array(1),o,r),p=await y.digest(`SHA-${r}`,new Uint8Array(0)),f=new Uint8Array(p),x=await k(m,"derived",f,i,r),S=await kt(x,h,r),w=await k(S,"c hs traffic",d,i,r),L=await k(S,"s hs traffic",d,i,r),q=await k(w,"key",new Uint8Array(0),n,r),F=await k(L,"key",new Uint8Array(0),n,r),A=await k(w,"iv",new Uint8Array(0),12,r),B=await k(L,"iv",new Uint8Array(0),12,r);return{serverHandshakeKey:F,serverHandshakeIV:B,clientHandshakeKey:q,clientHandshakeIV:A,handshakeSecret:S,clientSecret:w,serverSecret:L}}async function Ot(s,e,t,r){let n=t>>3,i=new Uint8Array(n),o=await y.digest(`SHA-${t}`,new Uint8Array(0)),a=new Uint8Array(o),c=await k(s,"derived",a,n,t),h=await kt(c,i,t),l=await k(h,"c ap traffic",e,n,t),d=await k(h,"s ap traffic",e,n,t),m=await k(l,"key",new Uint8Array(0),r,t),p=await k(d,"key",new Uint8Array(0),r,t),f=await k(l,"iv",new Uint8Array(0),12,t),x=await k(d,"iv",new Uint8Array(0),12,t);return{serverApplicationKey:p,serverApplicationIV:x,clientApplicationKey:m,clientApplicationIV:f}}var ye=1<<30,_=class{mode;key;initialIv;ivLength;currentIv;currentIvDataView;initialIvLast32;recordsDecrypted=0;constructor(e,t,r){this.mode=e,this.key=t,this.initialIv=r,this.ivLength=r.length,this.currentIv=r.slice(),this.currentIvDataView=new DataView(this.currentIv.buffer,this.currentIv.byteOffset,this.currentIv.byteLength),this.initialIvLast32=this.currentIvDataView.getUint32(this.ivLength-4)}async process(e,t,r){if(this.recordsDecrypted===ye)throw new Error("Cannot encrypt/decrypt any more records");let n=this.initialIvLast32^this.recordsDecrypted;this.currentIvDataView.setUint32(this.ivLength-4,n),this.recordsDecrypted+=1;let i=t<<3,o={name:"AES-GCM",iv:this.currentIv,tagLength:i,additionalData:r},a=await y[this.mode](o,this.key,e);return new Uint8Array(a)}};function wt(s){return s>64&&s<91?s-65:s>96&&s<123?s-71:s>47&&s<58?s+4:s===43?62:s===47?63:s===61?64:void 0}function Vt(s){let e=s.length,t=0,r=0,n=64,i=64,o=64,a=64,c=new Uint8Array(e*.75);for(;t<e;)n=wt(s.charCodeAt(t++)),i=wt(s.charCodeAt(t++)),o=wt(s.charCodeAt(t++)),a=wt(s.charCodeAt(t++)),c[r++]=n<<2|i>>4,c[r++]=(i&15)<<4|o>>2,c[r++]=(o&3)<<6|a;let h=i===64?0:o===64?2:a===64?1:0;return c.subarray(0,r-h)}var Y=class extends U{readASN1Length(e){let t=this.readUint8();if(t<128)return t;let r=t&127,n=0;if(r===1)return this.readUint8(n);if(r===2)return this.readUint16(n);if(r===3)return this.readUint24(n);if(r===4)return this.readUint32(n);throw new Error(`ASN.1 length fields are only supported up to 4 bytes (this one is ${r} bytes)`)}expectASN1Length(e){let t=this.readASN1Length(e);return this.expectLength(t)}readASN1OID(){let[e,t]=this.expectASN1Length(0),r=this.readUint8(),n=`${Math.floor(r/40)}.${r%40}`;for(;t()>0;){let i=0;for(;;){let o=this.readUint8();if(i<<=7,i+=o&127,o<128)break}n+=`.${i}`}return e(),n}readASN1Boolean(){let[e,t]=this.expectASN1Length(0),r=t();if(r!==1)throw new Error(`Boolean has weird length: ${r}`);let n=this.readUint8(),i;if(n===255)i=!0;else if(n===0)i=!1;else throw new Error(`Boolean has weird value: 0x${P([n])}`);return e(),i}readASN1UTCTime(){let[e,t]=this.expectASN1Length(0),n=this.readUTF8String(t()).match(/^(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z$/);if(!n)throw new Error("Unrecognised UTC time format in certificate validity");let[,i,o,a,c,h,l]=n,d=parseInt(i,10),m=d+(d>=50?1900:2e3),p=new Date(`${m}-${o}-${a}T${c}:${h}:${l}Z`);return e(),p}readASN1BitString(){let[e,t]=this.expectASN1Length(0),r=this.readUint8(0),n=t(),i=this.readBytes(n);if(r>7)throw new Error(`Invalid right pad value: ${r}`);if(r>0){let o=8-r;for(let a=n-1;a>0;a--)i[a]=255&i[a-1]<<o|i[a]>>>r;i[0]=i[0]>>>r}return e(),i}};var xt=1,it=2,D=48,me=49,tt=6,ge=19,ue=12,Dt=23,Ut=5,Z=4,St=3,Pt=163,st=128;var pe={"2.5.4.6":"C","2.5.4.10":"O","2.5.4.11":"OU","2.5.4.3":"CN","2.5.4.7":"L","2.5.4.8":"ST","2.5.4.12":"T","2.5.4.42":"GN","2.5.4.43":"I","2.5.4.4":"SN","1.2.840.113549.1.9.1":"E-mail"};function Mt(s){let{length:e}=s;if(e>4)throw new Error(`Bit string length ${e} would overflow JS bit operators`);let t=0,r=0;for(let n=s.length-1;n>=0;n--)t|=s[n]<<r,r+=8;return t}function Nt(s,e){let t={};s.expectUint8(D,0);let[r,n]=s.expectASN1Length(0);for(;n()>0;){s.expectUint8(me,0);let[i]=s.expectASN1Length(0);s.expectUint8(D,0);let[o]=s.expectASN1Length(0);s.expectUint8(tt,0);let a=s.readASN1OID(),c=pe[a]??a,h=s.readUint8();if(h!==ge){if(h!==ue)throw new Error(`Unexpected item type in certificate ${e}: 0x${P([h])}`)}let[l,d]=s.expectASN1Length(0),m=s.readUTF8String(d());if(l(),o(),i(),t[c]!==void 0)throw new Error(`Duplicate OID ${c} in certificate ${e}`);t[c]=m}return r(),t}function jt(s,e=0){let t=[],[r,n]=s.expectASN1Length(0);for(;n()>0;){let i=s.readUint8(0),[o,a]=s.expectASN1Length(0),c;i===(e|2)?c=s.readUTF8String(a()):c=s.readBytes(a()),t.push({name:c,type:i}),o()}return r(),t}function Qt(s){let e={"1.2.840.113549.1.1.1":{name:"RSAES-PKCS1-v1_5"},"1.2.840.113549.1.1.5":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}},"1.2.840.113549.1.1.11":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},"1.2.840.113549.1.1.12":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},"1.2.840.113549.1.1.13":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}},"1.2.840.113549.1.1.10":{name:"RSA-PSS"},"1.2.840.113549.1.1.7":{name:"RSA-OAEP"},"1.2.840.10045.2.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.3.2":{name:"ECDSA",hash:{name:"SHA-256"}},"1.2.840.10045.4.3.3":{name:"ECDSA",hash:{name:"SHA-384"}},"1.2.840.10045.4.3.4":{name:"ECDSA",hash:{name:"SHA-512"}},"1.3.133.16.840.63.0.2":{name:"ECDH",kdf:"SHA-1"},"1.3.132.1.11.1":{name:"ECDH",kdf:"SHA-256"},"1.3.132.1.11.2":{name:"ECDH",kdf:"SHA-384"},"1.3.132.1.11.3":{name:"ECDH",kdf:"SHA-512"},"2.16.840.1.101.3.4.1.2":{name:"AES-CBC",length:128},"2.16.840.1.101.3.4.1.22":{name:"AES-CBC",length:192},"2.16.840.1.101.3.4.1.42":{name:"AES-CBC",length:256},"2.16.840.1.101.3.4.1.6":{name:"AES-GCM",length:128},"2.16.840.1.101.3.4.1.26":{name:"AES-GCM",length:192},"2.16.840.1.101.3.4.1.46":{name:"AES-GCM",length:256},"2.16.840.1.101.3.4.1.4":{name:"AES-CFB",length:128},"2.16.840.1.101.3.4.1.24":{name:"AES-CFB",length:192},"2.16.840.1.101.3.4.1.44":{name:"AES-CFB",length:256},"2.16.840.1.101.3.4.1.5":{name:"AES-KW",length:128},"2.16.840.1.101.3.4.1.25":{name:"AES-KW",length:192},"2.16.840.1.101.3.4.1.45":{name:"AES-KW",length:256},"1.2.840.113549.2.7":{name:"HMAC",hash:{name:"SHA-1"}},"1.2.840.113549.2.9":{name:"HMAC",hash:{name:"SHA-256"}},"1.2.840.113549.2.10":{name:"HMAC",hash:{name:"SHA-384"}},"1.2.840.113549.2.11":{name:"HMAC",hash:{name:"SHA-512"}},"1.2.840.113549.1.9.16.3.5":{name:"DH"},"1.3.14.3.2.26":{name:"SHA-1"},"2.16.840.1.101.3.4.2.1":{name:"SHA-256"},"2.16.840.1.101.3.4.2.2":{name:"SHA-384"},"2.16.840.1.101.3.4.2.3":{name:"SHA-512"},"1.2.840.113549.1.5.12":{name:"PBKDF2"},"1.2.840.10045.3.1.7":{name:"P-256"},"1.3.132.0.34":{name:"P-384"},"1.3.132.0.35":{name:"P-521"}}[s];if(e===void 0)throw new Error(`Unsupported algorithm identifier: ${s}`);return e}function Wt(s,e=[]){return Object.values(s).forEach(t=>{typeof t=="string"?e=[...e,t]:e=Wt(t,e)}),e}function Jt(s){return Wt(s).join(" / ")}var fe=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],yt=class{serialNumber;algorithm;issuer;validityPeriod;subject;publicKey;signature;keyUsage;subjectAltNames;extKeyUsage;authorityKeyIdentifier;subjectKeyIdentifier;basicConstraints;signedData;constructor(e){let t=e instanceof Y?e:new Y(e);t.expectUint8(D,0);let[r]=t.expectASN1Length(0),n=t.offset;t.expectUint8(D,0);let[i]=t.expectASN1Length(0);t.expectBytes([160,3,2,1,2],0),t.expectUint8(it,0);let[o,a]=t.expectASN1Length(0);this.serialNumber=t.subarray(a()),o(),t.expectUint8(D,0);let[c,h]=t.expectASN1Length(0);t.expectUint8(tt,0),this.algorithm=t.readASN1OID(),h()>0&&(t.expectUint8(Ut,0),t.expectUint8(0,0)),c(),this.issuer=Nt(t,"issuer"),t.expectUint8(D,0);let[l]=t.expectASN1Length(0);t.expectUint8(Dt,0);let d=t.readASN1UTCTime();t.expectUint8(Dt,0);let m=t.readASN1UTCTime();this.validityPeriod={notBefore:d,notAfter:m},l(),this.subject=Nt(t,"subject");let p=t.offset;t.expectUint8(D,0);let[f]=t.expectASN1Length(0);t.expectUint8(D,0);let[x,S]=t.expectASN1Length(0),w=[];for(;S()>0;){let J=t.readUint8();if(J===tt){let $=t.readASN1OID();w.push($)}else J===Ut&&t.expectUint8(0,0)}x(),t.expectUint8(St,0);let L=t.readASN1BitString();this.publicKey={identifiers:w,data:L,all:t.data.subarray(p,t.offset)},f(),t.expectUint8(Pt,0);let[q]=t.expectASN1Length();t.expectUint8(D,0);let[F,A]=t.expectASN1Length(0);for(;A()>0;){t.expectUint8(D,0);let[J,$]=t.expectASN1Length();t.expectUint8(tt,0);let M=t.readASN1OID();if(M==="2.5.29.17"){t.expectUint8(Z,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let b=jt(t,st);this.subjectAltNames=b.filter(T=>T.type===(2|st)).map(T=>T.name),I()}else if(M==="2.5.29.15"){t.expectUint8(xt,0);let I=t.readASN1Boolean();t.expectUint8(Z,0);let[b]=t.expectASN1Length(0);t.expectUint8(St,0);let T=t.readASN1BitString(),u=Mt(T),K=new Set(fe.filter((O,g)=>u&1<<g));b(),this.keyUsage={critical:I,usages:K}}else if(M==="2.5.29.37"){this.extKeyUsage={},t.expectUint8(Z,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let[b,T]=t.expectASN1Length(0);for(;T()>0;){t.expectUint8(tt,0);let u=t.readASN1OID();u==="1.3.6.1.5.5.7.3.1"&&(this.extKeyUsage.serverTls=!0),u==="1.3.6.1.5.5.7.3.2"&&(this.extKeyUsage.clientTls=!0)}b(),I()}else if(M==="2.5.29.35"){t.expectUint8(Z,0);let[I]=t.expectASN1Length(0);t.expectUint8(D,0);let[b,T]=t.expectASN1Length(0);for(;T()>0;){let u=t.readUint8();if(u===(st|0)){let[K,O]=t.expectASN1Length(0);this.authorityKeyIdentifier=t.readBytes(O()),K()}else if(u===(st|1)||u===(st|2)){let[K,O]=t.expectASN1Length(0);t.skip(O(),0),K()}else throw new Error("Unexpected data type in authorityKeyIdentifier certificate extension")}b(),I()}else if(M==="2.5.29.14"){t.expectUint8(Z,0);let[I]=t.expectASN1Length(0);t.expectUint8(Z,0);let[b,T]=t.expectASN1Length(0);this.subjectKeyIdentifier=t.readBytes(T()),b(),I()}else if(M==="2.5.29.19"){let I,b=t.readUint8();if(b===xt&&(I=t.readASN1Boolean(),b=t.readUint8()),b!==Z)throw new Error("Unexpected type in certificate basic constraints");let[T]=t.expectASN1Length(0);t.expectUint8(D,0);let[u,K]=t.expectASN1Length(),O;K()>0&&(t.expectUint8(xt,0),O=t.readASN1Boolean());let g;if(K()>0){t.expectUint8(it,0);let C=t.readASN1Length(0);if(g=C===1?t.readUint8():C===2?t.readUint16():C===3?t.readUint24():void 0,g===void 0)throw new Error("Too many bytes in max path length in certificate basicConstraints")}u(),T(),this.basicConstraints={critical:I,ca:O,pathLength:g}}else t.skip($(),0);J()}F(),q(),i(),this.signedData=t.data.subarray(n,t.offset),t.expectUint8(D,0);let[B,H]=t.expectASN1Length(0);t.expectUint8(tt,0);let W=t.readASN1OID();if(H()>0&&(t.expectUint8(Ut,0),t.expectUint8(0,0)),B(),W!==this.algorithm)throw new Error(`Certificate specifies different signature algorithms inside (${this.algorithm}) and out (${W})`);t.expectUint8(St,0),this.signature=t.readASN1BitString(),r()}static fromPEM(e){let t="[A-Z0-9 ]+",r=new RegExp(`-{5}BEGIN ${t}-{5}([a-zA-Z0-9=+\\/\\n\\r]+)-{5}END ${t}-{5}`,"g"),n=[],i=null;for(;i=r.exec(e);){let o=i[1].replace(/[\r\n]/g,""),a=Vt(o),c=new this(a);n.push(c)}return n}subjectAltNameMatchingHost(e){let t=/[.][^.]+[.][^.]+$/;return(this.subjectAltNames??[]).find(r=>{let n=r,i=e;if(t.test(e)&&t.test(n)&&n.startsWith("*.")&&(n=n.slice(1),i=i.slice(i.indexOf("."))),n===i)return!0})}isValidAtMoment(e=new Date){return e>=this.validityPeriod.notBefore&&e<=this.validityPeriod.notAfter}description(){return"subject: "+Object.entries(this.subject).map(e=>e.join("=")).join(", ")+(this.subjectAltNames?`
subject alt names: `+this.subjectAltNames.join(", "):"")+(this.subjectKeyIdentifier?`
subject key id: ${P(this.subjectKeyIdentifier," ")}`:"")+`
issuer: `+Object.entries(this.issuer).map(e=>e.join("=")).join(", ")+(this.authorityKeyIdentifier?`
authority key id: ${P(this.authorityKeyIdentifier," ")}`:"")+`
validity: `+this.validityPeriod.notBefore.toISOString()+" \u2013 "+this.validityPeriod.notAfter.toISOString()+` (${this.isValidAtMoment()?"currently valid":"not valid"})`+(this.keyUsage?`
key usage (${this.keyUsage.critical?"critical":"non-critical"}): `+[...this.keyUsage.usages].join(", "):"")+(this.extKeyUsage?`
extended key usage: TLS server \u2014\xA0${this.extKeyUsage.serverTls}, TLS client \u2014\xA0${this.extKeyUsage.clientTls}`:"")+(this.basicConstraints?`
basic constraints (${this.basicConstraints.critical?"critical":"non-critical"}): CA \u2014\xA0${this.basicConstraints.ca}, path length \u2014 ${this.basicConstraints.pathLength}`:"")+`
signature algorithm: `+Jt(Qt(this.algorithm))}toJSON(){return{serialNumber:[...this.serialNumber],algorithm:this.algorithm,issuer:this.issuer,validityPeriod:{notBefore:this.validityPeriod.notBefore.toISOString(),notAfter:this.validityPeriod.notAfter.toISOString()},subject:this.subject,publicKey:{identifiers:this.publicKey.identifiers,data:[...this.publicKey.data],all:[...this.publicKey.all]},signature:[...this.signature],keyUsage:{critical:this.keyUsage?.critical,usages:[...this.keyUsage?.usages??[]]},subjectAltNames:this.subjectAltNames,extKeyUsage:this.extKeyUsage,authorityKeyIdentifier:this.authorityKeyIdentifier&&[...this.authorityKeyIdentifier],subjectKeyIdentifier:this.subjectKeyIdentifier&&[...this.subjectKeyIdentifier],basicConstraints:this.basicConstraints,signedData:[...this.signedData]}}},X=class extends yt{};async function At(s,e,t,r,n){s.expectUint8(D,0);let[i]=s.expectASN1Length(0);s.expectUint8(it,0);let[o,a]=s.expectASN1Length(0),c=s.readBytes(a());o(),s.expectUint8(it,0);let[h,l]=s.expectASN1Length(0),d=s.readBytes(l());h(),i();let m=(w,L)=>w.length>L?w.subarray(w.length-L):w.length<L?v(new Uint8Array(L-w.length),w):w,p=r==="P-256"?32:48,f=v(m(c,p),m(d,p)),x=await y.importKey("spki",e,{name:"ECDSA",namedCurve:r},!1,["verify"]);if(await y.verify({name:"ECDSA",hash:n},x,f,t)!==!0)throw new Error("ECDSA-SECP256R1-SHA256 certificate verify failed")}async function Gt(s,e,t){for(let a of e);let r=e[0];if(r.subjectAltNameMatchingHost(s)===void 0)throw new Error(`No matching subjectAltName for ${s}`);if(!r.isValidAtMoment())throw new Error("End-user certificate is not valid now");if(!r.extKeyUsage?.serverTls)throw new Error("End-user certificate has no TLS server extKeyUsage");let o=!1;for(let a of t);for(let a=0,c=e.length;a<c;a++){let h=e[a],l=h.authorityKeyIdentifier;if(l===void 0)throw new Error("Certificates without an authorityKeyIdentifier are not supported");let d=t.find(f=>f.subjectKeyIdentifier!==void 0&&G(f.subjectKeyIdentifier,l));if(d===void 0&&(d=e[a+1]),d===void 0)throw new Error("Ran out of certificates before reaching trusted root");let m=d instanceof X;if(d.isValidAtMoment()!==!0)throw new Error("Signing certificate is not valid now");if(d.keyUsage?.usages.has("digitalSignature")!==!0)throw new Error("Signing certificate keyUsage does not include digital signatures");if(d.basicConstraints?.ca!==!0)throw new Error("Signing certificate basicConstraints do not indicate a CA certificate");let{pathLength:p}=d.basicConstraints;if(p!==void 0&&p<a)throw new Error("Exceeded certificate path length");if(h.algorithm==="1.2.840.10045.4.3.2"||h.algorithm==="1.2.840.10045.4.3.3"){let f=h.algorithm==="1.2.840.10045.4.3.2"?"SHA-256":"SHA-384",x=d.publicKey.identifiers,S=x.includes("1.2.840.10045.3.1.7")?"P-256":x.includes("1.3.132.0.34")?"P-384":void 0;if(S===void 0)throw new Error("Unsupported signing key curve");let w=new Y(h.signature);await At(w,d.publicKey.all,h.signedData,S,f)}else if(h.algorithm==="1.2.840.113549.1.1.11"||h.algorithm==="1.2.840.113549.1.1.12"){let f=h.algorithm==="1.2.840.113549.1.1.11"?"SHA-256":"SHA-384",x=await y.importKey("spki",d.publicKey.all,{name:"RSASSA-PKCS1-v1_5",hash:f},!1,["verify"]);if(await y.verify({name:"RSASSA-PKCS1-v1_5"},x,h.signature,h.signedData)!==!0)throw new Error("RSASSA_PKCS1-v1_5-SHA256 certificate verify failed")}else throw new Error("Unsupported signing algorithm");if(m){o=!0;break}}return o}var we=new TextEncoder;async function zt(s,e,t,r,n){let i=new Y(await e());i.expectUint8(8,0);let[o]=i.expectLengthUint24(),[a,c]=i.expectLengthUint16(0);for(;c()>0;){let C=i.readUint16(0);if(C===0)i.expectUint16(0,0);else if(C===10){let[j,V]=i.expectLengthUint16("groups data");i.skip(V(),0),j()}else throw new Error(`Unsupported server encrypted extension type 0x${P([C]).padStart(4,"0")}`)}a(),o(),i.remaining()===0&&i.extend(await e());let h=!1,l=i.readUint8();if(l===13){h=!0;let[C]=i.expectLengthUint24("certificate request data");i.expectUint8(0,0);let[j,V]=i.expectLengthUint16("certificate request extensions");i.skip(V(),0),j(),C(),i.remaining()===0&&i.extend(await e()),l=i.readUint8()}if(l!==11)throw new Error(`Unexpected handshake message type 0x${P([l])}`);let[d]=i.expectLengthUint24(0);i.expectUint8(0,0);let[m,p]=i.expectLengthUint24(0),f=[];for(;p()>0;){let[C]=i.expectLengthUint24(0),j=new yt(i);f.push(j),C();let[V,z]=i.expectLengthUint16(),gt=i.subarray(z());V()}if(m(),d(),f.length===0)throw new Error("No certificates supplied");let x=f[0],S=i.data.subarray(0,i.offset),w=v(r,S),L=await y.digest("SHA-256",w),q=new Uint8Array(L),F=v(we.encode(" ".repeat(64)+"TLS 1.3, server CertificateVerify"),[0],q);i.remaining()===0&&i.extend(await e()),i.expectUint8(15,0);let[A]=i.expectLengthUint24(0),B=i.readUint16();if(B===1027){let[C]=i.expectLengthUint16();await At(i,x.publicKey.all,F,"P-256","SHA-256"),C()}else if(B===2052){let[C,j]=i.expectLengthUint16(),V=i.subarray(j());C();let z=await y.importKey("spki",x.publicKey.all,{name:"RSA-PSS",hash:"SHA-256"},!1,["verify"]);if(await y.verify({name:"RSA-PSS",saltLength:32},z,V,F)!==!0)throw new Error("RSA-PSS-RSAE-SHA256 certificate verify failed")}else throw new Error(`Unsupported certificate verify signature type 0x${P([B]).padStart(4,"0")}`);A();let H=i.data.subarray(0,i.offset),W=v(r,H),J=await k(t,"finished",new Uint8Array(0),32,256),$=await y.digest("SHA-256",W),M=await y.importKey("raw",J,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),I=await y.sign("HMAC",M,$),b=new Uint8Array(I);i.remaining()===0&&i.extend(await e()),i.expectUint8(20,0);let[T,u]=i.expectLengthUint24(0),K=i.readBytes(u());if(T(),i.remaining()!==0)throw new Error("Unexpected extra bytes in server handshake");if(G(K,b)!==!0)throw new Error("Invalid server verify hash");if(!await Gt(s,f,n))throw new Error("Validated certificate chain did not end in a trusted root");return[i.data,h]}async function mt(s,e,t,r,n=!0,i,o,a){let c=await y.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),h=await y.exportKey("raw",c.publicKey),l=new Uint8Array(32);crypto.getRandomValues(l);let m=Et(s,h,l,n).array(),p=i?v(i,m):m;if(r(p),o){let R=await t(o.length);if(!R||!G(R,o))throw new Error("Pre data did not match expectation")}let f=await pt(t,22);if(f===void 0)throw new Error("Connection closed while awaiting server hello");let x=new U(f.content),S=Tt(x,l),w=await pt(t,20);if(w===void 0)throw new Error("Connection closed awaiting server cipher change");let L=new U(w.content),[q]=L.expectLength(1);L.expectUint8(1,0),q();let F=m.subarray(5),A=f.content,B=v(F,A),H=await $t(S,c.privateKey,B,256,16),W=await y.importKey("raw",H.serverHandshakeKey,{name:"AES-GCM"},!1,["decrypt"]),J=new _("decrypt",W,H.serverHandshakeIV),$=await y.importKey("raw",H.clientHandshakeKey,{name:"AES-GCM"},!1,["encrypt"]),M=new _("encrypt",$,H.clientHandshakeIV),I=async()=>{let R=await ft(t,J,22);if(R===void 0)throw new Error("Premature end of encrypted server handshake");return R},[b,T]=await zt(s,I,H.serverSecret,B,e),u=new U(6);u.writeUint8(20,0),u.writeUint16(771,0);let K=u.writeLengthUint16();u.writeUint8(1,0),K();let O=u.array(),g=new Uint8Array(0);if(T){let R=new U(8);R.writeUint8(11,0);let nt=R.writeLengthUint24("client certificate data");R.writeUint8(0,0),R.writeUint24(0,0),nt(),g=R.array()}let C=v(B,b,g),j=await y.digest("SHA-256",C),V=new Uint8Array(j),z=await k(H.clientSecret,"finished",new Uint8Array(0),32,256),gt=await y.importKey("raw",z,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),N=await y.sign("HMAC",gt,V),E=new Uint8Array(N),Q=new U(36);Q.writeUint8(20,0);let et=Q.writeLengthUint24(0);Q.writeBytes(E),et();let at=Q.array(),ot=await It(v(g,at),M,22),Ct=V;if(g.length>0){let R=C.subarray(0,C.length-g.length),nt=await y.digest("SHA-256",R);Ct=new Uint8Array(nt)}let ct=await Ot(H.handshakeSecret,Ct,256,16),te=await y.importKey("raw",ct.clientApplicationKey,{name:"AES-GCM"},!1,["encrypt"]),ee=new _("encrypt",te,ct.clientApplicationIV),ne=await y.importKey("raw",ct.serverApplicationKey,{name:"AES-GCM"},!1,["decrypt"]),re=new _("decrypt",ne,ct.serverApplicationIV),ut=!1;return[()=>{if(!ut){let R=v(O,...ot);r(R),ut=!0}return ft(t,re)},async R=>{let nt=await It(R,ee,23),ie=ut?v(...nt):v(O,...ot,...nt);r(ie),ut=!0}]}var bt=`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
TzELMAkGA1UEBhMCVVMxKTAnBgNVBAoTIEludGVybmV0IFNlY3VyaXR5IFJlc2Vh
cmNoIEdyb3VwMRUwEwYDVQQDEwxJU1JHIFJvb3QgWDEwHhcNMTUwNjA0MTEwNDM4
WhcNMzUwNjA0MTEwNDM4WjBPMQswCQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJu
ZXQgU2VjdXJpdHkgUmVzZWFyY2ggR3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBY
MTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAK3oJHP0FDfzm54rVygc
h77ct984kIxuPOZXoHj3dcKi/vVqbvYATyjb3miGbESTtrFj/RQSa78f0uoxmyF+
0TM8ukj13Xnfs7j/EvEhmkvBioZxaUpmZmyPfjxwv60pIgbz5MDmgK7iS4+3mX6U
A5/TR5d8mUgjU+g4rk8Kb4Mu0UlXjIB0ttov0DiNewNwIRt18jA8+o+u3dpjq+sW
T8KOEUt+zwvo/7V3LvSye0rgTBIlDHCNAymg4VMk7BPZ7hm/ELNKjD+Jo2FR3qyH
B5T0Y3HsLuJvW5iB4YlcNHlsdu87kGJ55tukmi8mxdAQ4Q7e2RCOFvu396j3x+UC
B5iPNgiV5+I3lg02dZ77DnKxHZu8A/lJBdiB3QW0KtZB6awBdpUKD9jf1b0SHzUv
KBds0pjBqAlkd25HN7rOrFleaJ1/ctaJxQZBKT5ZPt0m9STJEadao0xAH0ahmbWn
OlFuhjuefXKnEgV4We0+UXgVCwOPjdAvBbI+e0ocS3MFEvzG6uBQE3xDk3SzynTn
jh8BCNAw1FtxNrQHusEwMFxIt4I7mKZ9YIqioymCzLq9gwQbooMDQaHWBfEbwrbw
qHyGO0aoSCqI3Haadr8faqU9GY/rOPNk3sgrDQoo//fb4hVC1CLQJ13hef4Y53CI
rU7m2Ys6xt0nUW7/vGT1M0NPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNV
HRMBAf8EBTADAQH/MB0GA1UdDgQWBBR5tFnme7bl5AFzgAiIyBpY9umbbjANBgkq
hkiG9w0BAQsFAAOCAgEAVR9YqbyyqFDQDLHYGmkgJykIrGF1XIpu+ILlaS/V9lZL
ubhzEFnTIZd+50xx+7LSYK05qAvqFyFWhfFQDlnrzuBZ6brJFe+GnY+EgPbk6ZGQ
3BebYhtF8GaV0nxvwuo77x/Py9auJ/GpsMiu/X1+mvoiBOv/2X/qkSsisRcOj/KK
NFtY2PwByVS5uCbMiogziUwthDyC3+6WVwW6LLv3xLfHTjuCvjHIInNzktHCgKQ5
ORAzI4JMPJ+GslWYHb4phowim57iaztXOoJwTdwJx4nLCgdNbOhdjsnvzqvHu7Ur
TkXWStAmzOVyyghqpZXjFaH3pO3JLF+l+/+sKAIuvtd7u+Nxe5AW0wdeRlN8NwdC
jNPElpzVmbUq4JUagEiuTDkHzsxHpFKVK7q4+63SM1N95R1NbdWhscdCb+ZAJzVc
oyi3B43njTOQ5yOf+1CceWxG1bQVs5ZufpsMljq4Ui0/1lvh+wjChP4kqKOJ2qxq
4RgqsahDYVvTH9w7jXbyLeiNdd8XM2w9U/t7y0Ff/9yi0GE44Za4rF2LN9d11TPA
mRGunUHBcnWEvgJBQl9nJEiU0Zsnvgc/ubhPgXRR4Xq37Z0j4r7g1SgEEzwxA57d
emyPxgcYxn/eR44/KJ4EBs+lVDR3veyJm+kXQ99b21/+jh5Xos1AnX5iItreGCc=
-----END CERTIFICATE-----
`;var vt=`-----BEGIN CERTIFICATE-----
MIICGzCCAaGgAwIBAgIQQdKd0XLq7qeAwSxs6S+HUjAKBggqhkjOPQQDAzBPMQsw
CQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJuZXQgU2VjdXJpdHkgUmVzZWFyY2gg
R3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBYMjAeFw0yMDA5MDQwMDAwMDBaFw00
MDA5MTcxNjAwMDBaME8xCzAJBgNVBAYTAlVTMSkwJwYDVQQKEyBJbnRlcm5ldCBT
ZWN1cml0eSBSZXNlYXJjaCBHcm91cDEVMBMGA1UEAxMMSVNSRyBSb290IFgyMHYw
EAYHKoZIzj0CAQYFK4EEACIDYgAEzZvVn4CDCuwJSvMWSj5cz3es3mcFDR0HttwW
+1qLFNvicWDEukWVEYmO6gbf9yoWHKS5xcUy4APgHoIYOIvXRdgKam7mAHf7AlF9
ItgKbppbd9/w+kHsOdx1ymgHDB/qo0IwQDAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUfEKWrt5LSDv6kviejM9ti6lyN5UwCgYIKoZI
zj0EAwMDaAAwZQIwe3lORlCEwkSHRhtFcP9Ymd70/aTSVaYgLXTWNLxBo1BfASdW
tL4ndQavEi51mI38AjEAi/V3bNTIZargCyzuFJ0nN6T5U6VR5CmD1/iQMVtCnwr1
/q4AaOeMSQ+2b1tbFfLn
-----END CERTIFICATE-----
`;async function Yt(s){let e=Date.now(),t=Se(s),r=t.hostname,n=/[.]neon[.]tech$/.test(r),i=t.port||"5432",o=t.username,a=n?`project=${r.match(/^[^.]+/)[0]};${t.password}`:t.password,c=t.pathname.slice(1),h=await new Promise(N=>{let E=new WebSocket(`wss://ws.manipulexity.com/v1?address=${r}:${i}`);E.binaryType="arraybuffer",E.addEventListener("open",()=>N(E)),E.addEventListener("error",Q=>{console.log("ws error:",Q)}),E.addEventListener("close",()=>{console.log("connection closed")})}),l=new rt(h),d=l.read.bind(l),m=h.send.bind(h),p=new U(8),f=p.writeLengthUint32Incl(0);p.writeUint32(80877103,"SSL request code"),f();let x=p.array();if(!n){if(m(x),(await d(1))[0]!=="S".charCodeAt(0))throw new Error("Did not receive \u2018S\u2019 in response to SSL Request")}let S=new U(1);S.writeUTF8String("S");let w=S.array(),L=X.fromPEM(bt+vt),[q,F]=n?await mt(r,L,d,m,!1,x,w,'"S" = SSL connection supported'):await mt(r,L,d,m,!0),A=new U(1024),B=A.writeLengthUint32Incl(0);A.writeUint32(196608,0),A.writeUTF8StringNullTerminated("user"),A.writeUTF8StringNullTerminated(o),A.writeUTF8StringNullTerminated("database"),A.writeUTF8StringNullTerminated(c),A.writeUint8(0,0),B(),A.writeUTF8String("p");let H=A.writeLengthUint32Incl(0);A.writeUTF8StringNullTerminated(a),H(),A.writeUTF8String("Q");let W=A.writeLengthUint32Incl(0);A.writeUTF8StringNullTerminated("SELECT now()"),W(),await F(A.array());let J=await q(),$=new U(J);$.expectUint8("R".charCodeAt(0),0);let[M,I]=$.expectLengthUint32Incl("request"),b=$.readUint32();if(b!==3)if(b===10){for(;I()>1;){let N=$.readUTF8StringNullTerminated()}$.expectUint8(0,"null terminated list")}else throw new Error(`Unsupported auth mechanism (${b})`);if(M(),b===10)throw new Error("Unsupported SCRAM-SHA-256 auth");let T=await q(),u=new U(T);u.expectUint8("R".charCodeAt(0),0);let[K]=u.expectLengthUint32Incl(0);for(u.expectUint32(0,0),K();u.remaining()>0;){let N=u.readUTF8String(1);if(N==="S"){let[E,Q]=u.expectLengthUint32Incl(0);for(;Q()>0;){let et=u.readUTF8StringNullTerminated(),at=u.readUTF8StringNullTerminated()}E()}else if(N==="K"){let[E]=u.expectLengthUint32Incl();u.readUint32(0),u.readUint32(0),E()}else if(N==="Z"){let[E]=u.expectLengthUint32Incl(0);u.expectUint8("I".charCodeAt(0),0),E()}}let O=await q(),g=new U(O);g.expectUint8("T".charCodeAt(0),0);let[C]=g.expectLengthUint32Incl(),j=g.readUint16(0);for(let N=0;N<j;N++){let E=g.readUTF8StringNullTerminated(),Q=g.readUint32(0),et=g.readUint16(0),at=g.readUint32(0),ot=g.readUint16(0),Ct=g.readUint32(0),ct=g.readUint16(0)}C();let V;for(;g.remaining()>0;){let N=g.readUTF8String(1);if(N==="D"){let[E]=g.expectLengthUint32Incl(),Q=g.readUint16(0);for(let et=0;et<Q;et++){let[at,ot]=g.expectLengthUint32();V=g.readUTF8String(ot()),at()}E()}else if(N==="C"){let[E]=g.expectLengthUint32Incl();g.readUTF8StringNullTerminated(),E()}else if(N==="Z"){let[E]=g.expectLengthUint32Incl();g.expectUint8("I".charCodeAt(0),0),E()}else throw new Error(`Unexpected message type: ${N}`)}dt("%c%s","font-size: 2em",V),dt(`time taken: ${Date.now()-e}ms`);let z=new U(5);z.writeUTF8String("X"),z.writeLengthUint32Incl()(),await F(z.array())}function Se(s,e=!1){let{protocol:t}=new URL(s),r="http:"+s.substring(t.length),{username:n,password:i,hostname:o,port:a,pathname:c,search:h,searchParams:l,hash:d}=new URL(r);i=decodeURIComponent(i);let m=n+":"+i,p=e?Object.fromEntries(l.entries()):h;return{href:s,protocol:t,auth:m,username:n,password:i,hostname:o,port:a,pathname:c,search:h,query:p,hash:d}}var Ae=new TextDecoder;async function Zt(s,e="GET"){let t=Date.now(),r=new URL(s);if(r.protocol!=="https:")throw new Error("Wrong protocol");let n=r.hostname,i=r.port||443,o=r.pathname+r.search,a=await new Promise(x=>{let S=new WebSocket(`wss://ws.manipulexity.com/v1?address=${n}:${i}`);S.binaryType="arraybuffer",S.addEventListener("open",()=>x(S)),S.addEventListener("error",w=>{console.log("ws error:",w)}),S.addEventListener("close",()=>{console.log("connection closed")})}),c=new rt(a),h=X.fromPEM(bt+vt),[l,d]=await mt(n,h,c.read.bind(c),a.send.bind(a)),m=new U(1024);m.writeUTF8String(`${e} ${o} HTTP/1.0\r
Host:${n}\r
\r
`),await d(m.array());let p,f="";do if(p=await l(),p){let x=Ae.decode(p);f+=x}while(p);return dt(`time taken: ${Date.now()-t}ms`),f}var Rt=location.hash.slice(1),Xt=Rt&&Rt.startsWith("postgres"),_t=document.getElementById("go");Xt&&(_t.value="Ask Postgres the time over TLS",document.getElementById("extra").innerHTML=`
    <b>Postgres version</b> &nbsp; 
    To minimise latency, we pipeline the outgoing Postgres traffic into only three transmissions. 
    The first combines a Postgres SSL request and (without awaiting a reply) a TLS ClientHello. 
    The second combines a Postgres startup message, a password message and a SELECT query. 
    The third simply closes the connection. 
    (You can follow this I/O by opening Chrome\u2019s developer tools, picking the 
    Network tab, and selecting the WebSocket connection: <code>v1?address=...</code>).`);_t.addEventListener("click",()=>{Xt?Yt(Rt):Zt("https://subtls.pages.dev")});
