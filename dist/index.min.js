var _=class{constructor(e){this.ws=e;this.queue=[],e.addEventListener("message",t=>this.enqueue(new Uint8Array(t.data))),e.addEventListener("close",()=>this.dequeue())}queue;outstandingRequest;enqueue(e){this.queue.push(e),this.dequeue()}dequeue(){if(this.outstandingRequest===void 0)return;let{resolve:e,bytes:t}=this.outstandingRequest,r=this.bytesInQueue();if(r<t&&this.ws.readyState<=1)return;if(t=Math.min(t,r),t===0)return e(void 0);this.outstandingRequest=void 0;let n=this.queue[0],s=n.length;if(s===t)return this.queue.shift(),e(n);if(s>t)return this.queue[0]=n.subarray(t),e(n.subarray(0,t));{let c=new Uint8Array(t),o=t,a=0;for(;o>0;){let h=this.queue[0],y=h.length;y<=o?(this.queue.shift(),c.set(h,a),a+=y,o-=y):(this.queue[0]=h.subarray(o),c.set(h.subarray(0,o),a),o-=o,a+=o)}return e(c)}}bytesInQueue(){return this.queue.reduce((e,t)=>e+t.length,0)}async read(e){if(this.outstandingRequest!==void 0)throw new Error("Can\u2019t read while already awaiting read");return new Promise(t=>{this.outstandingRequest={resolve:t,bytes:e},this.dequeue()})}};function C(...i){if(i.length===1&&i[0]instanceof Uint8Array)return i[0];let e=i.reduce((n,s)=>n+s.length,0),t=new Uint8Array(e),r=0;for(let n of i)t.set(n,r),r+=n.length;return t}function P(i,e){let t=i.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}var st="\xB7\xB7 ";var Et=new TextEncoder,zt=new TextDecoder,x=class{offset;dataView;data;comments;indents;indent;constructor(e){this.offset=0,this.data=typeof e=="number"?new Uint8Array(e):e,this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength),this.comments={},this.indents={},this.indent=0}extend(e){let t=typeof e=="number"?new Uint8Array(e):e;this.data=C(this.data,t),this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}remaining(){return this.data.length-this.offset}subarray(e){return this.data.subarray(this.offset,this.offset+=e)}skip(e,t){return this.offset+=e,t&&this.comment(t),this}comment(e,t=this.offset){throw new Error("No comments should be emitted outside of chatty mode")}readBytes(e){return this.data.slice(this.offset,this.offset+=e)}readUTF8String(e){let t=this.subarray(e);return zt.decode(t)}readUTF8StringNullTerminated(){let e=this.offset;for(;this.data[e]!==0;)e++;let t=this.readUTF8String(e-this.offset);return this.expectUint8(0,"end of string"),t}readUint8(e){let t=this.dataView.getUint8(this.offset);return this.offset+=1,t}readUint16(e){let t=this.dataView.getUint16(this.offset);return this.offset+=2,t}readUint24(e){let t=this.readUint8(),r=this.readUint16();return(t<<16)+r}readUint32(e){let t=this.dataView.getUint32(this.offset);return this.offset+=4,t}expectBytes(e,t){let r=this.readBytes(e.length);if(!P(r,e))throw new Error("Unexpected bytes")}expectUint8(e,t){let r=this.readUint8();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint16(e,t){let r=this.readUint16();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint24(e,t){let r=this.readUint24();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectUint32(e,t){let r=this.readUint32();if(r!==e)throw new Error(`Expected ${e}, got ${r}`)}expectLength(e,t=1){let r=this.offset,n=r+e;if(n>this.data.length)throw new Error("Expected length exceeds remaining data length");return this.indent+=t,this.indents[r]=this.indent,[()=>{if(this.indent-=t,this.indents[this.offset]=this.indent,this.offset!==n)throw new Error(`${e} bytes expected but ${this.offset-r} read`)},()=>n-this.offset]}expectLengthUint8(e){let t=this.readUint8();return this.expectLength(t)}expectLengthUint16(e){let t=this.readUint16();return this.expectLength(t)}expectLengthUint24(e){let t=this.readUint24();return this.expectLength(t)}expectLengthUint32(e){let t=this.readUint32();return this.expectLength(t)}expectLengthUint8Incl(e){let t=this.readUint8();return this.expectLength(t-1)}expectLengthUint16Incl(e){let t=this.readUint16();return this.expectLength(t-2)}expectLengthUint24Incl(e){let t=this.readUint24();return this.expectLength(t-3)}expectLengthUint32Incl(e){let t=this.readUint32();return this.expectLength(t-4)}writeBytes(e){return this.data.set(e,this.offset),this.offset+=e.length,this}writeUTF8String(e){let t=Et.encode(e);return this.writeBytes(t),this}writeUTF8StringNullTerminated(e){let t=Et.encode(e);return this.writeBytes(t),this.writeUint8(0),this}writeUint8(e,t){return this.dataView.setUint8(this.offset,e),this.offset+=1,this}writeUint16(e,t){return this.dataView.setUint16(this.offset,e),this.offset+=2,this}writeUint32(e,t){return this.dataView.setUint32(this.offset,e),this.offset+=4,this}_writeLengthGeneric(e,t,r){let n=this.offset;this.offset+=e;let s=this.offset;return this.indent+=1,this.indents[s]=this.indent,()=>{let c=this.offset-(t?n:s);if(e===1)this.dataView.setUint8(n,c);else if(e===2)this.dataView.setUint16(n,c);else if(e===3)this.dataView.setUint8(n,(c&16711680)>>16),this.dataView.setUint16(n+1,c&65535);else if(e===4)this.dataView.setUint32(n,c);else throw new Error(`Invalid length for length field: ${e}`);this.indent-=1,this.indents[this.offset]=this.indent}}writeLengthUint8(e){return this._writeLengthGeneric(1,!1,e)}writeLengthUint16(e){return this._writeLengthGeneric(2,!1,e)}writeLengthUint24(e){return this._writeLengthGeneric(3,!1,e)}writeLengthUint32(e){return this._writeLengthGeneric(4,!1,e)}writeLengthUint8Incl(e){return this._writeLengthGeneric(1,!0,e)}writeLengthUint16Incl(e){return this._writeLengthGeneric(2,!0,e)}writeLengthUint24Incl(e){return this._writeLengthGeneric(3,!0,e)}writeLengthUint32Incl(e){return this._writeLengthGeneric(4,!0,e)}array(){return this.data.subarray(0,this.offset)}commentedString(e=!1){let t=this.indents[0]!==void 0?st.repeat(this.indents[0]):"",r=this.indents[0]??0,n=e?this.data.length:this.offset;for(let s=0;s<n;s++){t+=this.data[s].toString(16).padStart(2,"0")+" ";let c=this.comments[s+1];this.indents[s+1]!==void 0&&(r=this.indents[s+1]),c&&(t+=` ${c}
${st.repeat(r)}`)}return t}};var Se=new RegExp(`  .+|^(${st})+`,"gm");var Gt=document.querySelector("#logs"),It={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},Wt=new RegExp("["+Object.keys(It).join("")+"]","g");function Zt(i){return i.replace(Wt,e=>It[e])}function Yt(...i){let e="<span>",t,r,n="";for(;(t=i.shift())!==void 0;){t=n+Zt(String(t)),n=" ";let s=/([\s\S]*?)%([csoOidf])|[\s\S]+/g;for(;(r=s.exec(t))!==null;){let[c,o,a]=r;a===void 0?e+=c:(e+=o,a==="c"?e+=`</span><span style="${i.shift()}">`:a==="s"?e+=i.shift():a==="o"||a==="O"?e+=JSON.stringify(i.shift(),void 0,a==="O"?2:void 0):(a==="i"||a==="d"||a==="f")&&(e+=String(i.shift())))}}return e+="</span>",e}var Xt=0;function at(...i){console.log(...i),Gt.innerHTML+=`<label><input type="checkbox" name="c${Xt++}"><div class="section">`+Yt(...i)+"</div></label>"}function xt(i,e,t,r=!0){let n=new x(1024);n.writeUint8(22,0),n.writeUint16(769,0);let s=n.writeLengthUint16();n.writeUint8(1,0);let c=n.writeLengthUint24();n.writeUint16(771,0),crypto.getRandomValues(n.subarray(32));let o=n.writeLengthUint8(0);n.writeBytes(t),o();let a=n.writeLengthUint16(0);n.writeUint16(4865,0),a();let h=n.writeLengthUint8(0);n.writeUint8(0,0),h();let y=n.writeLengthUint16(0);if(r){n.writeUint16(0,0);let H=n.writeLengthUint16(0),B=n.writeLengthUint16(0);n.writeUint8(0,0);let V=n.writeLengthUint16(0);n.writeUTF8String(i),V(),B(),H()}n.writeUint16(11,0);let d=n.writeLengthUint16(0),l=n.writeLengthUint8(0);n.writeUint8(0,0),l(),d(),n.writeUint16(10,0);let g=n.writeLengthUint16(0),p=n.writeLengthUint16(0);n.writeUint16(23,0),p(),g(),n.writeUint16(13,0);let U=n.writeLengthUint16(0),S=n.writeLengthUint16(0);n.writeUint16(1027,0),n.writeUint16(2052,0),S(),U(),n.writeUint16(43,0);let f=n.writeLengthUint16(0),b=n.writeLengthUint8(0);n.writeUint16(772,0),b(),f(),n.writeUint16(51,0);let K=n.writeLengthUint16(0),w=n.writeLengthUint16(0);n.writeUint16(23,0);let O=n.writeLengthUint16(0);return n.writeBytes(new Uint8Array(e)),O(),w(),K(),y(),c(),s(),n}function $(i,e=""){return[...i].map(t=>t.toString(16).padStart(2,"0")).join(e)}function Ut(i,e){let t,r,[n]=i.expectLength(i.remaining());i.expectUint8(2,0);let[s]=i.expectLengthUint24(0);i.expectUint16(771,0);let c=i.readBytes(32);if(P(c,[207,33,173,116,229,154,97,17,190,29,140,2,30,101,184,145,194,162,17,22,122,187,140,94,7,158,9,226,200,168,51,156]))throw new Error("Unexpected HelloRetryRequest");i.expectUint8(e.length,0),i.expectBytes(e,0),i.expectUint16(4865,0),i.expectUint8(0,0);let[o,a]=i.expectLengthUint16(0);for(;a()>0;){let h=i.readUint16(0),[y]=i.expectLengthUint16(0);if(h===43)i.expectUint16(772,0),r=!0;else if(h===51)i.expectUint16(23,0),i.expectUint16(65),t=i.readBytes(65);else throw new Error(`Unexpected extension 0x${$([h])}`);y()}if(o(),s(),n(),r!==!0)throw new Error("No TLS version provided");if(t===void 0)throw new Error("No key provided");return t}var ot=1<<14,_t=ot+1+255;async function dt(i,e,t=ot){let n=await i(5);if(n===void 0)return;if(n.length<5)throw new Error("TLS record header truncated");let s=new x(n),c=s.readUint8();if(c<20||c>24)throw new Error(`Illegal TLS record type 0x${c.toString(16)}`);if(e!==void 0&&c!==e)throw new Error(`Unexpected TLS record type 0x${c.toString(16).padStart(2,"0")} (expected 0x${e.toString(16).padStart(2,"0")})`);let o=s.readUint16(0);if([769,770,771].indexOf(o)<0)throw new Error(`Unsupported TLS record version 0x${o.toString(16).padStart(4,"0")}`);let a=s.readUint16(0);if(a>t)throw new Error(`Record too long: ${a} bytes`);let h=await i(a);if(h===void 0||h.length<a)throw new Error("TLS record content truncated");return{headerData:n,header:s,type:c,version:o,length:a,content:h}}async function yt(i,e,t){let r=await dt(i,23,_t);if(r===void 0)return;let n=new x(r.content),[s]=n.expectLength(n.remaining());n.skip(r.length-16,0),n.skip(16,0),s();let c=await e.process(r.content,16,r.headerData),o=c.length-1;for(;c[o]===0;)o-=1;if(o<0)throw new Error("Decrypted message has no record type indicator (all zeroes)");let a=c[o],h=c.subarray(0,o);if(!(a===21&&h.length===2&&h[0]===1&&h[1]===0)){if(a===22&&h[0]===4)return yt(i,e,t);if(t!==void 0&&a!==t)throw new Error(`Unexpected TLS record type 0x${a.toString(16).padStart(2,"0")} (expected 0x${t.toString(16).padStart(2,"0")})`);return h}}async function te(i,e,t){let r=C(i,[t]),n=5,o=r.length+16,a=new x(n+o);a.writeUint8(23,0),a.writeUint16(771,0),a.writeUint16(o,`${o} bytes follow`);let[h]=a.expectLength(o),y=a.array(),d=await e.process(r,16,y);return a.writeBytes(d.subarray(0,d.length-16)),a.writeBytes(d.subarray(d.length-16)),h(),a.array()}async function St(i,e,t){let r=Math.ceil(i.length/ot),n=[];for(let s=0;s<r;s++){let c=i.subarray(s*ot,(s+1)*ot),o=await te(c,e,t);n.push(o)}return n}var Dt=new TextEncoder;async function At(i,e,t){let r=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:{name:`SHA-${t}`}},!1,["sign"]);var n=new Uint8Array(await crypto.subtle.sign("HMAC",r,e));return n}async function ee(i,e,t,r){let n=r>>3,s=Math.ceil(t/n),c=new Uint8Array(s*n),o=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:{name:`SHA-${r}`}},!1,["sign"]),a=new Uint8Array(0);for(let h=0;h<s;h++){let y=C(a,e,[h+1]),d=await crypto.subtle.sign("HMAC",o,y),l=new Uint8Array(d);c.set(l,n*h),a=l}return c.subarray(0,t)}var Tt=Dt.encode("tls13 ");async function I(i,e,t,r,n){let s=Dt.encode(e),c=C([(r&65280)>>8,r&255],[Tt.length+s.length],Tt,s,[t.length],t);return ee(i,c,r,n)}async function Nt(i,e,t,r,n){let s=r>>3,c=new Uint8Array(s),o=await crypto.subtle.importKey("raw",i,{name:"ECDH",namedCurve:"P-256"},!1,[]),a=await crypto.subtle.deriveBits({name:"ECDH",public:o},e,256),h=new Uint8Array(a),y=await crypto.subtle.digest("SHA-256",t),d=new Uint8Array(y),l=await At(new Uint8Array(1),c,r),g=await crypto.subtle.digest(`SHA-${r}`,new Uint8Array(0)),p=new Uint8Array(g),U=await I(l,"derived",p,s,r),S=await At(U,h,r),f=await I(S,"c hs traffic",d,s,r),b=await I(S,"s hs traffic",d,s,r),K=await I(f,"key",new Uint8Array(0),n,r),w=await I(b,"key",new Uint8Array(0),n,r),O=await I(f,"iv",new Uint8Array(0),12,r),H=await I(b,"iv",new Uint8Array(0),12,r);return{serverHandshakeKey:w,serverHandshakeIV:H,clientHandshakeKey:K,clientHandshakeIV:O,handshakeSecret:S,clientSecret:f,serverSecret:b}}async function kt(i,e,t,r){let n=t>>3,s=new Uint8Array(n),c=await crypto.subtle.digest(`SHA-${t}`,new Uint8Array(0)),o=new Uint8Array(c),a=await I(i,"derived",o,n,t),h=await At(a,s,t),y=await I(h,"c ap traffic",e,n,t),d=await I(h,"s ap traffic",e,n,t),l=await I(y,"key",new Uint8Array(0),r,t),g=await I(d,"key",new Uint8Array(0),r,t),p=await I(y,"iv",new Uint8Array(0),12,t),U=await I(d,"iv",new Uint8Array(0),12,t);return{serverApplicationKey:g,serverApplicationIV:U,clientApplicationKey:l,clientApplicationIV:p}}var Z=class{mode;key;initialIv;ivLength;currentIv;currentIvDataView;initialIvLast32;recordsDecrypted=0;constructor(e,t,r){this.mode=e,this.key=t,this.initialIv=r,this.ivLength=r.length,this.currentIv=r.slice(),this.currentIvDataView=new DataView(this.currentIv.buffer,this.currentIv.byteOffset,this.currentIv.byteLength),this.initialIvLast32=this.currentIvDataView.getUint32(this.ivLength-4)}async process(e,t,r){if(this.recordsDecrypted===1073741824)throw new Error("Cannot encrypt/decrypt any more records");let n=this.initialIvLast32^this.recordsDecrypted;this.currentIvDataView.setUint32(this.ivLength-4,n),this.recordsDecrypted+=1;let s=t<<3,c={name:"AES-GCM",iv:this.currentIv,tagLength:s,additionalData:r},o=await crypto.subtle[this.mode](c,this.key,e);return new Uint8Array(o)}};function lt(i){return i>64&&i<91?i-65:i>96&&i<123?i-71:i>47&&i<58?i+4:i===43?62:i===47?63:i===61?64:void 0}function Bt(i){let e=i.length,t=0,r=0,n=64,s=64,c=64,o=64,a=new Uint8Array(e*.75);for(;t<e;)n=lt(i.charCodeAt(t++)),s=lt(i.charCodeAt(t++)),c=lt(i.charCodeAt(t++)),o=lt(i.charCodeAt(t++)),a[r++]=n<<2|s>>4,a[r++]=(s&15)<<4|c>>2,a[r++]=(c&3)<<6|o;let h=s===64?0:c===64?2:o===64?1:0;return a.subarray(0,r-h)}var J=class extends x{readASN1Length(e){let t=this.readUint8();if(t<128)return t;let r=t&127,n=0;if(r===1)return this.readUint8(n);if(r===2)return this.readUint16(n);if(r===3)return this.readUint24(n);if(r===4)return this.readUint32(n);throw new Error(`ASN.1 length fields are only supported up to 4 bytes (this one is ${r} bytes)`)}expectASN1Length(e){let t=this.readASN1Length(e);return this.expectLength(t)}readASN1OID(){let[e,t]=this.expectASN1Length(0),r=this.readUint8(),n=`${Math.floor(r/40)}.${r%40}`;for(;t()>0;){let s=0;for(;;){let c=this.readUint8();if(s<<=7,s+=c&127,c<128)break}n+=`.${s}`}return e(),n}readASN1Boolean(){let[e,t]=this.expectASN1Length(0),r=t();if(r!==1)throw new Error(`Boolean has weird length: ${r}`);let n=this.readUint8(),s;if(n===255)s=!0;else if(n===0)s=!1;else throw new Error(`Boolean has weird value: 0x${$([n])}`);return e(),s}readASN1UTCTime(){let[e,t]=this.expectASN1Length(0),n=this.readUTF8String(t()).match(/^(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z$/);if(!n)throw new Error("Unrecognised UTC time format in certificate validity");let[,s,c,o,a,h,y]=n,d=parseInt(s,10),l=d+(d>=50?1900:2e3),g=new Date(`${l}-${c}-${o}T${a}:${h}:${y}Z`);return e(),g}readASN1BitString(){let[e,t]=this.expectASN1Length(0),r=this.readUint8(0),n=t(),s=this.readBytes(n);if(r>7)throw new Error(`Invalid right pad value: ${r}`);if(r>0){let c=8-r;for(let o=n-1;o>0;o--)s[o]=255&s[o-1]<<c|s[o]>>>r;s[0]=s[0]>>>r}return e(),s}};var mt=1,tt=2,T=48,ne=49,Y=6,re=19,ie=12,bt=23,gt=5,G=4,ut=3,Rt=163,et=128;var se={"2.5.4.6":"C","2.5.4.10":"O","2.5.4.11":"OU","2.5.4.3":"CN","2.5.4.7":"L","2.5.4.8":"ST","2.5.4.12":"T","2.5.4.42":"GN","2.5.4.43":"I","2.5.4.4":"SN","1.2.840.113549.1.9.1":"E-mail"};function Ht(i){let{length:e}=i;if(e>4)throw new Error(`Bit string length ${e} would overflow JS bit operators`);let t=0,r=0;for(let n=i.length-1;n>=0;n--)t|=i[n]<<r,r+=8;return t}function vt(i,e){let t={};i.expectUint8(T,0);let[r,n]=i.expectASN1Length(0);for(;n()>0;){i.expectUint8(ne,0);let[s]=i.expectASN1Length(0);i.expectUint8(T,0);let[c]=i.expectASN1Length(0);i.expectUint8(Y,0);let o=i.readASN1OID(),a=se[o]??o,h=i.readUint8();if(h!==re){if(h!==ie)throw new Error(`Unexpected item type in certificate ${e}: 0x${$([h])}`)}let[y,d]=i.expectASN1Length(0),l=i.readUTF8String(d());if(y(),c(),s(),t[a]!==void 0)throw new Error(`Duplicate OID ${a} in certificate ${e}`);t[a]=l}return r(),t}function Kt(i,e=0){let t=[],[r,n]=i.expectASN1Length(0);for(;n()>0;){let s=i.readUint8(0),[c,o]=i.expectASN1Length(0),a;s===(e|2)?a=i.readUTF8String(o()):a=i.readBytes(o()),t.push({name:a,type:s}),c()}return r(),t}function qt(i){let e={"1.2.840.113549.1.1.1":{name:"RSAES-PKCS1-v1_5"},"1.2.840.113549.1.1.5":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}},"1.2.840.113549.1.1.11":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},"1.2.840.113549.1.1.12":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},"1.2.840.113549.1.1.13":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}},"1.2.840.113549.1.1.10":{name:"RSA-PSS"},"1.2.840.113549.1.1.7":{name:"RSA-OAEP"},"1.2.840.10045.2.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.3.2":{name:"ECDSA",hash:{name:"SHA-256"}},"1.2.840.10045.4.3.3":{name:"ECDSA",hash:{name:"SHA-384"}},"1.2.840.10045.4.3.4":{name:"ECDSA",hash:{name:"SHA-512"}},"1.3.133.16.840.63.0.2":{name:"ECDH",kdf:"SHA-1"},"1.3.132.1.11.1":{name:"ECDH",kdf:"SHA-256"},"1.3.132.1.11.2":{name:"ECDH",kdf:"SHA-384"},"1.3.132.1.11.3":{name:"ECDH",kdf:"SHA-512"},"2.16.840.1.101.3.4.1.2":{name:"AES-CBC",length:128},"2.16.840.1.101.3.4.1.22":{name:"AES-CBC",length:192},"2.16.840.1.101.3.4.1.42":{name:"AES-CBC",length:256},"2.16.840.1.101.3.4.1.6":{name:"AES-GCM",length:128},"2.16.840.1.101.3.4.1.26":{name:"AES-GCM",length:192},"2.16.840.1.101.3.4.1.46":{name:"AES-GCM",length:256},"2.16.840.1.101.3.4.1.4":{name:"AES-CFB",length:128},"2.16.840.1.101.3.4.1.24":{name:"AES-CFB",length:192},"2.16.840.1.101.3.4.1.44":{name:"AES-CFB",length:256},"2.16.840.1.101.3.4.1.5":{name:"AES-KW",length:128},"2.16.840.1.101.3.4.1.25":{name:"AES-KW",length:192},"2.16.840.1.101.3.4.1.45":{name:"AES-KW",length:256},"1.2.840.113549.2.7":{name:"HMAC",hash:{name:"SHA-1"}},"1.2.840.113549.2.9":{name:"HMAC",hash:{name:"SHA-256"}},"1.2.840.113549.2.10":{name:"HMAC",hash:{name:"SHA-384"}},"1.2.840.113549.2.11":{name:"HMAC",hash:{name:"SHA-512"}},"1.2.840.113549.1.9.16.3.5":{name:"DH"},"1.3.14.3.2.26":{name:"SHA-1"},"2.16.840.1.101.3.4.2.1":{name:"SHA-256"},"2.16.840.1.101.3.4.2.2":{name:"SHA-384"},"2.16.840.1.101.3.4.2.3":{name:"SHA-512"},"1.2.840.113549.1.5.12":{name:"PBKDF2"},"1.2.840.10045.3.1.7":{name:"P-256"},"1.3.132.0.34":{name:"P-384"},"1.3.132.0.35":{name:"P-521"}}[i];if(e===void 0)throw new Error(`Unsupported algorithm identifier: ${i}`);return e}function Ft(i,e=[]){return Object.values(i).forEach(t=>{typeof t=="string"?e=[...e,t]:e=Ft(t,e)}),e}function $t(i){return Ft(i).join(" / ")}var ae=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],ct=class{serialNumber;algorithm;issuer;validityPeriod;subject;publicKey;signature;keyUsage;subjectAltNames;extKeyUsage;authorityKeyIdentifier;subjectKeyIdentifier;basicConstraints;signedData;constructor(e){let t=e instanceof J?e:new J(e);t.expectUint8(T,0);let[r]=t.expectASN1Length(0),n=t.offset;t.expectUint8(T,0);let[s]=t.expectASN1Length(0);t.expectBytes([160,3,2,1,2],0),t.expectUint8(tt,0);let[c,o]=t.expectASN1Length(0);this.serialNumber=t.subarray(o()),c(),t.expectUint8(T,0);let[a,h]=t.expectASN1Length(0);t.expectUint8(Y,0),this.algorithm=t.readASN1OID(),h()>0&&(t.expectUint8(gt,0),t.expectUint8(0,0)),a(),this.issuer=vt(t,"issuer"),t.expectUint8(T,0);let[y]=t.expectASN1Length(0);t.expectUint8(bt,0);let d=t.readASN1UTCTime();t.expectUint8(bt,0);let l=t.readASN1UTCTime();this.validityPeriod={notBefore:d,notAfter:l},y(),this.subject=vt(t,"subject");let g=t.offset;t.expectUint8(T,0);let[p]=t.expectASN1Length(0);t.expectUint8(T,0);let[U,S]=t.expectASN1Length(0),f=[];for(;S()>0;){let q=t.readUint8();if(q===Y){let j=t.readASN1OID();f.push(j)}else q===gt&&t.expectUint8(0,0)}U(),t.expectUint8(ut,0);let b=t.readASN1BitString();this.publicKey={identifiers:f,data:b,all:t.data.subarray(g,t.offset)},p(),t.expectUint8(Rt,0);let[K]=t.expectASN1Length();t.expectUint8(T,0);let[w,O]=t.expectASN1Length(0);for(;O()>0;){t.expectUint8(T,0);let[q,j]=t.expectASN1Length();t.expectUint8(Y,0);let F=t.readASN1OID();if(F==="2.5.29.17"){t.expectUint8(G,0);let[u]=t.expectASN1Length(0);t.expectUint8(T,0);let E=Kt(t,et);this.subjectAltNames=E.filter(A=>A.type===(2|et)).map(A=>A.name),u()}else if(F==="2.5.29.15"){t.expectUint8(mt,0);let u=t.readASN1Boolean();t.expectUint8(G,0);let[E]=t.expectASN1Length(0);t.expectUint8(ut,0);let A=t.readASN1BitString(),m=Ht(A),R=new Set(ae.filter((v,N)=>m&1<<N));E(),this.keyUsage={critical:u,usages:R}}else if(F==="2.5.29.37"){this.extKeyUsage={},t.expectUint8(G,0);let[u]=t.expectASN1Length(0);t.expectUint8(T,0);let[E,A]=t.expectASN1Length(0);for(;A()>0;){t.expectUint8(Y,0);let m=t.readASN1OID();m==="1.3.6.1.5.5.7.3.1"&&(this.extKeyUsage.serverTls=!0),m==="1.3.6.1.5.5.7.3.2"&&(this.extKeyUsage.clientTls=!0)}E(),u()}else if(F==="2.5.29.35"){t.expectUint8(G,0);let[u]=t.expectASN1Length(0);t.expectUint8(T,0);let[E,A]=t.expectASN1Length(0);for(;A()>0;){let m=t.readUint8();if(m===(et|0)){let[R,v]=t.expectASN1Length(0);this.authorityKeyIdentifier=t.readBytes(v()),R()}else if(m===(et|1)||m===(et|2)){let[R,v]=t.expectASN1Length(0);t.skip(v(),0),R()}else throw new Error("Unexpected data type in authorityKeyIdentifier certificate extension")}E(),u()}else if(F==="2.5.29.14"){t.expectUint8(G,0);let[u]=t.expectASN1Length(0);t.expectUint8(G,0);let[E,A]=t.expectASN1Length(0);this.subjectKeyIdentifier=t.readBytes(A()),E(),u()}else if(F==="2.5.29.19"){let u,E=t.readUint8();if(E===mt&&(u=t.readASN1Boolean(),E=t.readUint8()),E!==G)throw new Error("Unexpected type in certificate basic constraints");let[A]=t.expectASN1Length(0);t.expectUint8(T,0);let[m,R]=t.expectASN1Length(),v;R()>0&&(t.expectUint8(mt,0),v=t.readASN1Boolean());let N;if(R()>0){t.expectUint8(tt,0);let k=t.readASN1Length(0);if(N=k===1?t.readUint8():k===2?t.readUint16():k===3?t.readUint24():void 0,N===void 0)throw new Error("Too many bytes in max path length in certificate basicConstraints")}m(),A(),this.basicConstraints={critical:u,ca:v,pathLength:N}}else t.skip(j(),0);q()}w(),K(),s(),this.signedData=t.data.subarray(n,t.offset),t.expectUint8(T,0);let[H,B]=t.expectASN1Length(0);t.expectUint8(Y,0);let V=t.readASN1OID();if(B()>0&&(t.expectUint8(gt,0),t.expectUint8(0,0)),H(),V!==this.algorithm)throw new Error(`Certificate specifies different signature algorithms inside (${this.algorithm}) and out (${V})`);t.expectUint8(ut,0),this.signature=t.readASN1BitString(),r()}static fromPEM(e){let t="[A-Z0-9 ]+",r=new RegExp(`-{5}BEGIN ${t}-{5}([a-zA-Z0-9=+\\/\\n\\r]+)-{5}END ${t}-{5}`,"g"),n=[],s=null;for(;s=r.exec(e);){let c=s[1].replace(/[\r\n]/g,""),o=Bt(c),a=new this(o);n.push(a)}return n}subjectAltNameMatchingHost(e){let t=/[.][^.]+[.][^.]+$/;return(this.subjectAltNames??[]).find(r=>{let n=r,s=e;if(t.test(e)&&t.test(n)&&n.startsWith("*.")&&(n=n.slice(1),s=s.slice(s.indexOf("."))),n===s)return!0})}isValidAtMoment(e=new Date){return e>=this.validityPeriod.notBefore&&e<=this.validityPeriod.notAfter}description(){return"subject: "+Object.entries(this.subject).map(e=>e.join("=")).join(", ")+(this.subjectAltNames?`
subject alt names: `+this.subjectAltNames.join(", "):"")+(this.subjectKeyIdentifier?`
subject key id: ${$(this.subjectKeyIdentifier," ")}`:"")+`
issuer: `+Object.entries(this.issuer).map(e=>e.join("=")).join(", ")+(this.authorityKeyIdentifier?`
authority key id: ${$(this.authorityKeyIdentifier," ")}`:"")+`
validity: `+this.validityPeriod.notBefore.toISOString()+" \u2013 "+this.validityPeriod.notAfter.toISOString()+` (${this.isValidAtMoment()?"currently valid":"not valid"})`+(this.keyUsage?`
key usage (${this.keyUsage.critical?"critical":"non-critical"}): `+[...this.keyUsage.usages].join(", "):"")+(this.extKeyUsage?`
extended key usage: TLS server \u2014\xA0${this.extKeyUsage.serverTls}, TLS client \u2014\xA0${this.extKeyUsage.clientTls}`:"")+(this.basicConstraints?`
basic constraints (${this.basicConstraints.critical?"critical":"non-critical"}): CA \u2014\xA0${this.basicConstraints.ca}, path length \u2014 ${this.basicConstraints.pathLength}`:"")+`
signature algorithm: `+$t(qt(this.algorithm))}toJSON(){return{serialNumber:[...this.serialNumber],algorithm:this.algorithm,issuer:this.issuer,validityPeriod:{notBefore:this.validityPeriod.notBefore.toISOString(),notAfter:this.validityPeriod.notAfter.toISOString()},subject:this.subject,publicKey:{identifiers:this.publicKey.identifiers,data:[...this.publicKey.data],all:[...this.publicKey.all]},signature:[...this.signature],keyUsage:{critical:this.keyUsage?.critical,usages:[...this.keyUsage?.usages??[]]},subjectAltNames:this.subjectAltNames,extKeyUsage:this.extKeyUsage,authorityKeyIdentifier:this.authorityKeyIdentifier&&[...this.authorityKeyIdentifier],subjectKeyIdentifier:this.subjectKeyIdentifier&&[...this.subjectKeyIdentifier],basicConstraints:this.basicConstraints,signedData:[...this.signedData]}}},W=class extends ct{};async function pt(i,e,t,r,n){i.expectUint8(T,0);let[s]=i.expectASN1Length(0);i.expectUint8(tt,0);let[c,o]=i.expectASN1Length(0),a=i.readBytes(o());c(),i.expectUint8(tt,0);let[h,y]=i.expectASN1Length(0),d=i.readBytes(y());h(),s();let l=(f,b)=>f.length>b?f.subarray(f.length-b):f.length<b?C(new Uint8Array(b-f.length),f):f,g=r==="P-256"?32:48,p=C(l(a,g),l(d,g)),U=await crypto.subtle.importKey("spki",e,{name:"ECDSA",namedCurve:r},!1,["verify"]);if(await crypto.subtle.verify({name:"ECDSA",hash:n},U,p,t)!==!0)throw new Error("ECDSA-SECP256R1-SHA256 certificate verify failed")}async function Ot(i,e,t){for(let o of e);let r=e[0];if(r.subjectAltNameMatchingHost(i)===void 0)throw new Error(`No matching subjectAltName for ${i}`);if(!r.isValidAtMoment())throw new Error("End-user certificate is not valid now");if(!r.extKeyUsage?.serverTls)throw new Error("End-user certificate has no TLS server extKeyUsage");let c=!1;for(let o of t);for(let o=0,a=e.length;o<a;o++){let h=e[o],y=h.authorityKeyIdentifier;if(y===void 0)throw new Error("Certificates without an authorityKeyIdentifier are not supported");let d=t.find(p=>p.subjectKeyIdentifier!==void 0&&P(p.subjectKeyIdentifier,y));if(d===void 0&&(d=e[o+1]),d===void 0)throw new Error("Ran out of certificates before reaching trusted root");let l=d instanceof W;if(d.isValidAtMoment()!==!0)throw new Error("Signing certificate is not valid now");if(d.keyUsage?.usages.has("digitalSignature")!==!0)throw new Error("Signing certificate keyUsage does not include digital signatures");if(d.basicConstraints?.ca!==!0)throw new Error("Signing certificate basicConstraints do not indicate a CA certificate");let{pathLength:g}=d.basicConstraints;if(g!==void 0&&g<o)throw new Error("Exceeded certificate path length");if(h.algorithm==="1.2.840.10045.4.3.2"||h.algorithm==="1.2.840.10045.4.3.3"){let p=h.algorithm==="1.2.840.10045.4.3.2"?"SHA-256":"SHA-384",U=d.publicKey.identifiers,S=U.includes("1.2.840.10045.3.1.7")?"P-256":U.includes("1.3.132.0.34")?"P-384":void 0;if(S===void 0)throw new Error("Unsupported signing key curve");let f=new J(h.signature);await pt(f,d.publicKey.all,h.signedData,S,p)}else if(h.algorithm==="1.2.840.113549.1.1.11"||h.algorithm==="1.2.840.113549.1.1.12"){let p=h.algorithm==="1.2.840.113549.1.1.11"?"SHA-256":"SHA-384",U=await crypto.subtle.importKey("spki",d.publicKey.all,{name:"RSASSA-PKCS1-v1_5",hash:p},!1,["verify"]);if(await crypto.subtle.verify({name:"RSASSA-PKCS1-v1_5"},U,h.signature,h.signedData)!==!0)throw new Error("RSASSA_PKCS1-v1_5-SHA256 certificate verify failed")}else throw new Error("Unsupported signing algorithm");if(l){c=!0;break}}return c}var oe=new TextEncoder;async function Vt(i,e,t,r,n){let s=new J(await e());s.expectUint8(8,0);let[c]=s.expectLengthUint24(),[o,a]=s.expectLengthUint16(0);for(;a()>0;){let v=s.readUint16(0);if(v===0)s.expectUint16(0,0);else if(v===10){let[N,k]=s.expectLengthUint16("groups data");s.skip(k(),"ignored"),N()}else throw new Error(`Unsupported server encrypted extension type 0x${$([v]).padStart(4,"0")}`)}o(),c(),s.remaining()===0&&s.extend(await e()),s.expectUint8(11,0);let[h]=s.expectLengthUint24(0);s.expectUint8(0,0);let[y,d]=s.expectLengthUint24(0),l=[];for(;d()>0;){let[v]=s.expectLengthUint24(0),N=new ct(s);l.push(N),v();let[k,X]=s.expectLengthUint16(),D=s.subarray(X());k()}if(y(),h(),l.length===0)throw new Error("No certificates supplied");let g=l[0],p=s.data.subarray(0,s.offset),U=C(r,p),S=await crypto.subtle.digest("SHA-256",U),f=new Uint8Array(S),b=C(oe.encode(" ".repeat(64)+"TLS 1.3, server CertificateVerify"),[0],f);s.remaining()===0&&s.extend(await e()),s.expectUint8(15,0);let[K]=s.expectLengthUint24(0),w=s.readUint16();if(w===1027){let[v]=s.expectLengthUint16();await pt(s,g.publicKey.all,b,"P-256","SHA-256"),v()}else if(w===2052){let[v,N]=s.expectLengthUint16(),k=s.subarray(N());v();let X=await crypto.subtle.importKey("spki",g.publicKey.all,{name:"RSA-PSS",hash:"SHA-256"},!1,["verify"]);if(await crypto.subtle.verify({name:"RSA-PSS",saltLength:32},X,k,b)!==!0)throw new Error("RSA-PSS-RSAE-SHA256 certificate verify failed")}else throw new Error(`Unsupported certificate verify signature type 0x${$([w]).padStart(4,"0")}`);K();let O=s.data.subarray(0,s.offset),H=C(r,O),B=await I(t,"finished",new Uint8Array(0),32,256),V=await crypto.subtle.digest("SHA-256",H),q=await crypto.subtle.importKey("raw",B,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),j=await crypto.subtle.sign("HMAC",q,V),F=new Uint8Array(j);s.remaining()===0&&s.extend(await e()),s.expectUint8(20,0);let[u,E]=s.expectLengthUint24(0),A=s.readBytes(E());if(u(),s.remaining()!==0)throw new Error("Unexpected extra bytes in server handshake");if(P(A,F)!==!0)throw new Error("Invalid server verify hash");if(!await Ot(i,l,n))throw new Error("Validated certificate chain did not end in a trusted root");return s.data}async function ft(i,e,t,r,n=!0,s,c,o){let a=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),h=await crypto.subtle.exportKey("raw",a.publicKey),y=new Uint8Array(32);crypto.getRandomValues(y);let l=xt(i,h,y,n).array(),g=s?C(s,l):l;if(r(g),c){let Q=await t(c.length);if(!Q||!P(Q,c))throw new Error("Pre data did not match expectation")}let p=await dt(t,22);if(p===void 0)throw new Error("Connection closed while awaiting server hello");let U=new x(p.content),S=Ut(U,y),f=await dt(t,20);if(f===void 0)throw new Error("Connection closed awaiting server cipher change");let b=new x(f.content),[K]=b.expectLength(1);b.expectUint8(1,0),K();let w=l.subarray(5),O=p.content,H=C(w,O),B=await Nt(S,a.privateKey,H,256,16),V=await crypto.subtle.importKey("raw",B.serverHandshakeKey,{name:"AES-GCM"},!1,["decrypt"]),q=new Z("decrypt",V,B.serverHandshakeIV),j=await crypto.subtle.importKey("raw",B.clientHandshakeKey,{name:"AES-GCM"},!1,["encrypt"]),F=new Z("encrypt",j,B.clientHandshakeIV),E=await Vt(i,async()=>{let Q=await yt(t,q,22);if(Q===void 0)throw new Error("Premature end of encrypted server handshake");return Q},B.serverSecret,H,e),A=new x(6);A.writeUint8(20,0),A.writeUint16(771,0);let m=A.writeLengthUint16();A.writeUint8(1,0),m();let R=A.array(),v=C(H,E),N=await crypto.subtle.digest("SHA-256",v),k=new Uint8Array(N),X=await I(B.clientSecret,"finished",new Uint8Array(0),32,256),D=await crypto.subtle.importKey("raw",X,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),L=await crypto.subtle.sign("HMAC",D,k),z=new Uint8Array(L),M=new x(36);M.writeUint8(20,0);let nt=M.writeLengthUint24(0);M.writeBytes(z),nt();let rt=await St(M.array(),F,22),it=await kt(B.handshakeSecret,k,256,16),Ct=await crypto.subtle.importKey("raw",it.clientApplicationKey,{name:"AES-GCM"},!1,["encrypt"]),jt=new Z("encrypt",Ct,it.clientApplicationIV),Mt=await crypto.subtle.importKey("raw",it.serverApplicationKey,{name:"AES-GCM"},!1,["decrypt"]),Qt=new Z("decrypt",Mt,it.serverApplicationIV),ht=!1;return[()=>{if(!ht){let Q=C(R,...rt);r(Q),ht=!0}return yt(t,Qt)},async Q=>{let Lt=await St(Q,jt,23),Jt=ht?C(...Lt):C(R,...rt,...Lt);r(Jt),ht=!0}]}var wt=`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
TzELMAkGA1UEBhMCVVMxKTAnBgNVBAoTIEludGVybmV0IFNlY3VyaXR5IFJlc2Vh
cmNoIEdyb3VwMRUwEwYDVQQDEwxJU1JHIFJvb3QgWDEwHhcNMTUwNjA0MTEwNDM4
WhcNMzUwNjA0MTEwNDM4WjBPMQswCQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJu
ZXQgU2VjdXJpdHkgUmVzZWFyY2ggR3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBY
MTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAK3oJHP0FDfzm54rVygc
h77ct984kIxuPOZXoHj3dcKi/vVqbvYATyjb3miGbESTtrFj/RQSa78f0uoxmyF+
0TM8ukj13Xnfs7j/EvEhmkvBioZxaUpmZmyPfjxwv60pIgbz5MDmgK7iS4+3mX6U
A5/TR5d8mUgjU+g4rk8Kb4Mu0UlXjIB0ttov0DiNewNwIRt18jA8+o+u3dpjq+sW
T8KOEUt+zwvo/7V3LvSye0rgTBIlDHCNAymg4VMk7BPZ7hm/ELNKjD+Jo2FR3qyH
B5T0Y3HsLuJvW5iB4YlcNHlsdu87kGJ55tukmi8mxdAQ4Q7e2RCOFvu396j3x+UC
B5iPNgiV5+I3lg02dZ77DnKxHZu8A/lJBdiB3QW0KtZB6awBdpUKD9jf1b0SHzUv
KBds0pjBqAlkd25HN7rOrFleaJ1/ctaJxQZBKT5ZPt0m9STJEadao0xAH0ahmbWn
OlFuhjuefXKnEgV4We0+UXgVCwOPjdAvBbI+e0ocS3MFEvzG6uBQE3xDk3SzynTn
jh8BCNAw1FtxNrQHusEwMFxIt4I7mKZ9YIqioymCzLq9gwQbooMDQaHWBfEbwrbw
qHyGO0aoSCqI3Haadr8faqU9GY/rOPNk3sgrDQoo//fb4hVC1CLQJ13hef4Y53CI
rU7m2Ys6xt0nUW7/vGT1M0NPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNV
HRMBAf8EBTADAQH/MB0GA1UdDgQWBBR5tFnme7bl5AFzgAiIyBpY9umbbjANBgkq
hkiG9w0BAQsFAAOCAgEAVR9YqbyyqFDQDLHYGmkgJykIrGF1XIpu+ILlaS/V9lZL
ubhzEFnTIZd+50xx+7LSYK05qAvqFyFWhfFQDlnrzuBZ6brJFe+GnY+EgPbk6ZGQ
3BebYhtF8GaV0nxvwuo77x/Py9auJ/GpsMiu/X1+mvoiBOv/2X/qkSsisRcOj/KK
NFtY2PwByVS5uCbMiogziUwthDyC3+6WVwW6LLv3xLfHTjuCvjHIInNzktHCgKQ5
ORAzI4JMPJ+GslWYHb4phowim57iaztXOoJwTdwJx4nLCgdNbOhdjsnvzqvHu7Ur
TkXWStAmzOVyyghqpZXjFaH3pO3JLF+l+/+sKAIuvtd7u+Nxe5AW0wdeRlN8NwdC
jNPElpzVmbUq4JUagEiuTDkHzsxHpFKVK7q4+63SM1N95R1NbdWhscdCb+ZAJzVc
oyi3B43njTOQ5yOf+1CceWxG1bQVs5ZufpsMljq4Ui0/1lvh+wjChP4kqKOJ2qxq
4RgqsahDYVvTH9w7jXbyLeiNdd8XM2w9U/t7y0Ff/9yi0GE44Za4rF2LN9d11TPA
mRGunUHBcnWEvgJBQl9nJEiU0Zsnvgc/ubhPgXRR4Xq37Z0j4r7g1SgEEzwxA57d
emyPxgcYxn/eR44/KJ4EBs+lVDR3veyJm+kXQ99b21/+jh5Xos1AnX5iItreGCc=
-----END CERTIFICATE-----
`;var Pt=`-----BEGIN CERTIFICATE-----
MIICGzCCAaGgAwIBAgIQQdKd0XLq7qeAwSxs6S+HUjAKBggqhkjOPQQDAzBPMQsw
CQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJuZXQgU2VjdXJpdHkgUmVzZWFyY2gg
R3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBYMjAeFw0yMDA5MDQwMDAwMDBaFw00
MDA5MTcxNjAwMDBaME8xCzAJBgNVBAYTAlVTMSkwJwYDVQQKEyBJbnRlcm5ldCBT
ZWN1cml0eSBSZXNlYXJjaCBHcm91cDEVMBMGA1UEAxMMSVNSRyBSb290IFgyMHYw
EAYHKoZIzj0CAQYFK4EEACIDYgAEzZvVn4CDCuwJSvMWSj5cz3es3mcFDR0HttwW
+1qLFNvicWDEukWVEYmO6gbf9yoWHKS5xcUy4APgHoIYOIvXRdgKam7mAHf7AlF9
ItgKbppbd9/w+kHsOdx1ymgHDB/qo0IwQDAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUfEKWrt5LSDv6kviejM9ti6lyN5UwCgYIKoZI
zj0EAwMDaAAwZQIwe3lORlCEwkSHRhtFcP9Ymd70/aTSVaYgLXTWNLxBo1BfASdW
tL4ndQavEi51mI38AjEAi/V3bNTIZargCyzuFJ0nN6T5U6VR5CmD1/iQMVtCnwr1
/q4AaOeMSQ+2b1tbFfLn
-----END CERTIFICATE-----
`;var de=new TextDecoder;async function br(i,e="GET"){let t=Date.now(),r=new URL(i);if(r.protocol!=="https:")throw new Error("Wrong protocol");let n=r.hostname,s=r.port||443,c=r.pathname+r.search,o=await new Promise(U=>{let S=new WebSocket(`ws://localhost:9876/v1?address=${n}:${s}`);S.binaryType="arraybuffer",S.addEventListener("open",()=>U(S)),S.addEventListener("error",f=>{console.log("ws error:",f)}),S.addEventListener("close",()=>{console.log("connection closed")})}),a=new _(o),h=W.fromPEM(wt+Pt),[y,d]=await ft(n,h,a.read.bind(a),o.send.bind(o)),l=new x(1024);l.writeUTF8String(`${e} ${c} HTTP/1.0\r
Host:${n}\r
\r
`),d(l.array());let g,p="";do if(g=await y(),g){let U=de.decode(g);p+=U}while(g);return at(`time taken: ${Date.now()-t}ms`),p}async function Hr(i){let e=Date.now(),t=ye(i),r=t.hostname,n=t.port||5432,s=t.username,c=`project=${r.match(/^[^.]+/)[0]};${t.password}`,o=t.pathname.slice(1),a=await new Promise(D=>{let L=new WebSocket(`ws://ws.neon.build/v1?address=${r}:${n}`);L.binaryType="arraybuffer",L.addEventListener("open",()=>D(L)),L.addEventListener("error",z=>{console.log("ws error:",z)}),L.addEventListener("close",()=>{console.log("connection closed")})}),h=new _(a),y=h.read.bind(h),d=a.send.bind(a),l=new x(8),g=l.writeLengthUint32Incl(0);l.writeUint32(80877103,"SSL request code"),g();let p=l.array(),U=new x(1);U.writeUTF8String("S");let S=U.array(),f=W.fromPEM(wt),[b,K]=await ft(r,f,y,d,!1,p,S,'"S" = SSL connection supported'),w=new x(1024),O=w.writeLengthUint32Incl(0);w.writeUint32(196608,0),w.writeUTF8StringNullTerminated("user"),w.writeUTF8StringNullTerminated(s),w.writeUTF8StringNullTerminated("database"),w.writeUTF8StringNullTerminated(o),w.writeUint8(0,0),O(),w.writeUTF8String("p");let H=w.writeLengthUint32Incl(0);w.writeUTF8StringNullTerminated(c),H(),w.writeUTF8String("Q");let B=w.writeLengthUint32Incl(0);w.writeUTF8StringNullTerminated("SELECT now()"),B(),await K(w.array());let V=await b(),q=new x(V);q.expectUint8("R".charCodeAt(0),0);let[j]=q.expectLengthUint32Incl("request");q.expectUint32(3,0),j();let F=await b(),u=new x(F);u.expectUint8("R".charCodeAt(0),0);let[E]=u.expectLengthUint32Incl(0);for(u.expectUint32(0,0),E();u.remaining()>0;){let D=u.readUTF8String(1);if(D==="S"){let[L,z]=u.expectLengthUint32Incl(0);for(;z()>0;){let M=u.readUTF8StringNullTerminated(),nt=u.readUTF8StringNullTerminated()}L()}else if(D==="K"){let[L]=u.expectLengthUint32Incl();u.readUint32(0),u.readUint32(0),L()}else if(D==="Z"){let[L]=u.expectLengthUint32Incl(0);u.expectUint8("I".charCodeAt(0),0),L()}}let A=await b(),m=new x(A);m.expectUint8("T".charCodeAt(0),0);let[R]=m.expectLengthUint32Incl(),v=m.readUint16(0);for(let D=0;D<v;D++){let L=m.readUTF8StringNullTerminated(),z=m.readUint32(0),M=m.readUint16(0),nt=m.readUint32(0),rt=m.readUint16(0),it=m.readUint32(0),Ct=m.readUint16(0)}R();let N;for(;m.remaining()>0;){let D=m.readUTF8String(1);if(D==="D"){let[L]=m.expectLengthUint32Incl(),z=m.readUint16(0);for(let M=0;M<z;M++){let[nt,rt]=m.expectLengthUint32();N=m.readUTF8String(rt()),nt()}L()}else if(D==="C"){let[L]=m.expectLengthUint32Incl();m.readUTF8StringNullTerminated(),L()}else if(D==="Z"){let[L]=m.expectLengthUint32Incl();m.expectUint8("I".charCodeAt(0),0),L()}else throw new Error(`Unexpected message type: ${D}`)}at("%c%s","font-size: 2em",N),at(`time taken: ${Date.now()-e}ms`);let k=new x(5);k.writeUTF8String("X"),k.writeLengthUint32Incl()(),await K(k.array())}function ye(i,e=!1){let{protocol:t}=new URL(i),r="http:"+i.substring(t.length),{username:n,password:s,hostname:c,port:o,pathname:a,search:h,searchParams:y,hash:d}=new URL(r);s=decodeURIComponent(s);let l=n+":"+s,g=e?Object.fromEntries(y.entries()):h;return{href:i,protocol:t,auth:l,username:n,password:s,hostname:c,port:o,pathname:a,search:h,query:g,hash:d}}export{br as https,Hr as postgres};
