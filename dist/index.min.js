var Ot=Object.defineProperty;var Yt=(r,e,t)=>e in r?Ot(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var y=(r,e,t)=>(Yt(r,typeof e!="symbol"?e+"":e,t),t);function E(...r){let e=r.reduce((i,s)=>i+s.length,0),t=new Uint8Array(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return t}function J(r,e){let t=r.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}var X="\xB7\xB7 ";var Pt=new TextEncoder,Gt=new TextDecoder,x=class{constructor(e){y(this,"offset");y(this,"dataView");y(this,"uint8Array");y(this,"comments");y(this,"indents");y(this,"indent");this.offset=0,this.uint8Array=typeof e=="number"?new Uint8Array(e):e,this.dataView=new DataView(this.uint8Array.buffer,this.uint8Array.byteOffset,this.uint8Array.byteLength),this.comments={},this.indents={},this.indent=0}remaining(){return this.uint8Array.length-this.offset}subarray(e){return this.uint8Array.subarray(this.offset,this.offset+=e)}skip(e,t){return this.offset+=e,t!==void 0&&this.comment(t),this}comment(e,t=this.offset){let n=this.comments[t],i=(n===void 0?"":n+" ")+e;return this.comments[t]=i,this}readBytes(e){return this.uint8Array.slice(this.offset,this.offset+=e)}readUTF8String(e){let t=this.subarray(e);return Gt.decode(t)}readUint8(e){let t=this.dataView.getUint8(this.offset);return this.offset+=1,t}readUint16(e){let t=this.dataView.getUint16(this.offset);return this.offset+=2,t}readUint24(e){let t=this.readUint8(),n=this.readUint16();return(t<<16)+n}readUint32(e){let t=this.dataView.getUint32(this.offset);return this.offset+=4,t}expectBytes(e,t){let n=this.readBytes(e.length);if(!J(n,e))throw new Error("Unexpected bytes")}expectUint8(e,t){let n=this.readUint8();if(n!==e)throw new Error(`Expected ${e}, got ${n}`)}expectUint16(e,t){let n=this.readUint16();if(n!==e)throw new Error(`Expected ${e}, got ${n}`)}expectUint24(e,t){let n=this.readUint24();if(n!==e)throw new Error(`Expected ${e}, got ${n}`)}expectLength(e,t=1){let n=this.offset,i=n+e;if(i>this.uint8Array.length)throw new Error("Expected length exceeds remaining data length");return this.indent+=t,this.indents[n]=this.indent,[()=>{if(this.indent-=t,this.indents[this.offset]=this.indent,this.offset!==i)throw new Error(`${e} bytes expected but ${this.offset-n} read`)},()=>i-this.offset]}expectLengthUint8(e){let t=this.readUint8();return this.expectLength(t)}expectLengthUint16(e){let t=this.readUint16();return this.expectLength(t)}expectLengthUint24(e){let t=this.readUint24();return this.expectLength(t)}writeBytes(e){return this.uint8Array.set(e,this.offset),this.offset+=e.length,this}writeUTF8String(e){let t=Pt.encode(e);return this.writeBytes(t),this}writeUint8(e,t){return this.dataView.setUint8(this.offset,e),this.offset+=1,this}writeUint16(e,t){return this.dataView.setUint16(this.offset,e),this.offset+=2,this}_writeLengthGeneric(e,t){let n=this.offset;this.offset+=e;let i=this.offset;return this.indent+=1,this.indents[i]=this.indent,()=>{let s=this.offset-i;if(e===1)this.dataView.setUint8(n,s);else if(e===2)this.dataView.setUint16(n,s);else if(e===3)this.dataView.setUint8(n,(s&16711680)>>16),this.dataView.setUint16(n+1,s&65535);else throw new Error(`Invalid length for length field: ${e}`);this.indent-=1,this.indents[this.offset]=this.indent}}writeLengthUint8(e){return this._writeLengthGeneric(1,e)}writeLengthUint16(e){return this._writeLengthGeneric(2,e)}writeLengthUint24(e){return this._writeLengthGeneric(3,e)}array(){return this.uint8Array.subarray(0,this.offset)}commentedString(e=!1){var s;let t=this.indents[0]!==void 0?X.repeat(this.indents[0]):"",n=(s=this.indents[0])!=null?s:0,i=e?this.uint8Array.length:this.offset;for(let a=0;a<i;a++){t+=this.uint8Array[a].toString(16).padStart(2,"0")+" ";let c=this.comments[a+1];this.indents[a+1]!==void 0&&(n=this.indents[a+1]),c!==void 0&&(t+=` ${c}
${X.repeat(n)}`)}return t}};function lt(r,e,t){let n=new x(1024);n.writeUint8(22),n.writeUint16(769);let i=n.writeLengthUint16();n.writeUint8(1);let s=n.writeLengthUint24();n.writeUint16(771),crypto.getRandomValues(n.subarray(32));let a=n.writeLengthUint8();n.writeBytes(t),a();let c=n.writeLengthUint16();n.writeUint16(4865),c();let o=n.writeLengthUint8();n.writeUint8(0),o();let h=n.writeLengthUint16();n.writeUint16(0);let d=n.writeLengthUint16(),l=n.writeLengthUint16();n.writeUint8(0);let m=n.writeLengthUint16();n.writeUTF8String(r),m(),l(),d(),n.writeUint16(11);let g=n.writeLengthUint16(),v=n.writeLengthUint8();n.writeUint8(0),v(),g(),n.writeUint16(10);let I=n.writeLengthUint16(),B=n.writeLengthUint16();n.writeUint16(23),B(),I(),n.writeUint16(13);let b=n.writeLengthUint16(),A=n.writeLengthUint16();n.writeUint16(1027),A(),b(),n.writeUint16(43);let R=n.writeLengthUint16(),M=n.writeLengthUint8();n.writeUint16(772),M(),R(),n.writeUint16(51);let K=n.writeLengthUint16(),k=n.writeLengthUint16();n.writeUint16(23);let L=n.writeLengthUint16();return n.writeBytes(new Uint8Array(e)),L(),k(),K(),h(),s(),i(),n}function Q(r,e=""){return[...r].map(t=>t.toString(16).padStart(2,"0")).join(e)}function gt(r,e){let t,n,[i]=r.expectLength(r.remaining());r.expectUint8(2);let[s]=r.expectLengthUint24();r.expectUint16(771);let a=r.readBytes(32);if(J(a,[207,33,173,116,229,154,97,17,190,29,140,2,30,101,184,145,194,162,17,22,122,187,140,94,7,158,9,226,200,168,51,156]))throw new Error("Unexpected HelloRetryRequest");r.expectUint8(e.length),r.expectBytes(e),r.expectUint16(4865),r.expectUint8(0);let[c,o]=r.expectLengthUint16();for(;o()>0;){let h=r.readUint16(),[d]=r.expectLengthUint16();if(h===43)r.expectUint16(772),n=!0;else if(h===51)r.expectUint16(23),r.expectUint16(65),t=r.readBytes(65);else throw new Error(`Unexpected extension 0x${Q([h])}`);d()}if(c(),s(),i(),n!==!0)throw new Error("No TLS version provided");if(t===void 0)throw new Error("No key provided");return t}var Ie=new RegExp(`  .+|^(${X})+`,"gm");var $t=document.querySelector("#logs"),Ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},zt=new RegExp("["+Object.keys(Ut).join("")+"]","g");function Jt(r){return r.replace(zt,e=>Ut[e])}function Wt(...r){let e="<span>",t,n;for(;(t=r.shift())!==void 0;){t=Jt(String(t));let i=/([\s\S]*?)%([csoOidf])|[\s\S]+/g;for(;(n=i.exec(t))!==null;){let[s,a,c]=n;c===void 0?e+=s:(e+=a,c==="c"?e+=`</span><span style="${r.shift()}">`:c==="s"?e+=r.shift():c==="o"||c==="O"?e+=JSON.stringify(r.shift(),void 0,c==="O"?2:void 0):(c==="i"||c==="d"||c==="f")&&(e+=String(r.shift())),e+=" ")}}return e+="</span>",e}function St(...r){console.log(...r),$t.innerHTML+='<label><input type="checkbox"><div class="section">'+Wt(...r)+"</div></label>"}var Zt=1<<14;async function et(r,e){let t=await r(5),n=new x(t),i=n.readUint8();if(i<20||i>24)throw new Error(`Illegal TLS record type 0x${i.toString(16)}`);if(e!==void 0&&i!==e)throw new Error(`Unexpected TLS record type 0x${i.toString(16).padStart(2,"0")} (expected 0x${e.toString(16).padStart(2,"0")})`);let s=n.readUint16();if([769,770,771].indexOf(s)<0)throw new Error(`Unsupported TLS record version 0x${s.toString(16).padStart(4,"0")}`);let a=n.readUint16();if(a>Zt)throw new Error(`Record too long: ${a} bytes`);let c=await r(a);return{headerData:t,header:n,type:i,version:s,length:a,content:c}}async function pt(r,e,t){let n=await et(r,23),i=new x(n.content),[s]=i.expectLength(i.remaining());i.skip(n.length-16),i.skip(16),s();let a=await e.process(n.content,16,n.headerData),c=a.length-1,o=a.subarray(0,c),h=a[c];if(t!==void 0&&h!==t)throw new Error(`Unexpected TLS record type 0x${h.toString(16).padStart(2,"0")} (expected 0x${t.toString(16).padStart(2,"0")})`);return o}async function ut(r,e){let s=r.length+16,a=new x(5+s);a.writeUint8(23),a.writeUint16(771),a.writeUint16(s,`${s} bytes follow`);let[c]=a.expectLength(s),o=a.array(),h=await e.process(r,16,o);return a.writeBytes(h.subarray(0,h.length-16)),a.writeBytes(h.subarray(h.length-16)),c(),a.array()}var Ct=new TextEncoder;async function ft(r,e,t){let n=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:`SHA-${t}`}},!1,["sign"]);var i=new Uint8Array(await crypto.subtle.sign("HMAC",n,e));return i}async function Xt(r,e,t,n){let i=n>>3,s=Math.ceil(t/i),a=new Uint8Array(s*i),c=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:`SHA-${n}`}},!1,["sign"]),o=new Uint8Array(0);for(let h=0;h<s;h++){let d=E(o,e,[h+1]),l=await crypto.subtle.sign("HMAC",c,d),m=new Uint8Array(l);a.set(m,i*h),o=m}return a.subarray(0,t)}var bt=Ct.encode("tls13 ");async function u(r,e,t,n,i){let s=Ct.encode(e),a=E([(n&65280)>>8,n&255],[bt.length+s.length],bt,s,[t.length],t);return Xt(r,a,n,i)}async function Et(r,e,t,n,i){let s=n>>3,a=new Uint8Array(s),c=await crypto.subtle.importKey("raw",r,{name:"ECDH",namedCurve:"P-256"},!1,[]),o=await crypto.subtle.deriveBits({name:"ECDH",public:c},e,256),h=new Uint8Array(o),d=await crypto.subtle.digest("SHA-256",t),l=new Uint8Array(d),m=await ft(new Uint8Array(1),a,n),g=await crypto.subtle.digest(`SHA-${n}`,new Uint8Array(0)),v=new Uint8Array(g),I=await u(m,"derived",v,s,n),B=await ft(I,h,n),b=await u(B,"c hs traffic",l,s,n),A=await u(B,"s hs traffic",l,s,n),R=await u(b,"key",new Uint8Array(0),i,n),M=await u(A,"key",new Uint8Array(0),i,n),K=await u(b,"iv",new Uint8Array(0),12,n),k=await u(A,"iv",new Uint8Array(0),12,n);return{serverHandshakeKey:M,serverHandshakeIV:k,clientHandshakeKey:R,clientHandshakeIV:K,handshakeSecret:B,clientSecret:b,serverSecret:A}}async function It(r,e,t,n){let i=t>>3,s=new Uint8Array(i),a=await crypto.subtle.digest(`SHA-${t}`,new Uint8Array(0)),c=new Uint8Array(a),o=await u(r,"derived",c,i,t),h=await ft(o,s,t),d=await u(h,"c ap traffic",e,i,t),l=await u(h,"s ap traffic",e,i,t),m=await u(d,"key",new Uint8Array(0),n,t),g=await u(l,"key",new Uint8Array(0),n,t),v=await u(d,"iv",new Uint8Array(0),12,t),I=await u(l,"iv",new Uint8Array(0),12,t);return{serverApplicationKey:g,serverApplicationIV:I,clientApplicationKey:m,clientApplicationIV:v}}var Y=class{constructor(e,t,n){y(this,"mode");y(this,"key");y(this,"initialIv");y(this,"ivLength");y(this,"currentIv");y(this,"currentIvDataView");y(this,"initialIvLast32");y(this,"recordsDecrypted",0);this.mode=e,this.key=t,this.initialIv=n,this.ivLength=n.length,this.currentIv=n.slice(),this.currentIvDataView=new DataView(this.currentIv.buffer,this.currentIv.byteOffset,this.currentIv.byteLength),this.initialIvLast32=this.currentIvDataView.getUint32(this.ivLength-4)}async process(e,t,n){let i=t<<3,s=this.initialIvLast32^this.recordsDecrypted;this.currentIvDataView.setUint32(this.ivLength-4,s),this.recordsDecrypted+=1;let a={name:"AES-GCM",iv:this.currentIv,tagLength:i,additionalData:n},c=await crypto.subtle[this.mode](a,this.key,e);return new Uint8Array(c)}};function nt(r){return r>64&&r<91?r-65:r>96&&r<123?r-71:r>47&&r<58?r+4:r===43?62:r===47?63:r===61?64:void 0}function Dt(r){let e=r.length,t=0,n=0,i=64,s=64,a=64,c=64,o=new Uint8Array(e*.75);for(;t<e;)i=nt(r.charCodeAt(t++)),s=nt(r.charCodeAt(t++)),a=nt(r.charCodeAt(t++)),c=nt(r.charCodeAt(t++)),o[n++]=i<<2|s>>4,o[n++]=(s&15)<<4|a>>2,o[n++]=(a&3)<<6|c;let h=s===64?0:a===64?2:c===64?1:0;return o.subarray(0,n-h)}var P=class extends x{readASN1Length(e){let t=this.readUint8();if(t<128)return this.comment(`${t} bytes${e?` of ${e}`:""} follow (ASN.1)`),t;let n=t&127,i=`% bytes${e?` of ${e}`:""} follow (ASN.1)`;if(n===1)return this.readUint8(i);if(n===2)return this.readUint16(i);if(n===3)return this.readUint24(i);if(n===4)return this.readUint32(i);throw new Error(`ASN.1 length fields are only supported up to 4 bytes (this one is ${n} bytes)`)}expectASN1Length(e){let t=this.readASN1Length(e);return this.expectLength(t)}readASN1OID(){let[e,t]=this.expectASN1Length("OID"),n=this.readUint8(),i=`${Math.floor(n/40)}.${n%40}`;for(;t()>0;){let s=0;for(;;){let a=this.readUint8();if(s<<=7,s+=a&127,a<128)break}i+=`.${s}`}return this.comment(i),e(),i}readASN1Boolean(){let[e,t]=this.expectASN1Length("boolean"),n=t();if(n!==1)throw new Error(`Boolean has weird length: ${n}`);let i=this.readUint8(),s;if(i===255)s=!0;else if(i===0)s=!1;else throw new Error(`Boolean has weird value: 0x${Q([i])}`);return this.comment(s.toString()),e(),s}readASN1UTCTime(){let[e,t]=this.expectASN1Length("UTC time"),i=this.readUTF8String(t()).match(/^(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z$/);if(!i)throw new Error("Unrecognised UTC time format in certificate validity");let[,s,a,c,o,h,d]=i,l=parseInt(s,10),m=l+(l>=50?1900:2e3),g=new Date(`${m}-${a}-${c}T${o}:${h}:${d}Z`);return this.comment("= "+g.toISOString()),e(),g}readASN1BitString(){let[e,t]=this.expectASN1Length("bit string"),n=this.readUint8("right-padding bits"),i=t(),s=this.readBytes(i);if(n>7)throw new Error(`Invalid right pad value: ${n}`);if(n>0){let a=8-n;for(let c=i-1;c>0;c--)s[c]=255&s[c-1]<<a|s[c]>>>n;s[0]=s[0]>>>n}return e(),s}};var it=1,W=2,f=48,_t=49,G=6,te=19,ee=12,At=23,rt=5,q=4,st=3,vt=163,Z=128;var ne={"2.5.4.6":"C","2.5.4.10":"O","2.5.4.11":"OU","2.5.4.3":"CN","2.5.4.7":"L","2.5.4.8":"ST","2.5.4.12":"T","2.5.4.42":"GN","2.5.4.43":"I","2.5.4.4":"SN","1.2.840.113549.1.9.1":"E-mail"};function Bt(r){let{length:e}=r;if(e>4)throw new Error(`Bit string length ${e} would overflow JS bit operators`);let t=0,n=0;for(let i=r.length-1;i>=0;i--)t|=r[i]<<n,n+=8;return t}function xt(r,e){var s;let t={};r.expectUint8(f);let[n,i]=r.expectASN1Length();for(;i()>0;){r.expectUint8(_t);let[a]=r.expectASN1Length();r.expectUint8(f);let[c]=r.expectASN1Length();r.expectUint8(G);let o=r.readASN1OID(),h=(s=ne[o])!=null?s:o,d=r.readUint8();if(d!==te){if(d!==ee)throw new Error(`Unexpected item type in certificate ${e}: 0x${Q([d])}`)}let[l,m]=r.expectASN1Length(),g=r.readUTF8String(m());if(l(),c(),a(),t[h]!==void 0)throw new Error(`Duplicate OID ${h} in certificate ${e}`);t[h]=g}return n(),t}function Lt(r,e=0){let t=[],[n,i]=r.expectASN1Length();for(;i()>0;){let s=r.readUint8(),[a,c]=r.expectASN1Length(),o;s===(e|2)?o=r.readUTF8String(c()):o=r.readBytes(c()),t.push({name:o,type:s}),a()}return n(),t}function Nt(r){let e={"1.2.840.113549.1.1.1":{name:"RSAES-PKCS1-v1_5"},"1.2.840.113549.1.1.5":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}},"1.2.840.113549.1.1.11":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},"1.2.840.113549.1.1.12":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},"1.2.840.113549.1.1.13":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}},"1.2.840.113549.1.1.10":{name:"RSA-PSS"},"1.2.840.113549.1.1.7":{name:"RSA-OAEP"},"1.2.840.10045.2.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.3.2":{name:"ECDSA",hash:{name:"SHA-256"}},"1.2.840.10045.4.3.3":{name:"ECDSA",hash:{name:"SHA-384"}},"1.2.840.10045.4.3.4":{name:"ECDSA",hash:{name:"SHA-512"}},"1.3.133.16.840.63.0.2":{name:"ECDH",kdf:"SHA-1"},"1.3.132.1.11.1":{name:"ECDH",kdf:"SHA-256"},"1.3.132.1.11.2":{name:"ECDH",kdf:"SHA-384"},"1.3.132.1.11.3":{name:"ECDH",kdf:"SHA-512"},"2.16.840.1.101.3.4.1.2":{name:"AES-CBC",length:128},"2.16.840.1.101.3.4.1.22":{name:"AES-CBC",length:192},"2.16.840.1.101.3.4.1.42":{name:"AES-CBC",length:256},"2.16.840.1.101.3.4.1.6":{name:"AES-GCM",length:128},"2.16.840.1.101.3.4.1.26":{name:"AES-GCM",length:192},"2.16.840.1.101.3.4.1.46":{name:"AES-GCM",length:256},"2.16.840.1.101.3.4.1.4":{name:"AES-CFB",length:128},"2.16.840.1.101.3.4.1.24":{name:"AES-CFB",length:192},"2.16.840.1.101.3.4.1.44":{name:"AES-CFB",length:256},"2.16.840.1.101.3.4.1.5":{name:"AES-KW",length:128},"2.16.840.1.101.3.4.1.25":{name:"AES-KW",length:192},"2.16.840.1.101.3.4.1.45":{name:"AES-KW",length:256},"1.2.840.113549.2.7":{name:"HMAC",hash:{name:"SHA-1"}},"1.2.840.113549.2.9":{name:"HMAC",hash:{name:"SHA-256"}},"1.2.840.113549.2.10":{name:"HMAC",hash:{name:"SHA-384"}},"1.2.840.113549.2.11":{name:"HMAC",hash:{name:"SHA-512"}},"1.2.840.113549.1.9.16.3.5":{name:"DH"},"1.3.14.3.2.26":{name:"SHA-1"},"2.16.840.1.101.3.4.2.1":{name:"SHA-256"},"2.16.840.1.101.3.4.2.2":{name:"SHA-384"},"2.16.840.1.101.3.4.2.3":{name:"SHA-512"},"1.2.840.113549.1.5.12":{name:"PBKDF2"},"1.2.840.10045.3.1.7":{name:"P-256"},"1.3.132.0.34":{name:"P-384"},"1.3.132.0.35":{name:"P-521"}}[r];if(e===void 0)throw new Error(`Unsupported algorithm identifier: ${r}`);return e}function kt(r,e=[]){return Object.values(r).forEach(t=>{typeof t=="string"?e=[...e,t]:e=kt(t,e)}),e}function Tt(r){return kt(r).join(" / ")}var j=class{constructor(e){y(this,"serialNumber");y(this,"algorithm");y(this,"issuer");y(this,"validityPeriod");y(this,"subject");y(this,"publicKey");y(this,"signature");y(this,"keyUsage");y(this,"subjectAltNames");y(this,"extKeyUsage");y(this,"authorityKeyIdentifier");y(this,"subjectKeyIdentifier");y(this,"basicConstraints");let t=e instanceof P?e:new P(e);t.expectUint8(f);let[n]=t.expectASN1Length();t.expectUint8(f);let[i]=t.expectASN1Length();t.expectBytes([160,3,2,1,2]),t.expectUint8(W);let[s,a]=t.expectASN1Length();this.serialNumber=t.subarray(a()),s(),t.expectUint8(f);let[c,o]=t.expectASN1Length();t.expectUint8(G),this.algorithm=t.readASN1OID(),o()>0&&(t.expectUint8(rt),t.expectUint8(0)),c(),this.issuer=xt(t,"issuer"),t.expectUint8(f);let[h]=t.expectASN1Length();t.expectUint8(At);let d=t.readASN1UTCTime();t.expectUint8(At);let l=t.readASN1UTCTime();this.validityPeriod={notBefore:d,notAfter:l},h(),this.subject=xt(t,"subject"),t.expectUint8(f);let[m]=t.expectASN1Length();t.expectUint8(f);let[g,v]=t.expectASN1Length(),I=[];for(;v()>0;){let L=t.readUint8();if(L===G){let N=t.readASN1OID();I.push(N)}else L===rt&&t.expectUint8(0)}g(),t.expectUint8(st);let B=t.readASN1BitString();this.publicKey={identifiers:I,data:B},m(),t.expectUint8(vt);let[b]=t.expectASN1Length();t.expectUint8(f);let[A,R]=t.expectASN1Length();for(;R()>0;){t.expectUint8(f);let[L,N]=t.expectASN1Length();t.expectUint8(G);let T=t.readASN1OID();if(T==="2.5.29.17"){t.expectUint8(q);let[U]=t.expectASN1Length();t.expectUint8(f);let S=Lt(t,Z);this.subjectAltNames=S.filter(p=>p.type===(2|Z)).map(p=>p.name),U()}else if(T==="2.5.29.15"){t.expectUint8(it);let U=t.readASN1Boolean();t.expectUint8(q);let[S]=t.expectASN1Length();t.expectUint8(st);let p=t.readASN1BitString(),w=Bt(p),D=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],H=new Set(D.filter((F,$)=>w&1<<$));S(),this.keyUsage={critical:U,usages:H}}else if(T==="2.5.29.37"){this.extKeyUsage={},t.expectUint8(q);let[U]=t.expectASN1Length();t.expectUint8(f);let[S,p]=t.expectASN1Length();for(;p()>0;){t.expectUint8(G);let w=t.readASN1OID();w==="1.3.6.1.5.5.7.3.1"&&(this.extKeyUsage.serverTls=!0),w==="1.3.6.1.5.5.7.3.2"&&(this.extKeyUsage.clientTls=!0)}S(),U()}else if(T==="2.5.29.35"){t.expectUint8(q);let[U]=t.expectASN1Length();t.expectUint8(f);let[S,p]=t.expectASN1Length();for(;p()>0;){let w=t.readUint8();if(w===(Z|0)){let[D,H]=t.expectASN1Length();this.authorityKeyIdentifier=t.readBytes(H()),D()}else if(w===(Z|1)||w===(Z|2)){let[D,H]=t.expectASN1Length();t.skip(H()),D()}else throw new Error("Unexpected data type in authorityKeyIdentifier certificate extension")}S(),U()}else if(T==="2.5.29.14"){t.expectUint8(q);let[U]=t.expectASN1Length();t.expectUint8(q);let[S,p]=t.expectASN1Length();this.subjectKeyIdentifier=t.readBytes(p()),S(),U()}else if(T==="2.5.29.19"){t.expectUint8(it);let U=t.readASN1Boolean();t.expectUint8(q);let[S]=t.expectASN1Length();t.expectUint8(f);let[p,w]=t.expectASN1Length(),D;w()>0&&(t.expectUint8(it),D=t.readASN1Boolean());let H;if(w()>0){t.expectUint8(W);let F=t.readASN1Length();if((F===1?t.readUint8():F===2?t.readUint16():F===3?t.readUint24():void 0)===void 0)throw new Error("Too many bytes in max path length in certificate basicConstraints")}p(),S(),this.basicConstraints={critical:U,ca:D,pathLength:H}}else t.skip(N());L()}A(),b(),i(),t.expectUint8(f);let[M,K]=t.expectASN1Length();t.expectUint8(G);let k=t.readASN1OID();if(K()>0&&(t.expectUint8(rt),t.expectUint8(0)),M(),k!==this.algorithm)throw new Error(`Certificate specifies different signature algorithms inside (${this.algorithm}) and out (${k})`);t.expectUint8(st),this.signature=t.readASN1BitString(),n()}static fromPEM(e){let t="[A-Z0-9 ]+",n=new RegExp(`-{5}BEGIN ${t}-{5}([a-zA-Z0-9=+\\/\\n\\r]+)-{5}END ${t}-{5}`,"g"),i=[],s=null;for(;s=n.exec(e);){let a=s[1].replace(/[\r\n]/g,""),c=Dt(a),o=new j(c);i.push(o)}return i}subjectAltNamesMatch(e){var n;let t=/[.][^.]+[.][^.]+$/;return((n=this.subjectAltNames)!=null?n:[]).some(i=>{let s=i,a=e;if(t.test(e)&&t.test(s)&&s.startsWith("*.")&&(s=s.slice(1),a=a.slice(a.indexOf("."))),s===a)return!0})}isValidAtMoment(e=new Date){return e>=this.validityPeriod.notBefore&&e<=this.validityPeriod.notAfter}description(){return"subject: "+Object.entries(this.subject).map(e=>e.join("=")).join(", ")+(this.subjectAltNames?`
subject alt names: `+this.subjectAltNames.join(", "):"")+(this.subjectKeyIdentifier?`
subject key id: ${Q(this.subjectKeyIdentifier," ")}`:"")+`
issuer: `+Object.entries(this.issuer).map(e=>e.join("=")).join(", ")+(this.authorityKeyIdentifier?`
authority key id: ${Q(this.authorityKeyIdentifier," ")}`:"")+`
validity: `+this.validityPeriod.notBefore.toISOString()+" \u2013 "+this.validityPeriod.notAfter.toISOString()+` (${this.isValidAtMoment()?"currently valid":"not valid"})`+(this.keyUsage?`
key usage (${this.keyUsage.critical?"critical":"non-critical"}): `+[...this.keyUsage.usages].join(", "):"")+(this.extKeyUsage?`
extended key usage: TLS server \u2014\xA0${this.extKeyUsage.serverTls}, TLS client \u2014\xA0${this.extKeyUsage.clientTls}`:"")+(this.basicConstraints?`
basic constraints (${this.basicConstraints.critical?"critical":"non-critical"}): CA \u2014\xA0${this.basicConstraints.ca}, path length \u2014 ${this.basicConstraints.pathLength}`:"")+`
signature algorithm: `+Tt(Nt(this.algorithm))}};var Ht=`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
TzELMAkGA1UEBhMCVVMxKTAnBgNVBAoTIEludGVybmV0IFNlY3VyaXR5IFJlc2Vh
cmNoIEdyb3VwMRUwEwYDVQQDEwxJU1JHIFJvb3QgWDEwHhcNMTUwNjA0MTEwNDM4
WhcNMzUwNjA0MTEwNDM4WjBPMQswCQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJu
ZXQgU2VjdXJpdHkgUmVzZWFyY2ggR3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBY
MTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAK3oJHP0FDfzm54rVygc
h77ct984kIxuPOZXoHj3dcKi/vVqbvYATyjb3miGbESTtrFj/RQSa78f0uoxmyF+
0TM8ukj13Xnfs7j/EvEhmkvBioZxaUpmZmyPfjxwv60pIgbz5MDmgK7iS4+3mX6U
A5/TR5d8mUgjU+g4rk8Kb4Mu0UlXjIB0ttov0DiNewNwIRt18jA8+o+u3dpjq+sW
T8KOEUt+zwvo/7V3LvSye0rgTBIlDHCNAymg4VMk7BPZ7hm/ELNKjD+Jo2FR3qyH
B5T0Y3HsLuJvW5iB4YlcNHlsdu87kGJ55tukmi8mxdAQ4Q7e2RCOFvu396j3x+UC
B5iPNgiV5+I3lg02dZ77DnKxHZu8A/lJBdiB3QW0KtZB6awBdpUKD9jf1b0SHzUv
KBds0pjBqAlkd25HN7rOrFleaJ1/ctaJxQZBKT5ZPt0m9STJEadao0xAH0ahmbWn
OlFuhjuefXKnEgV4We0+UXgVCwOPjdAvBbI+e0ocS3MFEvzG6uBQE3xDk3SzynTn
jh8BCNAw1FtxNrQHusEwMFxIt4I7mKZ9YIqioymCzLq9gwQbooMDQaHWBfEbwrbw
qHyGO0aoSCqI3Haadr8faqU9GY/rOPNk3sgrDQoo//fb4hVC1CLQJ13hef4Y53CI
rU7m2Ys6xt0nUW7/vGT1M0NPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNV
HRMBAf8EBTADAQH/MB0GA1UdDgQWBBR5tFnme7bl5AFzgAiIyBpY9umbbjANBgkq
hkiG9w0BAQsFAAOCAgEAVR9YqbyyqFDQDLHYGmkgJykIrGF1XIpu+ILlaS/V9lZL
ubhzEFnTIZd+50xx+7LSYK05qAvqFyFWhfFQDlnrzuBZ6brJFe+GnY+EgPbk6ZGQ
3BebYhtF8GaV0nxvwuo77x/Py9auJ/GpsMiu/X1+mvoiBOv/2X/qkSsisRcOj/KK
NFtY2PwByVS5uCbMiogziUwthDyC3+6WVwW6LLv3xLfHTjuCvjHIInNzktHCgKQ5
ORAzI4JMPJ+GslWYHb4phowim57iaztXOoJwTdwJx4nLCgdNbOhdjsnvzqvHu7Ur
TkXWStAmzOVyyghqpZXjFaH3pO3JLF+l+/+sKAIuvtd7u+Nxe5AW0wdeRlN8NwdC
jNPElpzVmbUq4JUagEiuTDkHzsxHpFKVK7q4+63SM1N95R1NbdWhscdCb+ZAJzVc
oyi3B43njTOQ5yOf+1CceWxG1bQVs5ZufpsMljq4Ui0/1lvh+wjChP4kqKOJ2qxq
4RgqsahDYVvTH9w7jXbyLeiNdd8XM2w9U/t7y0Ff/9yi0GE44Za4rF2LN9d11TPA
mRGunUHBcnWEvgJBQl9nJEiU0Zsnvgc/ubhPgXRR4Xq37Z0j4r7g1SgEEzwxA57d
emyPxgcYxn/eR44/KJ4EBs+lVDR3veyJm+kXQ99b21/+jh5Xos1AnX5iItreGCc=
-----END CERTIFICATE-----
`;var Rt=`-----BEGIN CERTIFICATE-----
MIICGzCCAaGgAwIBAgIQQdKd0XLq7qeAwSxs6S+HUjAKBggqhkjOPQQDAzBPMQsw
CQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJuZXQgU2VjdXJpdHkgUmVzZWFyY2gg
R3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBYMjAeFw0yMDA5MDQwMDAwMDBaFw00
MDA5MTcxNjAwMDBaME8xCzAJBgNVBAYTAlVTMSkwJwYDVQQKEyBJbnRlcm5ldCBT
ZWN1cml0eSBSZXNlYXJjaCBHcm91cDEVMBMGA1UEAxMMSVNSRyBSb290IFgyMHYw
EAYHKoZIzj0CAQYFK4EEACIDYgAEzZvVn4CDCuwJSvMWSj5cz3es3mcFDR0HttwW
+1qLFNvicWDEukWVEYmO6gbf9yoWHKS5xcUy4APgHoIYOIvXRdgKam7mAHf7AlF9
ItgKbppbd9/w+kHsOdx1ymgHDB/qo0IwQDAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUfEKWrt5LSDv6kviejM9ti6lyN5UwCgYIKoZI
zj0EAwMDaAAwZQIwe3lORlCEwkSHRhtFcP9Ymd70/aTSVaYgLXTWNLxBo1BfASdW
tL4ndQavEi51mI38AjEAi/V3bNTIZargCyzuFJ0nN6T5U6VR5CmD1/iQMVtCnwr1
/q4AaOeMSQ+2b1tbFfLn
-----END CERTIFICATE-----
`;var Mt=`-----BEGIN CERTIFICATE-----
MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/
MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT
DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow
PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD
Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O
rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq
OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b
xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw
7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD
aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV
HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG
SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69
ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr
AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz
R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5
JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo
Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ
-----END CERTIFICATE-----
`;var Kt=`-----BEGIN CERTIFICATE-----
MIIDdzCCAl+gAwIBAgIEAgAAuTANBgkqhkiG9w0BAQUFADBaMQswCQYDVQQGEwJJ
RTESMBAGA1UEChMJQmFsdGltb3JlMRMwEQYDVQQLEwpDeWJlclRydXN0MSIwIAYD
VQQDExlCYWx0aW1vcmUgQ3liZXJUcnVzdCBSb290MB4XDTAwMDUxMjE4NDYwMFoX
DTI1MDUxMjIzNTkwMFowWjELMAkGA1UEBhMCSUUxEjAQBgNVBAoTCUJhbHRpbW9y
ZTETMBEGA1UECxMKQ3liZXJUcnVzdDEiMCAGA1UEAxMZQmFsdGltb3JlIEN5YmVy
VHJ1c3QgUm9vdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKMEuyKr
mD1X6CZymrV51Cni4eiVgLGw41uOKymaZN+hXe2wCQVt2yguzmKiYv60iNoS6zjr
IZ3AQSsBUnuId9Mcj8e6uYi1agnnc+gRQKfRzMpijS3ljwumUNKoUMMo6vWrJYeK
mpYcqWe4PwzV9/lSEy/CG9VwcPCPwBLKBsua4dnKM3p31vjsufFoREJIE9LAwqSu
XmD+tqYF/LTdB1kC1FkYmGP1pWPgkAx9XbIGevOF6uvUA65ehD5f/xXtabz5OTZy
dc93Uk3zyZAsuT3lySNTPx8kmCFcB5kpvcY67Oduhjprl3RjM71oGDHweI12v/ye
jl0qhqdNkNwnGjkCAwEAAaNFMEMwHQYDVR0OBBYEFOWdWTCCR1jMrPoIVDaGezq1
BE3wMBIGA1UdEwEB/wQIMAYBAf8CAQMwDgYDVR0PAQH/BAQDAgEGMA0GCSqGSIb3
DQEBBQUAA4IBAQCFDF2O5G9RaEIFoN27TyclhAO992T9Ldcw46QQF+vaKSm2eT92
9hkTI7gQCvlYpNRhcL0EYWoSihfVCr3FvDB81ukMJY2GQE/szKN+OMY3EU/t3Wgx
jkzSswF07r51XgdIGn9w/xZchMB5hbgF/X++ZRGjD8ACtPhSNzkE1akxehi/oCr0
Epn3o0WC4zxe9Z2etciefC7IpJ5OCBRLbf1wbWsaY71k5h+3zvDyny67G7fyUIhz
ksLi4xaNmjICq44Y3ekQEe5+NauQrz4wlHrQMz2nZQ/1/I6eYs9HRCwBXbsdtTLS
R9I4LtD+gdwyah617jzV/OeBHRnDJELqYzmp
-----END CERTIFICATE-----`;var Qt=`-----BEGIN CERTIFICATE-----\r
MIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG\r
A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv\r
b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw05ODA5MDExMjAw\r
MDBaFw0yODAxMjgxMjAwMDBaMFcxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i\r
YWxTaWduIG52LXNhMRAwDgYDVQQLEwdSb290IENBMRswGQYDVQQDExJHbG9iYWxT\r
aWduIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDaDuaZ\r
jc6j40+Kfvvxi4Mla+pIH/EqsLmVEQS98GPR4mdmzxzdzxtIK+6NiY6arymAZavp\r
xy0Sy6scTHAHoT0KMM0VjU/43dSMUBUc71DuxC73/OlS8pF94G3VNTCOXkNz8kHp\r
1Wrjsok6Vjk4bwY8iGlbKk3Fp1S4bInMm/k8yuX9ifUSPJJ4ltbcdG6TRGHRjcdG\r
snUOhugZitVtbNV4FpWi6cgKOOvyJBNPc1STE4U6G7weNLWLBYy5d4ux2x8gkasJ\r
U26Qzns3dLlwR5EiUWMWea6xrkEmCMgZK9FGqkjWZCrXgzT/LCrBbBlDSgeF59N8\r
9iFo7+ryUp9/k5DPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8E\r
BTADAQH/MB0GA1UdDgQWBBRge2YaRQ2XyolQL30EzTSo//z9SzANBgkqhkiG9w0B\r
AQUFAAOCAQEA1nPnfE920I2/7LqivjTFKDK1fPxsnCwrvQmeU79rXqoRSLblCKOz\r
yj1hTdNGCbM+w6DjY1Ub8rrvrTnhQ7k4o+YviiY776BQVvnGCv04zcQLcFGUl5gE\r
38NflNUVyRRBnMRddWQVDf9VMOyGj/8N7yy5Y0b2qvzfvGn9LhJIZJrglfCm7ymP\r
AbEVtQwdpf5pLGkkeB6zpxxxYu7KyJesF12KwvhHhm4qxFYxldBniYUr+WymXUad\r
DKqC5JlR3XC321Y9YeRq4VzW9v493kHMB65jUr9TU/Qr6cf9tveCX4XSQRjbgbME\r
HMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==\r
-----END CERTIFICATE-----\r
`;function Ft(){return j.fromPEM(Ht+Rt+Mt+Kt+Qt)}var oe=new TextEncoder;async function Vt(r,e,t,n){let i=new P(e),[s]=i.expectLength(e.length,0);i.expectUint8(8);let[a]=i.expectLengthUint24(),[c,o]=i.expectLengthUint16();o()>0&&(i.expectUint16(0),i.expectUint16(0)),c(),a(),i.expectUint8(11);let[h]=i.expectLengthUint24();i.expectUint8(0);let[d,l]=i.expectLengthUint24(),m=[];for(;l()>0;){let[C]=i.expectLengthUint24(),V=new j(i);m.push(V),C();let[qt,jt]=i.expectLengthUint16(),de=i.subarray(jt());qt()}if(d(),h(),m.length===0)throw new Error("No certificates supplied");let g=m[0],v=i.uint8Array.subarray(0,i.offset),I=E(n,v),B=await crypto.subtle.digest("SHA-256",I),b=new Uint8Array(B),A=E(oe.encode(" ".repeat(64)+"TLS 1.3, server CertificateVerify"),[0],b);i.expectUint8(15);let[R]=i.expectLengthUint24();i.expectUint16(1027);let[M]=i.expectLengthUint16();i.expectUint8(f);let[K]=i.expectASN1Length();i.expectUint8(W);let[k,L]=i.expectASN1Length(),N=i.readBytes(L());k(),i.expectUint8(W);let[T,U]=i.expectASN1Length(),S=i.readBytes(U());T(),K(),M(),R();let p=(C,V)=>C.length>V?C.subarray(C.length-V):C.length<V?E(new Uint8Array(V-C.length),C):C,w=E(p(N,32),p(S,32)),D=await crypto.subtle.importKey("raw",g.publicKey.data,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]);if(await crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},D,w,A)!==!0)throw new Error("Certificate verify failed");let F=i.uint8Array.subarray(0,i.offset),$=E(n,F),O=await u(t,"finished",new Uint8Array(0),32,256),ct=await crypto.subtle.digest("SHA-256",$),ot=await crypto.subtle.importKey("raw",O,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),z=await crypto.subtle.sign("HMAC",ot,ct),ht=new Uint8Array(z);i.expectUint8(20);let[yt,dt]=i.expectLengthUint24(),mt=i.readBytes(dt());if(yt(),s(),J(mt,ht)!==!0)throw new Error("Invalid server verify hash");for(let C of m);if(!g.subjectAltNamesMatch(r))throw new Error(`No matching subjectAltName for ${r}`);let tt=Ft();for(let C of tt);}var at=class{constructor(e){y(this,"queue");y(this,"outstandingRequest");this.queue=[],e.addEventListener("message",t=>this.enqueue(new Uint8Array(t.data)))}enqueue(e){this.queue.push(e),this.dequeue()}dequeue(){if(this.outstandingRequest===void 0)return;let{resolve:e,bytes:t}=this.outstandingRequest;if(this.bytesInQueue()<t)return;this.outstandingRequest=void 0;let i=this.queue[0],s=i.length;if(s===t)return this.queue.shift(),e(i);if(s>t)return this.queue[0]=i.subarray(t),e(i.subarray(0,t));{let a=new Uint8Array(t),c=t,o=0;for(;c>0;){let h=this.queue[0],d=h.length;d<=c?(this.queue.shift(),a.set(h,o),o+=d,c-=d):(this.queue[0]=h.subarray(c),a.set(h.subarray(0,c),o),c-=c,o+=c)}return e(a)}}bytesInQueue(){return this.queue.reduce((e,t)=>e+t.length,0)}async read(e){if(this.outstandingRequest!==void 0)throw new Error("Can\u2019t read while already awaiting read");return new Promise(t=>{this.outstandingRequest={resolve:t,bytes:e},this.dequeue()})}};async function he(r,e){let t=await new Promise(i=>{let s=new WebSocket(`ws://localhost:9999/?name=${r}:${e}`);s.binaryType="arraybuffer",s.addEventListener("open",()=>i(s)),s.addEventListener("close",()=>{console.log("ws closed")}),s.addEventListener("error",a=>{console.log("ws error:",a)})}),n=new at(t);await ye(r,n.read.bind(n),t.send.bind(t))}async function ye(r,e,t){let n=Date.now(),i=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),s=await crypto.subtle.exportKey("raw",i.publicKey),a=new Uint8Array(32);crypto.getRandomValues(a);let o=lt(r,s,a).array();t(o);let h=await et(e,22),d=new x(h.content),l=gt(d,a),m=await et(e,20),g=new x(m.content),[v]=g.expectLength(1);g.expectUint8(1),v();let I=o.subarray(5),B=h.content,b=E(I,B),A=await Et(l,i.privateKey,b,256,16),R=await crypto.subtle.importKey("raw",A.serverHandshakeKey,{name:"AES-GCM"},!1,["decrypt"]),M=new Y("decrypt",R,A.serverHandshakeIV),K=await crypto.subtle.importKey("raw",A.clientHandshakeKey,{name:"AES-GCM"},!1,["encrypt"]),k=new Y("encrypt",K,A.clientHandshakeIV),L=await pt(e,M,22);await Vt(r,L,A.serverSecret,b);let N=new x(6);N.writeUint8(20),N.writeUint16(771);let T=N.writeLengthUint16();N.writeUint8(1),T();let U=N.array(),S=E(b,L),p=await crypto.subtle.digest("SHA-256",S),w=new Uint8Array(p),D=await u(A.clientSecret,"finished",new Uint8Array(0),32,256),H=await crypto.subtle.importKey("raw",D,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),F=await crypto.subtle.sign("HMAC",H,w),$=new Uint8Array(F),O=new x(37);O.writeUint8(20);let ct=O.writeLengthUint24();O.writeBytes($),ct(),O.writeUint8(22);let ot=await ut(O.array(),k),z=await It(A.handshakeSecret,w,256,16),ht=await crypto.subtle.importKey("raw",z.clientApplicationKey,{name:"AES-GCM"},!1,["encrypt"]),yt=new Y("encrypt",ht,z.clientApplicationIV),dt=await crypto.subtle.importKey("raw",z.serverApplicationKey,{name:"AES-GCM"},!1,["decrypt"]),mt=new Y("decrypt",dt,z.serverApplicationIV),_=new x(1024);_.writeUTF8String(`GET / HTTP/1.0\r
Host:${r}\r
\r
`),_.writeUint8(23);let wt=await ut(_.array(),yt);t(E(U,ot,wt));let tt=!1;for(;;){let C=setTimeout(()=>{tt||window.dispatchEvent(new Event("handshakedone")),tt=!0},1e3),V=await pt(e,mt,23);console.log(`time to first decrypted record: ${Date.now()-n}ms`),clearTimeout(C),St(new TextDecoder().decode(V))}}he("google.com",443);
